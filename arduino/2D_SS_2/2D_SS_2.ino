// HOW TO:
// ------------------------------
// Serial input = 2 -> Steps through gait sequence once and stops at the end.
// Serial input = 1 -> Steps through gait sequence in a loop.
// Serial input = 0 -> Stops infinite loop at the node where it is at that moment

//Gait template
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pca9685 = Adafruit_PWMServoDriver();

#define SERVO_FREQ 300
#define SER0 0 //Hip 1
#define SER1 1 //Knee 1
#define SER2 2 //Hip 2
#define SER3 3 //Knee 2
#define SER4 4 //Hip 3
#define SER5 5 //Knee 3
#define SER6 6 //Hip 4
#define SER7 7 //Knee 4

// Insert servo angles here:
// For 3D gaits, these angles are obtained from linearisation.py - angles are already corrected for and can just be put on the robot as is
// For 2D gaits, these angles are obtained from 2D_trajectory_reader.py - angles are already corrected for and can just be put on the robot as is
float SS_servo0[] = {-1.51462784e-03, -1.78958933e-03, -2.20320213e-03, -2.60710165e-03, -3.00255208e-03, -3.39157749e-03, -3.77616016e-03, -4.15839455e-03, -4.54059331e-03, -4.92535526e-03, -5.31565292e-03, -5.71494403e-03, -6.12731481e-03, -6.55785259e-03, -7.01278455e-03, -7.49936082e-03, -8.02725959e-03, -8.60843645e-03, -9.25766017e-03, -9.99454122e-03, -1.08452269e-02, -1.18457163e-02, -1.30514030e-02, -1.23900144e-02, -1.05250987e-02, -8.66018297e-03, -8.93151149e-03, -1.03270543e-02, -1.17225970e-02, -1.31181398e-02, -1.45136826e-02, -1.59092253e-02, -1.73047681e-02, -1.87003109e-02, -2.00958536e-02, -2.15635340e-02, -2.32305041e-02, -2.48974742e-02, -2.65644443e-02, -2.82314144e-02, -2.98983845e-02, -3.15653546e-02, -3.14622923e-02, -2.92883180e-02, -2.71143438e-02, -2.71100866e-02, -3.03502725e-02, -3.35904584e-02, -3.68306443e-02, -4.00708303e-02, -4.33110162e-02, -4.65512021e-02, -4.97913880e-02, -5.30315740e-02, -5.62717599e-02, -6.07303457e-02, -6.56347118e-02, -7.05390779e-02, -7.54434439e-02, -8.03478100e-02, -8.52521761e-02, -9.01565422e-02, -8.73229149e-02, -8.15520081e-02, -7.57811012e-02, -7.00101944e-02, -6.42742092e-02, -5.89519817e-02, -5.36297542e-02, -4.83075267e-02, -4.29852992e-02, -3.76630717e-02, -3.23408442e-02, -2.70186167e-02, -2.16963893e-02, -1.63741618e-02, -1.10519343e-02, -5.72970678e-03, -4.07479284e-04,  4.91474821e-03,  1.02369757e-02,  1.52440322e-02,  1.97686540e-02,  2.42932757e-02,  2.88178974e-02,  3.33425191e-02,  3.78671409e-02,  4.23917626e-02,  4.69163843e-02,  5.14410061e-02,  5.59656278e-02,  6.04902495e-02,  6.21668491e-02,  6.29139777e-02,  6.31089365e-02,  6.11493150e-02,  5.91896935e-02,  5.72300720e-02,  5.52704505e-02,  5.33108290e-02,  5.13512075e-02,  4.93915861e-02,  4.72758484e-02,  4.42556808e-02,  4.12355132e-02,  3.82153456e-02,  3.51951780e-02,  3.21750104e-02,  2.93231746e-02,  2.68232688e-02,  2.42797162e-02,  2.18587148e-02,  1.98504000e-02,  1.79644257e-02,  1.67693257e-02,  1.55742257e-02,  1.43791257e-02,  1.31840257e-02,  1.19889258e-02,  1.07938258e-02,  9.72687180e-03,  8.93071405e-03,  8.13455631e-03,  7.33839857e-03,  6.54224083e-03,  5.72641671e-03,  4.92177430e-03,  4.17945552e-03,  3.48850224e-03,  2.84199021e-03,  2.23316798e-03,  1.65701105e-03,  1.10980469e-03,  5.88158034e-04,  8.93850350e-05, -3.88870190e-04, -8.48654931e-04, -1.29239353e-03};
float SS_servo1[] = { 1.06240415e-03,  1.11219135e-03,  1.18904565e-03,  1.26864368e-03,  1.35167628e-03,  1.43871861e-03,  1.53073515e-03,  1.62905647e-03,  1.73544399e-03,  1.85219191e-03,  1.98226359e-03,  2.12947087e-03,  2.29870606e-03,  2.49647242e-03,  2.73113134e-03,  3.01294288e-03,  3.35620841e-03,  3.77893065e-03,  4.30367564e-03,  4.96107533e-03,  5.79266321e-03,  6.85731296e-03,  8.23856195e-03,  6.48518034e-03,  2.69943310e-03, -1.08631413e-03, -1.81441520e-03, -9.33407477e-04, -5.23997585e-05,  8.28607960e-04,  1.70961568e-03,  2.59062340e-03,  3.47163112e-03,  4.35263884e-03,  5.23364655e-03,  6.24035150e-03,  7.59431201e-03,  8.94827252e-03,  1.03022330e-02,  1.16561935e-02,  1.30101541e-02,  1.43641146e-02,  1.23820398e-02,  6.49685292e-03,  6.11666034e-04, -2.68806471e-03, -2.12168519e-03, -1.55530566e-03, -9.88926143e-04, -4.22546622e-04,  1.43832900e-04,  7.10212421e-04,  1.27659194e-03,  1.84297146e-03,  2.40935099e-03,  1.08729196e-03, -9.25696796e-04, -2.93868555e-03, -4.95167431e-03, -6.96466307e-03, -8.97765183e-03, -1.09906406e-02, -2.77547462e-02, -5.01182561e-02, -7.24817661e-02, -9.48452761e-02, -1.14820799e-01, -1.06503073e-01, -9.81853479e-02, -8.98676222e-02, -8.15498966e-02, -7.32321710e-02, -6.49144454e-02, -5.65967198e-02, -4.82789942e-02, -3.99612686e-02, -3.16435430e-02, -2.33258174e-02, -1.50080918e-02, -6.69036622e-03,  1.62735939e-03,  7.69594178e-03,  1.03217422e-02,  1.29475426e-02,  1.55733430e-02,  1.81991434e-02,  2.08249439e-02,  2.34507443e-02,  2.60765447e-02,  2.87023451e-02,  3.13281455e-02,  3.39539459e-02,  2.76705320e-02,  1.84795367e-02,  1.07045905e-02,  8.45510316e-03,  6.20561577e-03,  3.95612838e-03,  1.70664099e-03, -5.42846402e-04, -2.79233379e-03, -5.04182118e-03, -6.82120441e-03, -5.87712663e-03, -4.93304884e-03, -3.98897106e-03, -3.04489327e-03, -2.10081549e-03, -1.42854691e-03, -1.13836157e-03, -6.67190168e-04, -9.28975284e-05,  2.00623103e-04,  4.38084425e-04,  3.58971200e-04,  2.79857975e-04,  2.00744749e-04,  1.21631524e-04,  4.25182993e-05, -3.65949258e-05, -9.50629176e-05, -1.09903719e-04, -1.24744521e-04, -1.39585323e-04, -1.54426124e-04, -9.34998944e-05,  6.95219545e-05,  2.00179423e-04,  3.09164101e-04,  4.04041125e-04,  4.90155067e-04,  5.70866075e-04,  6.48300409e-04,  7.23946717e-04,  7.98701979e-04,  8.73145612e-04,  9.47595740e-04,  1.02297121e-03};
float SS_servo2[] = { 6.65909111e-03,  6.37811324e-03,  5.95890975e-03,  5.55255107e-03,  5.15654192e-03,  4.76785943e-03,  4.38371636e-03,  4.00128888e-03,  3.61750466e-03,  3.22888717e-03,  2.83137051e-03,  2.42006990e-03,  1.98898738e-03,  1.53035170e-03,  1.03425394e-03,  4.88577006e-04, -1.23503660e-04, -8.23556321e-04, -1.63881272e-03, -2.60550457e-03, -3.77046193e-03, -5.19193821e-03, -6.94958886e-03, -4.61125471e-03,  3.06074406e-04,  5.22340352e-03,  4.39030195e-03,  5.30993928e-04, -3.32831409e-03, -7.18762211e-03, -1.10469301e-02, -1.49062381e-02, -1.87655462e-02, -2.26248542e-02, -2.64841622e-02, -2.76466282e-02, -2.13587035e-02, -1.50707789e-02, -8.78285422e-03, -2.49492958e-03,  3.79299506e-03,  1.00809197e-02,  2.06229843e-02,  3.61423298e-02,  5.16616754e-02,  5.95781446e-02,  5.61258043e-02,  5.26734640e-02,  4.92211237e-02,  4.57687834e-02,  4.23164431e-02,  3.88641028e-02,  3.54117625e-02,  3.19594222e-02,  2.85070819e-02,  1.74954161e-02,  3.71799305e-03, -1.00594300e-02, -2.38368531e-02, -3.76142762e-02, -5.13916993e-02, -6.51691223e-02, -4.94649651e-02, -2.25698388e-02,  4.32528754e-03,  3.12204138e-02,  5.56185302e-02,  5.04316774e-02,  4.52448246e-02,  4.00579718e-02,  3.48711190e-02,  2.96842662e-02,  2.44974135e-02,  1.93105607e-02,  1.41237079e-02,  8.93685506e-03,  3.75000227e-03, -1.43685053e-03, -6.62370332e-03, -1.18105561e-02, -1.69974089e-02, -1.92758979e-02, -1.71025305e-02, -1.49291631e-02, -1.27557957e-02, -1.05824283e-02, -8.40906096e-03, -6.23569357e-03, -4.06232618e-03, -1.88895880e-03,  2.84408592e-04,  2.45777598e-03,  2.03532717e-02,  4.33797886e-02,  6.37726861e-02,  7.38891363e-02,  8.40055864e-02,  9.41220365e-02,  1.04238487e-01,  1.14354937e-01,  1.24471387e-01,  1.34587837e-01,  1.42184732e-01,  1.35185052e-01,  1.28185373e-01,  1.21185693e-01,  1.14186014e-01,  1.07186334e-01,  9.81674527e-02,  8.46325603e-02,  7.10849423e-02,  5.89765996e-02,  5.01034955e-02,  4.20720378e-02,  3.87934711e-02,  3.55149043e-02,  3.22363376e-02,  2.89577709e-02,  2.56792041e-02,  2.24006374e-02,  1.99197173e-02,  1.91243720e-02,  1.83290267e-02,  1.75336814e-02,  1.67383361e-02,  1.57130728e-02,  1.44300813e-02,  1.33272016e-02,  1.23663083e-02,  1.15200182e-02,  1.07638208e-02,  1.00795583e-02,  9.45391101e-03,  8.87541455e-03,  8.33566594e-03,  7.82796566e-03,  7.34698241e-03,  6.88770692e-03};
float SS_servo3[] = {-1.33694636e-03, -1.27534977e-03, -1.18750972e-03, -1.10305751e-03, -1.01889165e-03, -9.32480479e-04, -8.41282878e-04, -7.42539870e-04, -6.33002302e-04, -5.08657063e-04, -3.64399496e-04, -1.93622956e-04,  1.23089170e-05,  2.65156440e-04,  5.80491745e-04,  9.78105559e-04,  1.48629470e-03,  2.14188761e-03,  2.99185832e-03,  4.09938994e-03,  5.54652126e-03,  7.43570798e-03,  9.89800952e-03,  4.85861899e-03, -4.90801702e-03, -1.46746530e-02, -1.43021961e-02, -8.59396688e-03, -2.88573768e-03,  2.82249152e-03,  8.53072072e-03,  1.42389499e-02,  1.99471791e-02,  2.56554083e-02,  3.13636375e-02,  3.17720069e-02,  1.75387974e-02,  3.30558798e-03, -1.09276215e-02, -2.51608309e-02, -3.93940404e-02, -5.36272498e-02, -7.64104098e-02, -1.09196886e-01, -1.41983362e-01, -1.53066056e-01, -1.31694432e-01, -1.10322808e-01, -8.89511848e-02, -6.75795611e-02, -4.62079375e-02, -2.48363138e-02, -3.46469017e-03,  1.79069335e-02,  3.92785571e-02,  6.73860495e-02,  9.79580181e-02,  1.28529987e-01,  1.59101955e-01,  1.89673924e-01,  2.20245893e-01,  2.50817861e-01,  2.15147795e-01,  1.54332789e-01,  9.35177824e-02,  3.27027762e-02, -2.31512284e-02, -2.02264989e-02, -1.73017695e-02, -1.43770400e-02, -1.14523106e-02, -8.52758115e-03, -5.60285170e-03, -2.67812225e-03,  2.46607197e-04,  3.17133665e-03,  6.09606609e-03,  9.02079554e-03,  1.19455250e-02,  1.48702544e-02,  1.77949839e-02,  1.48158917e-02,  2.79977135e-03, -9.21634904e-03, -2.12324694e-02, -3.32485898e-02, -4.52647102e-02, -5.72808306e-02, -6.92969510e-02, -8.13130714e-02, -9.33291917e-02, -1.05345312e-01, -1.45673622e-01, -1.95241802e-01, -2.37160576e-01, -2.49231172e-01, -2.61301768e-01, -2.73372365e-01, -2.85442961e-01, -2.97513558e-01, -3.09584154e-01, -3.21654751e-01, -3.27545344e-01, -2.97633235e-01, -2.67721127e-01, -2.37809018e-01, -2.07896909e-01, -1.77984801e-01, -1.45266998e-01, -1.11576732e-01, -8.13682454e-02, -5.91502124e-02, -4.54206767e-02, -3.31549878e-02, -2.91558399e-02, -2.51566921e-02, -2.11575442e-02, -1.71583963e-02, -1.31592485e-02, -9.16010064e-03, -6.45066502e-03, -6.46662948e-03, -6.48259395e-03, -6.49855841e-03, -6.51452288e-03, -6.04319077e-03, -4.94348244e-03, -4.10677413e-03, -3.46918375e-03, -2.98308453e-03, -2.60835982e-03, -2.31593293e-03, -2.08487050e-03, -1.89787381e-03, -1.74285121e-03, -1.61071759e-03, -1.49472431e-03, -1.38888786e-03};
float SS_servo4[] = { 6.15933414e-04,  3.45699569e-04, -6.04763280e-05, -4.56548554e-04, -8.43798785e-04, -1.22423859e-03, -1.59981616e-03, -1.97257140e-03, -2.34475067e-03, -2.71888028e-03, -3.09786089e-03, -3.48508849e-03, -3.88461112e-03, -4.30151055e-03, -4.74208814e-03, -5.21380392e-03, -5.72673145e-03, -6.29351508e-03, -6.93002676e-03, -7.65767655e-03, -8.50554597e-03, -9.51443467e-03, -1.07491167e-02, -1.01675716e-02, -8.40103492e-03, -6.63449829e-03, -6.93957839e-03, -8.33486204e-03, -9.73014569e-03, -1.11254293e-02, -1.25207130e-02, -1.39159966e-02, -1.53112803e-02, -1.67065639e-02, -1.81018476e-02, -1.95675452e-02, -2.12277709e-02, -2.28879966e-02, -2.45482223e-02, -2.62084479e-02, -2.78686736e-02, -2.95288993e-02, -2.94336375e-02, -2.72844813e-02, -2.51353250e-02, -2.51471446e-02, -2.83903361e-02, -3.16335276e-02, -3.48767191e-02, -3.81199106e-02, -4.13631021e-02, -4.46062936e-02, -4.78494851e-02, -5.10926766e-02, -5.43358681e-02, -5.87931928e-02, -6.36947368e-02, -6.85962807e-02, -7.34978247e-02, -7.83993686e-02, -8.33009126e-02, -8.82024565e-02, -8.54272801e-02, -7.97380827e-02, -7.40488854e-02, -6.83596880e-02, -6.27004256e-02, -5.73958363e-02, -5.20912470e-02, -4.67866577e-02, -4.14820684e-02, -3.61774791e-02, -3.08728898e-02, -2.55683005e-02, -2.02637112e-02, -1.49591219e-02, -9.65453256e-03, -4.34994326e-03,  9.54646037e-04,  6.25923534e-03,  1.15638246e-02,  1.65772250e-02,  2.11449002e-02,  2.57125754e-02,  3.02802505e-02,  3.48479257e-02,  3.94156008e-02,  4.39832760e-02,  4.85509511e-02,  5.31186263e-02,  5.76863015e-02,  6.22539766e-02,  6.39627193e-02,  6.47384304e-02,  6.49564078e-02,  6.29980942e-02,  6.10397806e-02,  5.90814670e-02,  5.71231534e-02,  5.51648398e-02,  5.32065262e-02,  5.12482126e-02,  4.91368412e-02,  4.61387582e-02,  4.31406751e-02,  4.01425921e-02,  3.71445091e-02,  3.41464260e-02,  3.13248692e-02,  2.88654864e-02,  2.63615203e-02,  2.39720156e-02,  2.19752308e-02,  2.00970188e-02,  1.88884033e-02,  1.76797878e-02,  1.64711723e-02,  1.52625568e-02,  1.40539414e-02,  1.28453259e-02,  1.17677236e-02,  1.09669766e-02,  1.01662295e-02,  9.36548245e-03,  8.56473539e-03,  7.75110446e-03,  6.95888776e-03,  6.22753799e-03,  5.54643604e-03,  4.90889576e-03,  4.30842150e-03,  3.74017352e-03,  3.20058691e-03,  2.68634417e-03,  2.19482731e-03,  1.72373052e-03,  1.27103376e-03,  8.34418472e-04};
float SS_servo5[] = { 4.28247418e-04,  4.68782925e-04,  5.31083203e-04,  5.95363194e-04,  6.62347970e-04,  7.32588320e-04,  8.06981921e-04,  8.86752548e-04,  9.73531814e-04,  1.06947193e-03,  1.17739555e-03,  1.30099364e-03,  1.44508381e-03,  1.61615866e-03,  1.82272502e-03,  2.07545403e-03,  2.38942153e-03,  2.78397941e-03,  3.28385457e-03,  3.92320374e-03,  4.74930742e-03,  5.83044114e-03,  7.26851554e-03,  5.67151445e-03,  2.07843194e-03, -1.51465057e-03, -2.17658161e-03, -1.29597263e-03, -4.15363639e-04,  4.65245347e-04,  1.34585433e-03,  2.22646332e-03,  3.10707231e-03,  3.98768129e-03,  4.86829028e-03,  5.87121331e-03,  7.21204544e-03,  8.55287756e-03,  9.89370969e-03,  1.12345418e-02,  1.25753739e-02,  1.39162061e-02,  1.19495245e-02,  6.11310054e-03,  2.76676621e-04, -2.99132122e-03, -2.41867436e-03, -1.84602751e-03, -1.27338065e-03, -7.00733796e-04, -1.28086939e-04,  4.44559917e-04,  1.01720677e-03,  1.58985363e-03,  2.16250049e-03,  8.39267271e-04, -1.17761834e-03, -3.19450394e-03, -5.21138955e-03, -7.22827515e-03, -9.24516076e-03, -1.12620464e-02, -2.78681859e-02, -5.00122880e-02, -7.21563901e-02, -9.43004921e-02, -1.14065978e-01, -1.05649247e-01, -9.72325164e-02, -8.88157855e-02, -8.03990545e-02, -7.19823235e-02, -6.35655925e-02, -5.51488616e-02, -4.67321306e-02, -3.83153996e-02, -2.98986686e-02, -2.14819377e-02, -1.30652067e-02, -4.64847570e-03,  3.76825527e-03,  9.81777493e-03,  1.22437848e-02,  1.46697946e-02,  1.70958045e-02,  1.95218143e-02,  2.19478241e-02,  2.43738340e-02,  2.67998438e-02,  2.92258537e-02,  3.16518635e-02,  3.40778733e-02,  2.77022561e-02,  1.84541693e-02,  1.06331220e-02,  8.38041810e-03,  6.12771417e-03,  3.87501024e-03,  1.62230630e-03, -6.30397629e-04, -2.88310156e-03, -5.13580549e-03, -6.92434541e-03, -6.02383743e-03, -5.12332946e-03, -4.22282148e-03, -3.32231351e-03, -2.42180553e-03, -1.80913053e-03, -1.59852428e-03, -1.20508412e-03, -6.92647956e-04, -4.21846939e-04, -1.99712642e-04, -2.52405933e-04, -3.05099224e-04, -3.57792515e-04, -4.10485806e-04, -4.63179097e-04, -5.15872387e-04, -5.53522137e-04, -5.59382107e-04, -5.65242077e-04, -5.71102047e-04, -5.76962018e-04, -5.20339245e-04, -3.81660748e-04, -2.72490878e-04, -1.82802532e-04, -1.05497033e-04, -3.57311797e-05,  2.94931218e-05,  9.20084782e-05,  1.53159750e-04,  2.13710476e-04,  2.74141920e-04,  3.34718711e-04,  3.96152798e-04};
float SS_servo6[] = { 0.00854091,  0.00824892,  0.0078122 ,  0.00738773,  0.00697353,  0.00656678,  0.00616471,  0.00576435,  0.00536235,  0.0049549 ,  0.00453751,  0.0041048 ,  0.00365024,  0.00316541,  0.00263971,  0.00206033,  0.00140969,  0.00066559, -0.00019949, -0.00122141, -0.00244512, -0.00392384, -0.00572479, -0.00363611,  0.000898  ,  0.00543211,  0.00453119,  0.00077006, -0.00299107, -0.0067522 , -0.01051333, -0.01427447, -0.0180356 , -0.02179673, -0.02555786, -0.02668582, -0.02053927, -0.01439272, -0.00824618, -0.00209963,  0.00404692,  0.01019347,  0.02049021,  0.03564263,  0.05079504,  0.05853786,  0.05520088,  0.0518639 ,  0.04852692,  0.04518994,  0.04185296,  0.03851599,  0.03517901,  0.03184203,  0.02850505,  0.01783486,  0.00448164, -0.00887158, -0.0222248 , -0.03557802, -0.04893124, -0.06228445, -0.04798456, -0.02318776,  0.00160903,  0.02640582,  0.04887664,  0.04378885,  0.03870106,  0.03361328,  0.02852549,  0.0234377 ,  0.01834992,  0.01326213,  0.00817434,  0.00308656, -0.00200123, -0.00708902, -0.0121768 , -0.01726459, -0.02235238, -0.02474601, -0.02301568, -0.02128536, -0.01955503, -0.0178247 , -0.01609438, -0.01436405, -0.01263372, -0.0109034 , -0.00917307, -0.00744274,  0.00959491,  0.03162822,  0.0508131 ,  0.05888336,  0.06695362,  0.07502388,  0.08309414,  0.0911644 ,  0.09923466,  0.10730492,  0.11324365,  0.10683374,  0.10042383,  0.09401392,  0.08760401,  0.08119409,  0.07437049,  0.06623472,  0.05780896,  0.04985745,  0.04375506,  0.03821236,  0.03583035,  0.03344834,  0.03106633,  0.02868432,  0.02630231,  0.0239203 ,  0.02203696,  0.02120743,  0.02037789,  0.01954836,  0.01871882,  0.0177091 ,  0.01649539,  0.01542267,  0.01446609,  0.0136077 ,  0.01282987,  0.01211901,  0.01146485,  0.01085805,  0.0102915 ,  0.00975927,  0.00925652,  0.0087783 };
float SS_servo7[] = {-2.16206877e-03, -2.07889296e-03, -1.95675892e-03, -1.83683803e-03, -1.71704025e-03, -1.59526066e-03, -1.46895709e-03, -1.33507951e-03, -1.18987106e-03, -1.02863980e-03, -8.45457768e-04, -6.32764438e-04, -3.80845191e-04, -7.66968344e-05,  2.96614953e-04,  7.60230961e-04,  1.34394006e-03,  2.08579687e-03,  3.03333750e-03,  4.24903540e-03,  5.81124268e-03,  7.81254804e-03,  1.03596662e-02,  5.80945272e-03, -3.20631646e-03, -1.22220856e-02, -1.17170126e-02, -6.20152632e-03, -6.86040026e-04,  4.82944627e-03,  1.03449326e-02,  1.58604188e-02,  2.13759051e-02,  2.68913914e-02,  3.24068777e-02,  3.27476832e-02,  1.87927340e-02,  4.83778471e-03, -9.11716455e-03, -2.30721138e-02, -3.70270631e-02, -5.09820123e-02, -7.34838626e-02, -1.05985461e-01, -1.38487059e-01, -1.49732044e-01, -1.29191374e-01, -1.08650704e-01, -8.81100345e-02, -6.75693647e-02, -4.70286950e-02, -2.64880253e-02, -5.94735556e-03,  1.45933142e-02,  3.51339839e-02,  6.17342014e-02,  9.05514473e-02,  1.19368693e-01,  1.48185939e-01,  1.77003185e-01,  2.05820431e-01,  2.34637677e-01,  2.01461566e-01,  1.44753279e-01,  8.80449919e-02,  3.13367050e-02, -2.07455426e-02, -1.80177433e-02, -1.52899441e-02, -1.25621449e-02, -9.83434567e-03, -7.10654644e-03, -4.37874721e-03, -1.65094799e-03,  1.07685124e-03,  3.80465047e-03,  6.53244969e-03,  9.26024892e-03,  1.19880481e-02,  1.47158474e-02,  1.74436466e-02,  1.46892156e-02,  3.54308968e-03, -7.60303621e-03, -1.87491621e-02, -2.98952880e-02, -4.10414139e-02, -5.21875398e-02, -6.33336657e-02, -7.44797916e-02, -8.56259175e-02, -9.67720434e-02, -1.38732503e-01, -1.90749426e-01, -2.32850334e-01, -2.36258712e-01, -2.39667089e-01, -2.43075467e-01, -2.46483845e-01, -2.49892222e-01, -2.53300600e-01, -2.56708978e-01, -2.54996377e-01, -2.23616345e-01, -1.92236313e-01, -1.60856280e-01, -1.29476248e-01, -9.80962156e-02, -7.31785372e-02, -6.18477809e-02, -4.98524329e-02, -3.84438667e-02, -3.01366171e-02, -2.27414730e-02, -2.04971127e-02, -1.82527523e-02, -1.60083920e-02, -1.37640316e-02, -1.15196713e-02, -9.27531092e-03, -7.73557006e-03, -7.68482030e-03, -7.63407053e-03, -7.58332077e-03, -7.53257101e-03, -7.09183249e-03, -6.12782230e-03, -5.35018958e-03, -4.72106263e-03, -4.21129101e-03, -3.79421074e-03, -3.44970903e-03, -3.16281978e-03, -2.92041167e-03, -2.71290048e-03, -2.53274151e-03, -2.37412214e-03, -2.23118200e-03};

int node=0;
int first=0;
int input=0;
int end_time=0;
int time_step=100000;
int steps = sizeof(SS_servo0)/sizeof(SS_servo0[0]);
int one_print = 0;

// -------------------Joint configurations-------------------
int servo0=0;
int servo0_deg=0;
int servo1=0;
int servo1_deg=0;
int servo2=0;
int servo2_deg=0;
int servo3=0;
int servo3_deg=0;
int servo4=0;
int servo4_deg=0;
int servo5=0;
int servo5_deg=0;
int servo6=0;
int servo6_deg=0;
int servo7=0;
int servo7_deg=0;

void setup() {
  Serial.begin(115200);
  pca9685.begin();

  pca9685.setOscillatorFrequency(27000000); //Value between 24MHz and 27MHz, tuned for this setup
  pca9685.setPWMFreq(SERVO_FREQ);
  delay (1000);

  servo0_deg=SS_servo0[0]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[0]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[0]/3.14159265*180;
        servo2=map(servo2_deg,-37,90,1500,2670);
        servo3_deg=SS_servo3[0]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[0]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[0]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[0]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[0]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        Serial.print("Node:");
        Serial.println(node);
        Serial.print("servo0 -> rads:");
        Serial.print(SS_servo0[node]);
        Serial.print("        deg:");
        Serial.print(servo0_deg);
        Serial.print("        us:");
        Serial.println(servo0);
        Serial.print("servo1 -> rads:");
        Serial.print(SS_servo1[node]);
        Serial.print("        deg:");
        Serial.print(servo1_deg);
        Serial.print("        us:");
        Serial.println(servo1);
        Serial.print("servo2 -> rads:");
        Serial.print(SS_servo2[node]);
        Serial.print("        deg:");
        Serial.print(servo2_deg);
        Serial.print("        us:");
        Serial.println(servo2);
        Serial.print("servo3 -> rads:");
        Serial.print(SS_servo3[node]);
        Serial.print("        deg:");
        Serial.print(servo3_deg);
        Serial.print("        us:");
        Serial.println(servo3);
        Serial.print("servo4 -> rads:");
        Serial.print(SS_servo4[node]);
        Serial.print("        deg:");
        Serial.print(servo4_deg);
        Serial.print("        us:");
        Serial.println(servo4);
        Serial.print("servo5 -> rads:");
        Serial.print(SS_servo5[node]);
        Serial.print("        deg:");
        Serial.print(servo5_deg);
        Serial.print("        us:");
        Serial.println(servo5);
        Serial.print("servo6 -> rads:");
        Serial.print(SS_servo6[node]);
        Serial.print("        deg:");
        Serial.print(servo6_deg);
        Serial.print("        us:");
        Serial.println(servo6);
        Serial.print("servo7 -> rads:");
        Serial.print(SS_servo7[node]);
        Serial.print("        deg:");
        Serial.print(servo7_deg);
        Serial.print("        us:");
        Serial.println(servo7);

        Serial.println("10");
        delay(1000);
        Serial.println("9");
        delay(1000);
        Serial.println("8");
        delay(1000);
        Serial.println("7");
        delay(1000);
        Serial.println("6");
        delay(1000);
        Serial.println("5");
        delay(1000);
        Serial.println("4");
        delay(1000);
        Serial.println("3");
        delay(1000);
        Serial.println("2");
        delay(1000);
        Serial.println("1");
        delay(1000);

}

void loop() 
{
  if(Serial.available()>0)
  {
    first=Serial.read();
    if(first=='2')
    {
      input=2;
      node=0;
      one_print=1;
    }
    if(first=='1')
    {
      input=1;
      node=0;
      one_print=1;
    }
    if(first=='0')
    {
      input=0;
    }
  }
  if(input==1 or input==2)
  {
      if(esp_timer_get_time()>=end_time)
      {
        servo0_deg=SS_servo0[node]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[node]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[node]/3.14159265*180;
        servo2=map(servo2_deg,-37,90,1500,2670);
        servo3_deg=SS_servo3[node]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[node]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[node]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[node]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[node]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);
        
        node+=1;
        if(node>=steps and input==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          node=0;
        }
        if(node>=steps and input==2)
        {
          Serial.print("Input:");
          Serial.println(input);
          input=0;
        }
         end_time=esp_timer_get_time()+time_step;
      }
   }

  if(input == 0)
  {        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        if(one_print==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          Serial.print("Node:");
          Serial.println(node);
          Serial.print("servo0 -> rads:");
          Serial.print(SS_servo0[node]);
          Serial.print("        deg:");
          Serial.print(servo0_deg);
          Serial.print("        us:");
          Serial.println(servo0);
          Serial.print("servo1 -> rads:");
          Serial.print(SS_servo1[node]);
          Serial.print("        deg:");
          Serial.print(servo1_deg);
          Serial.print("        us:");
          Serial.println(servo1);
          Serial.print("servo2 -> rads:");
          Serial.print(SS_servo2[node]);
          Serial.print("        deg:");
          Serial.print(servo2_deg);
          Serial.print("        us:");
          Serial.println(servo2);
          Serial.print("servo3 -> rads:");
          Serial.print(SS_servo3[node]);
          Serial.print("        deg:");
          Serial.print(servo3_deg);
          Serial.print("        us:");
          Serial.println(servo3);
          Serial.print("servo4 -> rads:");
          Serial.print(SS_servo4[node]);
          Serial.print("        deg:");
          Serial.print(servo4_deg);
          Serial.print("        us:");
          Serial.println(servo4);
          Serial.print("servo5 -> rads:");
          Serial.print(SS_servo5[node]);
          Serial.print("        deg:");
          Serial.print(servo5_deg);
          Serial.print("        us:");
          Serial.println(servo5);
          Serial.print("servo6 -> rads:");
          Serial.print(SS_servo6[node]);
          Serial.print("        deg:");
          Serial.print(servo6_deg);
          Serial.print("        us:");
          Serial.println(servo6);
          Serial.print("servo7 -> rads:");
          Serial.print(SS_servo7[node]);
          Serial.print("        deg:");
          Serial.print(servo7_deg);
          Serial.print("        us:");
          Serial.println(servo7);
          one_print=0;
        }
  
  }
}
