// HOW TO:
// ------------------------------
// Serial input = 2 -> Steps through gait sequence once and stops at the end.
// Serial input = 1 -> Steps through gait sequence in a loop.
// Serial input = 0 -> Stops infinite loop at the node where it is at that moment

//Gait template
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pca9685 = Adafruit_PWMServoDriver();

#define SERVO_FREQ 300
#define SER0 0 //Hip 1
#define SER1 1 //Knee 1
#define SER2 2 //Hip 2
#define SER3 3 //Knee 2
#define SER4 4 //Hip 3
#define SER5 5 //Knee 3
#define SER6 6 //Hip 4
#define SER7 7 //Knee 4

// Insert servo angles here:
// For 3D gaits, these angles are obtained from linearisation.py
// For 2D gaits, these angles are obtained from 2D_trajectory_reader.py
float SS_servo0[] = { 0.00518759,  0.00482046,  0.003832  ,  0.00292342,  0.00204991,  0.00116262,  0.00018736, -0.00117613, -0.00285438, -0.00479353, -0.00810544, -0.01242684, -0.01779439, -0.02316193, -0.02559412, -0.02737525, -0.02915638, -0.03093751, -0.03271864, -0.03449977, -0.0362809 , -0.03806203, -0.03866841, -0.03730916, -0.0359499 , -0.03459065, -0.0332314 , -0.03187215, -0.0284048 , -0.01874764, -0.01127567, -0.01195039, -0.0126251 , -0.01329982, -0.01397453, -0.01464924, -0.01532396, -0.00796887,  0.00195153,  0.01187193,  0.02179234,  0.03245327,  0.05155598,  0.0706587 ,  0.08976142,  0.09423672,  0.08940021,  0.0845637 ,  0.07972719,  0.07489068,  0.07005416,  0.06521765,  0.06038114,  0.05554463,  0.05070812,  0.0458716 ,  0.03471688,  0.02013641,  0.00555595, -0.00902451, -0.02360497, -0.03818544, -0.0527659 , -0.06734636, -0.07892463, -0.0627439 , -0.03551777, -0.00829164,  0.01893448,  0.04462215,  0.03802785,  0.03143355,  0.02483924,  0.01824494,  0.01165063,  0.00505633, -0.00153798, -0.00813228, -0.01472659, -0.02132089, -0.0279152 , -0.0345095 , -0.04110381, -0.04769811, -0.05284344, -0.05529178, -0.05774012, -0.06018846, -0.06263679, -0.06508513, -0.06753347, -0.06998181, -0.07243015, -0.07487849, -0.07732682, -0.06783915, -0.05799847, -0.04615124, -0.0316057 , -0.01706016, -0.00251462,  0.00937214,  0.0157749 ,  0.02217766,  0.02858042,  0.03498318,  0.04138594,  0.0477887 ,  0.05419146,  0.06059422,  0.06699698,  0.07339974,  0.0798025 ,  0.08620526,  0.09260802,  0.09469483,  0.09285763,  0.09102044,  0.08918324,  0.08734605,  0.08550885,  0.08367165,  0.08183446,  0.07999726,  0.07816007,  0.07551057,  0.07951542,  0.0890767 ,  0.09863798,  0.10819925,  0.10424746,  0.09892234,  0.09359721,  0.08827209,  0.08294696,  0.07762183,  0.07229671,  0.06697158,  0.06164646,  0.05632133,  0.05099621,  0.04834649,  0.04843915,  0.04853182,  0.04862448,  0.04871715,  0.04880981,  0.04890248,  0.04899514,  0.05146131,  0.06359312,  0.076375  ,  0.08915689,  0.09601698,  0.09800227,  0.09998756,  0.10197285,  0.10395813,  0.10594342,  0.10792871,  0.109914  ,  0.11077032,  0.10189449,  0.09301866,  0.08414284,  0.07526701,  0.06639118,  0.05751535,  0.04513795,  0.03865328,  0.03231663,  0.02785778,  0.02565735,  0.02345693,  0.02125651,  0.01905609,  0.01685567,  0.01465525,  0.01245483,  0.01135668,  0.01142907,  0.01150146,  0.01157385,  0.01164624,  0.01171863,  0.0119741 ,  0.01230455,  0.012635  ,  0.01252322,  0.01233966,  0.0121561 ,  0.01197254,  0.01178898,  0.01160542,  0.01142186,  0.01123829,  0.01105473,  0.01030329,  0.00945803,  0.00861276,  0.0077675 ,  0.00692224,  0.00607697};    
float SS_servo1[] = {-5.19389812e-03, -4.65714247e-03, -3.21912227e-03, -1.91231198e-03, -6.54711350e-04,  6.47043049e-04,  2.13108610e-03,  4.35482624e-03,  7.16631822e-03,  1.04627127e-02,  1.63105631e-02,  2.37334917e-02,  3.27886860e-02,  4.18438804e-02,  4.56909777e-02,  4.83829231e-02,  5.10748685e-02,  5.37668139e-02,  5.64587594e-02,  5.91507048e-02,  6.18426502e-02,  6.45345956e-02,  6.47546373e-02,  6.08385818e-02,  5.69225262e-02,  5.30064707e-02,  4.90904152e-02,  4.51743597e-02,  3.71502071e-02,  1.70637700e-02,  1.05718652e-03,  2.60744628e-04, -5.35697262e-04, -1.33213915e-03, -2.12858104e-03, -2.92502293e-03, -3.72146482e-03, -1.93262018e-02, -3.96618045e-02, -5.99974073e-02, -8.03330101e-02, -1.01671830e-01, -1.34446986e-01, -1.67222142e-01, -1.99997298e-01, -1.98653145e-01, -1.75588609e-01, -1.52524074e-01, -1.29459538e-01, -1.06395003e-01, -8.33304669e-02, -6.02659314e-02, -3.72013958e-02, -1.41368602e-02,  8.92767532e-03,  3.19922109e-02,  5.88246914e-02,  8.77001520e-02,  1.16575613e-01,  1.45451073e-01,  1.74326534e-01,  2.03201994e-01,  2.32077455e-01,  2.60952915e-01,  2.73034941e-01,  2.29522311e-01,  1.66571732e-01,  1.03621152e-01,  4.06705734e-02, -1.92943130e-02, -1.66094052e-02, -1.39244975e-02, -1.12395897e-02, -8.55468196e-03, -5.86977421e-03, -3.18486646e-03, -4.99958706e-04,  2.18494905e-03,  4.86985680e-03,  7.55476455e-03,  1.02396723e-02,  1.29245801e-02,  1.56094878e-02,  1.82943956e-02,  1.62520737e-02,  5.41091048e-03, -5.43025273e-03, -1.62714159e-02, -2.71125791e-02, -3.79537424e-02, -4.87949056e-02, -5.96360688e-02, -7.04772320e-02, -8.13183952e-02, -9.21595584e-02, -1.26840600e-01, -1.56468306e-01, -1.74552884e-01, -1.93230162e-01, -2.11907440e-01, -2.30584718e-01, -2.38206991e-01, -2.23027325e-01, -2.07847658e-01, -1.92667992e-01, -1.77488326e-01, -1.62308660e-01, -1.47128994e-01, -1.31949327e-01, -1.16769661e-01, -1.01589995e-01, -8.64103287e-02, -7.12306625e-02, -5.60509962e-02, -4.08713300e-02, -2.50000652e-02, -8.50000929e-03,  8.00004661e-03,  2.45001025e-02,  4.10001584e-02,  5.75002143e-02,  7.40002702e-02,  9.05003261e-02,  1.07000382e-01,  1.23500438e-01,  1.30198036e-01,  1.08668696e-01,  7.43780499e-02,  4.00874036e-02,  5.79675730e-03,  2.60660364e-03,  2.57720401e-03,  2.54780438e-03,  2.51840476e-03,  2.48900513e-03,  2.45960551e-03,  2.43020588e-03,  2.40080625e-03,  2.37140663e-03,  2.34200700e-03,  2.31260738e-03, -7.22810970e-04, -6.83949209e-03, -1.29561732e-02, -1.90728543e-02, -2.51895354e-02, -3.13062166e-02, -3.74228977e-02, -4.35395788e-02, -5.40618083e-02, -8.13572324e-02, -1.05923761e-01, -1.30490290e-01, -1.43550008e-01, -1.47137353e-01, -1.50724699e-01, -1.54312045e-01, -1.57899391e-01, -1.61486737e-01, -1.65074083e-01, -1.68661429e-01, -1.70203503e-01, -1.54114491e-01, -1.38025478e-01, -1.21936466e-01, -1.05847454e-01, -8.97584412e-02, -7.36694288e-02, -5.19599976e-02, -4.08355701e-02, -2.99795408e-02, -2.26698319e-02, -1.96252749e-02, -1.65807180e-02, -1.35361611e-02, -1.04916041e-02, -7.44704722e-03, -4.40249029e-03, -1.35793336e-03, -4.51170841e-04, -1.81461132e-03, -3.17805179e-03, -4.54149226e-03, -5.90493274e-03, -7.26837321e-03, -8.73525931e-03, -1.02445039e-02, -1.17537486e-02, -1.21169269e-02, -1.22940631e-02, -1.24711994e-02, -1.26483356e-02, -1.28254719e-02, -1.30026081e-02, -1.31797444e-02, -1.33568806e-02, -1.35340169e-02, -1.25222599e-02, -1.13140801e-02, -1.01059004e-02, -8.89772059e-03, -7.68954081e-03, -6.48136103e-03};
float SS_servo2[] = { 5.61548049e-04,  4.77898315e-04,  3.04924045e-04,  3.15300368e-04,  4.90195488e-04,  8.49574072e-04,  1.40408764e-03,  2.16798706e-03,  2.95298198e-03,  3.73907413e-03,  4.53093964e-03,  2.44367856e-03, -2.62724357e-03, -7.69816571e-03, -8.61638576e-03, -8.61353974e-03, -8.61069372e-03, -8.60784770e-03, -8.60500168e-03, -8.60215567e-03, -8.59930965e-03, -8.59646363e-03, -1.00528794e-02, -1.39509957e-02, -1.78491120e-02, -2.17472283e-02, -2.56453446e-02, -2.95434609e-02, -3.45418145e-02, -4.27707087e-02, -5.03939887e-02, -5.57594722e-02, -6.11249558e-02, -6.64904393e-02, -7.18559228e-02, -7.72214064e-02, -8.25868899e-02, -8.20086105e-02, -7.95314532e-02, -7.70542959e-02, -7.45771386e-02, -7.11656577e-02, -5.71032051e-02, -4.30407524e-02, -2.89782997e-02, -2.53779880e-02, -2.84378847e-02, -3.14977813e-02, -3.45576780e-02, -3.76175747e-02, -4.06774713e-02, -4.37373680e-02, -4.67972647e-02, -4.98571614e-02, -5.29170580e-02, -5.59769547e-02, -5.89882315e-02, -6.19731466e-02, -6.49580618e-02, -6.79429769e-02, -7.09278920e-02, -7.39128071e-02, -7.68977223e-02, -7.98826374e-02, -7.63872897e-02, -6.26805699e-02, -4.67179152e-02, -3.07552605e-02, -1.47926058e-02,  6.12730427e-04,  4.32366569e-03,  8.03460096e-03,  1.17455362e-02,  1.54564715e-02,  1.91674068e-02,  2.28783420e-02,  2.65892773e-02,  3.03002126e-02,  3.40111478e-02,  3.77220831e-02,  4.14330184e-02,  4.51439536e-02,  4.88548889e-02,  5.25658242e-02,  5.37276167e-02,  5.01446635e-02,  4.65617103e-02,  4.29787571e-02,  3.93958039e-02,  3.58128507e-02,  3.22298975e-02,  2.86469444e-02,  2.50639912e-02,  2.14810380e-02,  1.78980848e-02,  8.23707304e-03, -1.48122632e-02, -7.97396391e-03,  1.52461635e-02,  3.84662909e-02,  6.16864182e-02,  7.43226678e-02,  6.51287192e-02,  5.59347707e-02,  4.67408222e-02,  3.75468737e-02,  2.83529251e-02,  1.91589766e-02,  9.96502808e-03,  7.71079557e-04, -8.42286897e-03, -1.76168175e-02, -2.68107660e-02, -3.60047145e-02, -4.51986631e-02, -4.98998517e-02, -5.05162908e-02, -5.11327299e-02, -5.17491690e-02, -5.23656081e-02, -5.29820472e-02, -5.35984863e-02, -5.42149254e-02, -5.48313645e-02, -5.54478036e-02, -4.59990575e-02, -3.24428941e-02, -2.06983536e-02, -8.95381318e-03,  2.79072728e-03,  9.69193909e-03,  1.61009217e-02,  2.25099043e-02,  2.89188869e-02,  3.53278695e-02,  4.17368521e-02,  4.81458348e-02,  5.45548174e-02,  6.09638000e-02,  6.73727826e-02,  7.37817652e-02,  7.57423704e-02,  7.31432502e-02,  7.05441300e-02,  6.79450098e-02,  6.53458896e-02,  6.27467694e-02,  6.01476492e-02,  5.75485290e-02,  5.39486474e-02,  4.83256144e-02,  4.76053699e-02,  4.68851253e-02,  4.52068725e-02,  4.27399902e-02,  4.02731079e-02,  3.78062256e-02,  3.53393433e-02,  3.28724610e-02,  3.04055787e-02,  2.79386964e-02,  2.57944190e-02,  2.64311289e-02,  2.70678387e-02,  2.77045485e-02,  2.83412583e-02,  2.89779681e-02,  2.96146779e-02,  3.44914748e-02,  4.14667590e-02,  4.84715364e-02,  5.26711596e-02,  5.34970300e-02,  5.43229004e-02,  5.51487708e-02,  5.59746412e-02,  5.68005115e-02,  5.76263819e-02,  5.84522523e-02,  5.59463103e-02,  4.99021936e-02,  4.38580768e-02,  3.78139600e-02,  3.17698432e-02,  2.57257264e-02,  2.07836652e-02,  1.62928698e-02,  1.18020743e-02,  1.01065317e-02,  8.86474508e-03,  7.62295851e-03,  6.38117194e-03,  5.13938537e-03,  3.89759880e-03,  2.65581222e-03,  1.41402565e-03,  1.72239082e-04,  8.38695001e-05,  1.86061560e-04,  2.88253619e-04,  3.90445679e-04,  4.92637738e-04,  5.94829798e-04};
float SS_servo3[] = {-2.78966829e-03, -2.80807357e-03, -2.96702695e-03, -3.45983764e-03, -4.25537184e-03, -5.39502014e-03, -6.90679966e-03, -8.84924443e-03, -1.08616597e-02, -1.29022388e-02, -1.50910100e-02, -1.20427287e-02, -3.56724965e-03,  4.90822944e-03,  5.79247979e-03,  4.99300154e-03,  4.19352329e-03,  3.39404505e-03,  2.59456680e-03,  1.79508855e-03,  9.95610302e-04,  1.96132054e-04,  2.08170610e-03,  8.46002679e-03,  1.48383475e-02,  2.12166682e-02,  2.75949889e-02,  3.39733096e-02,  4.25175664e-02,  5.74214925e-02,  7.09398799e-02,  7.92928275e-02,  8.76457752e-02,  9.59987228e-02,  1.04351670e-01,  1.12704618e-01,  1.21057566e-01,  1.18711167e-01,  1.12946606e-01,  1.07182044e-01,  1.01417483e-01,  9.39089493e-02,  6.65197286e-02,  3.91305080e-02,  1.17412874e-02,  1.28944843e-03,  1.61996207e-03,  1.95047570e-03,  2.28098933e-03,  2.61150296e-03,  2.94201659e-03,  3.27253022e-03,  3.60304386e-03,  3.93355749e-03,  4.26407112e-03,  4.59458475e-03,  6.43756981e-04, -5.62841448e-03, -1.19005859e-02, -1.81727574e-02, -2.44449288e-02, -3.07171003e-02, -3.69892718e-02, -4.32614432e-02, -6.39061361e-02, -9.74529398e-02, -1.31960796e-01, -1.66468652e-01, -2.00976509e-01, -2.33276330e-01, -2.19244205e-01, -2.05212079e-01, -1.91179954e-01, -1.77147829e-01, -1.63115703e-01, -1.49083578e-01, -1.35051453e-01, -1.21019327e-01, -1.06987202e-01, -9.29550765e-02, -7.89229512e-02, -6.48908258e-02, -5.08587005e-02, -3.68265751e-02, -2.10927561e-02, -2.19155710e-03,  1.67096419e-02,  3.56108409e-02,  5.45120400e-02,  7.34132390e-02,  9.23144380e-02,  1.11215637e-01,  1.30116836e-01,  1.49018035e-01,  1.67919234e-01,  1.76792211e-01,  2.01853750e-01,  1.72851883e-01,  1.13969231e-01,  5.50865792e-02, -3.79607260e-03, -4.16489513e-02, -3.61260356e-02, -3.06031200e-02, -2.50802043e-02, -1.95572886e-02, -1.40343730e-02, -8.51145731e-03, -2.98854165e-03,  2.53437402e-03,  8.05728968e-03,  1.35802054e-02,  1.91031210e-02,  2.46260367e-02,  3.01489523e-02,  2.46385572e-02,  9.09684201e-03, -6.44487316e-03, -2.19865883e-02, -3.75283035e-02, -5.30700187e-02, -6.86117338e-02, -8.41534490e-02, -9.96951642e-02, -1.15236879e-01, -1.51008836e-01, -1.71951836e-01, -1.71279448e-01, -1.70607060e-01, -1.69934673e-01, -1.64047659e-01, -1.57630682e-01, -1.51213704e-01, -1.44796727e-01, -1.38379749e-01, -1.31962772e-01, -1.25545794e-01, -1.19128817e-01, -1.12711839e-01, -1.06294861e-01, -9.98778839e-02, -9.19725026e-02, -8.25414611e-02, -7.31104196e-02, -6.36793781e-02, -5.42483366e-02, -4.48172952e-02, -3.53862537e-02, -2.59552122e-02, -1.66047001e-02, -1.00099707e-02, -1.20206370e-02, -1.40313032e-02, -1.41036116e-02, -1.25802698e-02, -1.10569279e-02, -9.53358604e-03, -8.01024418e-03, -6.48690232e-03, -4.96356046e-03, -3.44021860e-03, -2.50809539e-03, -6.67251922e-03, -1.08369430e-02, -1.50013669e-02, -1.91657907e-02, -2.33302145e-02, -2.74946384e-02, -3.95897826e-02, -5.47440012e-02, -6.99328093e-02, -7.94775877e-02, -8.22343034e-02, -8.49910191e-02, -8.77477348e-02, -9.05044505e-02, -9.32611661e-02, -9.60178818e-02, -9.87745975e-02, -9.49943734e-02, -8.42723310e-02, -7.35502886e-02, -6.28282462e-02, -5.21062038e-02, -4.13841614e-02, -3.26415440e-02, -2.47094545e-02, -1.67773650e-02, -1.40390871e-02, -1.21439257e-02, -1.02487643e-02, -8.35360298e-03, -6.45844161e-03, -4.56328025e-03, -2.66811889e-03, -7.72957521e-04,  1.12220384e-03,  8.35465654e-04,  1.88245206e-04, -4.58975242e-04, -1.10619569e-03, -1.75341614e-03, -2.40063659e-03};
float SS_servo4[] = { 6.39698018e-04,  5.60093270e-04,  4.00436096e-04,  4.26224320e-04,  6.14666930e-04,  9.97213985e-04,  1.58240663e-03,  2.37440326e-03,  3.18041378e-03,  3.98431106e-03,  4.77708890e-03,  2.66195393e-03, -2.46667349e-03, -7.59530090e-03, -8.52241503e-03, -8.51763679e-03, -8.51285855e-03, -8.50808031e-03, -8.50330207e-03, -8.49852384e-03, -8.49374560e-03, -8.48896736e-03, -9.95734629e-03, -1.38906761e-02, -1.78240058e-02, -2.17573356e-02, -2.56906654e-02, -2.96239951e-02, -3.46697096e-02, -4.29816325e-02, -5.06715294e-02, -5.60424453e-02, -6.14133613e-02, -6.67842772e-02, -7.21551931e-02, -7.75261090e-02, -8.28970249e-02, -8.22603476e-02, -7.97044003e-02, -7.71484530e-02, -7.45925056e-02, -7.11103033e-02, -5.70691081e-02, -4.30279129e-02, -2.89867177e-02, -2.53861585e-02, -2.84321177e-02, -3.14780768e-02, -3.45240360e-02, -3.75699951e-02, -4.06159543e-02, -4.36619134e-02, -4.67078726e-02, -4.97538317e-02, -5.27997909e-02, -5.58457500e-02, -5.88664027e-02, -6.18733341e-02, -6.48802656e-02, -6.78871971e-02, -7.08941286e-02, -7.39010600e-02, -7.69079915e-02, -7.99149230e-02, -7.64799991e-02, -6.28806744e-02, -4.70305427e-02, -3.11804109e-02, -1.53302792e-02, -3.31359474e-05,  3.66046400e-03,  7.35406394e-03,  1.10476639e-02,  1.47412638e-02,  1.84348638e-02,  2.21284637e-02,  2.58220637e-02,  2.95156636e-02,  3.32092635e-02,  3.69028635e-02,  4.05964634e-02,  4.42900634e-02,  4.79836633e-02,  5.16772633e-02,  5.28432257e-02,  4.93044704e-02,  4.57657151e-02,  4.22269598e-02,  3.86882045e-02,  3.51494493e-02,  3.16106940e-02,  2.80719387e-02,  2.45331834e-02,  2.09944281e-02,  1.74556728e-02,  7.81486020e-03, -1.52460763e-02, -8.38176326e-03,  1.48943460e-02,  3.81704553e-02,  6.14465646e-02,  7.41151008e-02,  6.49045654e-02,  5.56940301e-02,  4.64834947e-02,  3.72729594e-02,  2.80624240e-02,  1.88518887e-02,  9.64135334e-03,  4.30817995e-04, -8.77971735e-03, -1.79902527e-02, -2.72007880e-02, -3.64113234e-02, -4.56218587e-02, -5.03038771e-02, -5.08686360e-02, -5.14333949e-02, -5.19981538e-02, -5.25629127e-02, -5.31276717e-02, -5.36924306e-02, -5.42571895e-02, -5.48219484e-02, -5.53867073e-02, -4.58399626e-02, -3.21846937e-02, -2.03728518e-02, -8.56100992e-03,  3.25083197e-03,  1.01725989e-02,  1.65973858e-02,  2.30221727e-02,  2.94469595e-02,  3.58717464e-02,  4.22965333e-02,  4.87213202e-02,  5.51461071e-02,  6.15708940e-02,  6.79956808e-02,  7.44204677e-02,  7.63802502e-02,  7.37632641e-02,  7.11462780e-02,  6.85292919e-02,  6.59123058e-02,  6.32953197e-02,  6.06783336e-02,  5.80613475e-02,  5.44431988e-02,  4.87966263e-02,  4.80360278e-02,  4.72754292e-02,  4.55788743e-02,  4.31118431e-02,  4.06448119e-02,  3.81777807e-02,  3.57107495e-02,  3.32437183e-02,  3.07766871e-02,  2.83096559e-02,  2.61626065e-02,  2.67739306e-02,  2.73852547e-02,  2.79965789e-02,  2.86079030e-02,  2.92192272e-02,  2.98305513e-02,  3.46359082e-02,  4.15347385e-02,  4.84631178e-02,  5.26117839e-02,  5.34172949e-02,  5.42228059e-02,  5.50283169e-02,  5.58338279e-02,  5.66393389e-02,  5.74448500e-02,  5.82503610e-02,  5.57499707e-02,  4.97389214e-02,  4.37278722e-02,  3.77168229e-02,  3.17057737e-02,  2.56947244e-02,  2.07789928e-02,  1.63117680e-02,  1.18445431e-02,  1.01552691e-02,  8.91694250e-03,  7.67861593e-03,  6.44028936e-03,  5.20196279e-03,  3.96363622e-03,  2.72530964e-03,  1.48698307e-03,  2.48656500e-04,  1.60641645e-04,  2.62675394e-04,  3.64709142e-04,  4.66742891e-04,  5.68776640e-04,  6.70810389e-04};
float SS_servo5[] = {-2.79843907e-03, -2.82476572e-03, -3.00979826e-03, -3.53279019e-03, -4.35485432e-03, -5.53987417e-03, -7.11173378e-03, -9.10920280e-03, -1.11627743e-02, -1.32382224e-02, -1.54287809e-02, -1.23259179e-02, -3.73744142e-03,  4.85103508e-03,  5.75270900e-03,  4.94945611e-03,  4.14620323e-03,  3.34295034e-03,  2.53969746e-03,  1.73644457e-03,  9.33191690e-04,  1.29938806e-04,  2.03893618e-03,  8.48618901e-03,  1.49334418e-02,  2.13806947e-02,  2.78279475e-02,  3.42752004e-02,  4.29115704e-02,  5.79756745e-02,  7.16226178e-02,  7.99862299e-02,  8.83498421e-02,  9.67134543e-02,  1.05077066e-01,  1.13440679e-01,  1.21804291e-01,  1.19342024e-01,  1.13421171e-01,  1.07500318e-01,  1.01579464e-01,  9.39306109e-02,  6.65831465e-02,  3.92356821e-02,  1.18882176e-02,  1.43591877e-03,  1.73909760e-03,  2.04227644e-03,  2.34545528e-03,  2.64863412e-03,  2.95181296e-03,  3.25499180e-03,  3.55817064e-03,  3.86134948e-03,  4.16452832e-03,  4.46770715e-03,  5.35451231e-04, -5.69325779e-03, -1.19219668e-02, -1.81506758e-02, -2.43793849e-02, -3.06080939e-02, -3.68368029e-02, -4.30655119e-02, -6.35910653e-02, -9.69272315e-02, -1.31214928e-01, -1.65502625e-01, -1.99790321e-01, -2.31880190e-01, -2.17852294e-01, -2.03824398e-01, -1.89796501e-01, -1.75768605e-01, -1.61740709e-01, -1.47712813e-01, -1.33684917e-01, -1.19657021e-01, -1.05629125e-01, -9.16012289e-02, -7.75733329e-02, -6.35454368e-02, -4.95175407e-02, -3.54896446e-02, -1.97931871e-02, -9.91019032e-04,  1.78111491e-02,  3.66133172e-02,  5.54154853e-02,  7.42176534e-02,  9.30198215e-02,  1.11821990e-01,  1.30624158e-01,  1.49426326e-01,  1.68228494e-01,  1.77058236e-01,  2.02142593e-01,  1.73089366e-01,  1.14096379e-01,  5.51033923e-02, -3.88959476e-03, -4.18059241e-02, -3.62497552e-02, -3.06935863e-02, -2.51374174e-02, -1.95812485e-02, -1.40250796e-02, -8.46891069e-03, -2.91274179e-03,  2.64342711e-03,  8.19959601e-03,  1.37557649e-02,  1.93119338e-02,  2.48681027e-02,  3.04242716e-02,  2.48750293e-02,  9.22891450e-03, -6.41720034e-03, -2.20633152e-02, -3.77094300e-02, -5.33555449e-02, -6.90016597e-02, -8.46477745e-02, -1.00293889e-01, -1.15940004e-01, -1.51939550e-01, -1.73105188e-01, -1.72537671e-01, -1.71970154e-01, -1.71402638e-01, -1.65481739e-01, -1.59016774e-01, -1.52551810e-01, -1.46086845e-01, -1.39621880e-01, -1.33156915e-01, -1.26691951e-01, -1.20226986e-01, -1.13762021e-01, -1.07297056e-01, -1.00832092e-01, -9.28618069e-02, -8.33485225e-02, -7.38352381e-02, -6.43219537e-02, -5.48086693e-02, -4.52953849e-02, -3.57821005e-02, -2.62688161e-02, -1.68457765e-02, -1.02051488e-02, -1.21368570e-02, -1.40685652e-02, -1.41050875e-02, -1.25814988e-02, -1.10579100e-02, -9.53432123e-03, -8.01073246e-03, -6.48714369e-03, -4.96355492e-03, -3.43996616e-03, -2.50245621e-03, -6.61718584e-03, -1.07319155e-02, -1.48466451e-02, -1.89613747e-02, -2.30761043e-02, -2.71908340e-02, -3.91460783e-02, -5.41684591e-02, -6.92259758e-02, -7.86988735e-02, -8.14551617e-02, -8.42114499e-02, -8.69677381e-02, -8.97240263e-02, -9.24803145e-02, -9.52366027e-02, -9.79928909e-02, -9.42624724e-02, -8.36435799e-02, -7.30246874e-02, -6.24057950e-02, -5.17869025e-02, -4.11680100e-02, -3.24881102e-02, -2.46021821e-02, -1.67162541e-02, -1.39902532e-02, -1.21018684e-02, -1.02134836e-02, -8.32509874e-03, -6.43671391e-03, -4.54832909e-03, -2.65994426e-03, -7.71559433e-04,  1.11682539e-03,  8.29392522e-04,  1.82482205e-04, -4.64428112e-04, -1.11133843e-03, -1.75824875e-03, -2.40515906e-03};
float SS_servo6[] = { 0.00543669,  0.00506935,  0.00407884,  0.0031658 ,  0.00228823,  0.00139578,  0.00041499, -0.00095936, -0.00265187, -0.00460946, -0.00796187, -0.01233755, -0.01777367, -0.02320979, -0.02566983, -0.02746977, -0.02926972, -0.03106966, -0.03286961, -0.03466955, -0.03646949, -0.03826944, -0.0388722 , -0.03747177, -0.03607135, -0.03467093, -0.0332705 , -0.03187008, -0.02835847, -0.01864794, -0.01113159, -0.01179537, -0.01245915, -0.01312294, -0.01378672, -0.01445051, -0.01511429, -0.00774972,  0.00217971,  0.01210913,  0.02203855,  0.03270802,  0.05181373,  0.07091944,  0.09002515,  0.09448343,  0.08961713,  0.08475084,  0.07988455,  0.07501826,  0.07015197,  0.06528568,  0.06041939,  0.0555531 ,  0.05068681,  0.04582052,  0.03463628,  0.02002646,  0.00541663, -0.0091932 , -0.02380303, -0.03841285, -0.05302268, -0.06763251, -0.079226  , -0.06291987, -0.03551228, -0.00810468,  0.01930291,  0.04516318,  0.03855522,  0.03194726,  0.0253393 ,  0.01873135,  0.01212339,  0.00551543, -0.00109253, -0.00770049, -0.01430844, -0.0209164 , -0.02752436, -0.03413232, -0.04074028, -0.04734823, -0.05247741, -0.05485413, -0.05723084, -0.05960756, -0.06198428, -0.06436099, -0.06673771, -0.06911442, -0.07149114, -0.07386785, -0.07624457, -0.06659658, -0.05660757, -0.04471229, -0.03014613, -0.01557998, -0.00101382,  0.01087953,  0.01725999,  0.02364044,  0.0300209 ,  0.03640135,  0.04278181,  0.04916227,  0.05554272,  0.06192318,  0.06830364,  0.07468409,  0.08106455,  0.08744501,  0.09382546,  0.09588753,  0.09402339,  0.09215924,  0.0902951 ,  0.08843095,  0.08656681,  0.08470266,  0.08283852,  0.08097438,  0.07911023,  0.07644201,  0.08043356,  0.08998019,  0.09952683,  0.10907346,  0.10511493,  0.09978387,  0.0944528 ,  0.08912174,  0.08379067,  0.07845961,  0.07312854,  0.06779748,  0.06246641,  0.05713535,  0.05180428,  0.04914735,  0.04923148,  0.04931562,  0.04939975,  0.04948389,  0.04956802,  0.04965215,  0.04973629,  0.05219457,  0.06434159,  0.07716752,  0.08999345,  0.09687291,  0.09885725,  0.10084159,  0.10282594,  0.10481028,  0.10679462,  0.10877896,  0.11076331,  0.11161368,  0.10268875,  0.09376382,  0.08483889,  0.07591396,  0.06698903,  0.0580641 ,  0.04561118,  0.03906768,  0.03267275,  0.02817655,  0.02596395,  0.02375135,  0.02153874,  0.01932614,  0.01711353,  0.01490093,  0.01268833,  0.01158114,  0.01164782,  0.0117145 ,  0.01178119,  0.01184787,  0.01191455,  0.01216761,  0.01249699,  0.01282636,  0.01271659,  0.01253553,  0.01235446,  0.0121734 ,  0.01199234,  0.01181128,  0.01163022,  0.01144916,  0.01126809,  0.01052151,  0.0096815 ,  0.00884148,  0.00800147,  0.00716146,  0.00632144};    
float SS_servo7[] = {-0.00526695, -0.00472979, -0.00328773, -0.00197219, -0.00070665,  0.0006052 ,  0.0021001 ,  0.00434509,  0.00718451,  0.01051703,  0.01644419,  0.02397339,  0.03316279,  0.04235218,  0.04625364,  0.04898224,  0.05171084,  0.05443943,  0.05716803,  0.05989663,  0.06262523,  0.06535382,  0.06556661,  0.06156981,  0.05757302,  0.05357622,  0.04957943,  0.04558263,  0.03747172,  0.01728085,  0.00118738,  0.0003695 , -0.00044839, -0.00126628, -0.00208416, -0.00290205, -0.00371994, -0.01934313, -0.03969623, -0.06004934, -0.08040244, -0.10175467, -0.13449656, -0.16723846, -0.19998035, -0.19857542, -0.17543258, -0.15228974, -0.12914691, -0.10600407, -0.08286123, -0.0597184 , -0.03657556, -0.01343272,  0.00971011,  0.03285295,  0.05975165,  0.08868678,  0.11762191,  0.14655703,  0.17549216,  0.20442729,  0.23336242,  0.26229755,  0.27440246,  0.23063682,  0.16733022,  0.10402361,  0.040717  , -0.01958646, -0.01687377, -0.01416109, -0.0114484 , -0.00873571, -0.00602303, -0.00331034, -0.00059766,  0.00211503,  0.00482772,  0.0075404 ,  0.01025309,  0.01296577,  0.01567846,  0.01839115,  0.01631702,  0.00533315, -0.00565071, -0.01663458, -0.02761845, -0.03860232, -0.04958618, -0.06057005, -0.07155392, -0.08253778, -0.09352165, -0.1284939 , -0.15831155, -0.17627955, -0.19476043, -0.21324131, -0.23172218, -0.23917093, -0.22386492, -0.20855892, -0.19325291, -0.17794691, -0.1626409 , -0.1473349 , -0.13202889, -0.11672288, -0.10141688, -0.08611087, -0.07080487, -0.05549886, -0.04019286, -0.02430932, -0.0079007 ,  0.00850792,  0.02491654,  0.04132516,  0.05773378,  0.0741424 ,  0.09055102,  0.10695964,  0.12336826,  0.12991057,  0.10830153,  0.07403868,  0.03977582,  0.00551296,  0.00233539,  0.00231703,  0.00229866,  0.0022803 ,  0.00226194,  0.00224358,  0.00222521,  0.00220685,  0.00218849,  0.00217012,  0.00215176, -0.00086981, -0.00696977, -0.01306972, -0.01916968, -0.02526964, -0.03136959, -0.03746955, -0.0435695 , -0.05407619, -0.08142182, -0.10616895, -0.13091609, -0.14409385, -0.14774775, -0.15140165, -0.15505555, -0.15870944, -0.16236334, -0.16601724, -0.16967113, -0.17126585, -0.15510961, -0.13895336, -0.12279712, -0.10664087, -0.09048463, -0.07432839, -0.05247154, -0.04123198, -0.03026191, -0.02287912, -0.01981073, -0.01674234, -0.01367396, -0.01060557, -0.00753718, -0.00446879, -0.0014004 , -0.00047595, -0.00182821, -0.00318048, -0.00453274, -0.00588501, -0.00723727, -0.00869942, -0.01020657, -0.01171371, -0.01208081, -0.01226284, -0.01244488, -0.01262691, -0.01280894, -0.01299097, -0.01317301, -0.01335504, -0.01353707, -0.01253483, -0.01133693, -0.01013904, -0.00894114, -0.00774324, -0.00654534};

int node=0;
int first=0;
int input=0;
int end_time=0;
int time_step=60000;
int steps = sizeof(SS_servo0)/sizeof(SS_servo0[0]);
int one_print = 0;

// -------------------Joint configurations-------------------
int servo0=0;
int servo0_deg=0;
int servo1=0;
int servo1_deg=0;
int servo2=0;
int servo2_deg=0;
int servo3=0;
int servo3_deg=0;
int servo4=0;
int servo4_deg=0;
int servo5=0;
int servo5_deg=0;
int servo6=0;
int servo6_deg=0;
int servo7=0;
int servo7_deg=0;

void setup() {
  Serial.begin(115200);
  pca9685.begin();

  pca9685.setOscillatorFrequency(27000000); //Value between 24MHz and 27MHz, tuned for this setup
  pca9685.setPWMFreq(SERVO_FREQ);
  delay (1000);

  servo0_deg=SS_servo0[0]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[0]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[0]/3.14159265*180;
        servo2=map(servo2_deg,-37,90,1500,2670);
        servo3_deg=SS_servo3[0]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[0]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[0]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[0]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[0]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        Serial.print("Node:");
        Serial.println(node);
        Serial.print("servo0 -> rads:");
        Serial.print(SS_servo0[node]);
        Serial.print("        deg:");
        Serial.print(servo0_deg);
        Serial.print("        us:");
        Serial.println(servo0);
        Serial.print("servo1 -> rads:");
        Serial.print(SS_servo1[node]);
        Serial.print("        deg:");
        Serial.print(servo1_deg);
        Serial.print("        us:");
        Serial.println(servo1);
        Serial.print("servo2 -> rads:");
        Serial.print(SS_servo2[node]);
        Serial.print("        deg:");
        Serial.print(servo2_deg);
        Serial.print("        us:");
        Serial.println(servo2);
        Serial.print("servo3 -> rads:");
        Serial.print(SS_servo3[node]);
        Serial.print("        deg:");
        Serial.print(servo3_deg);
        Serial.print("        us:");
        Serial.println(servo3);
        Serial.print("servo4 -> rads:");
        Serial.print(SS_servo4[node]);
        Serial.print("        deg:");
        Serial.print(servo4_deg);
        Serial.print("        us:");
        Serial.println(servo4);
        Serial.print("servo5 -> rads:");
        Serial.print(SS_servo5[node]);
        Serial.print("        deg:");
        Serial.print(servo5_deg);
        Serial.print("        us:");
        Serial.println(servo5);
        Serial.print("servo6 -> rads:");
        Serial.print(SS_servo6[node]);
        Serial.print("        deg:");
        Serial.print(servo6_deg);
        Serial.print("        us:");
        Serial.println(servo6);
        Serial.print("servo7 -> rads:");
        Serial.print(SS_servo7[node]);
        Serial.print("        deg:");
        Serial.print(servo7_deg);
        Serial.print("        us:");
        Serial.println(servo7);

        Serial.println("10");
        delay(1000);
        Serial.println("9");
        delay(1000);
        Serial.println("8");
        delay(1000);
        Serial.println("7");
        delay(1000);
        Serial.println("6");
        delay(1000);
        Serial.println("5");
        delay(1000);
        Serial.println("4");
        delay(1000);
        Serial.println("3");
        delay(1000);
        Serial.println("2");
        delay(1000);
        Serial.println("1");
        delay(1000);

}

void loop() 
{
  if(Serial.available()>0)
  {
    first=Serial.read();
    if(first=='2')
    {
      input=2;
      node=0;
      one_print=1;
    }
    if(first=='1')
    {
      input=1;
      node=0;
      one_print=1;
    }
    if(first=='0')
    {
      input=0;
    }
  }
  if(input==1 or input==2)
  {
      if(esp_timer_get_time()>=end_time)
      {
        servo0_deg=SS_servo0[node]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[node]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[node]/3.14159265*180;
        servo2=map(servo2_deg,-37,90,1500,2670);
        servo3_deg=SS_servo3[node]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[node]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[node]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[node]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[node]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);
        
        node+=1;
        if(node>=steps and input==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          node=0;
        }
        if(node>=steps and input==2)
        {
          Serial.print("Input:");
          Serial.println(input);
          input=0;
        }
         end_time=esp_timer_get_time()+time_step;
      }
   }

  if(input == 0)
  {        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        if(one_print==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          Serial.print("Node:");
          Serial.println(node);
          Serial.print("servo0 -> rads:");
          Serial.print(SS_servo0[node]);
          Serial.print("        deg:");
          Serial.print(servo0_deg);
          Serial.print("        us:");
          Serial.println(servo0);
          Serial.print("servo1 -> rads:");
          Serial.print(SS_servo1[node]);
          Serial.print("        deg:");
          Serial.print(servo1_deg);
          Serial.print("        us:");
          Serial.println(servo1);
          Serial.print("servo2 -> rads:");
          Serial.print(SS_servo2[node]);
          Serial.print("        deg:");
          Serial.print(servo2_deg);
          Serial.print("        us:");
          Serial.println(servo2);
          Serial.print("servo3 -> rads:");
          Serial.print(SS_servo3[node]);
          Serial.print("        deg:");
          Serial.print(servo3_deg);
          Serial.print("        us:");
          Serial.println(servo3);
          Serial.print("servo4 -> rads:");
          Serial.print(SS_servo4[node]);
          Serial.print("        deg:");
          Serial.print(servo4_deg);
          Serial.print("        us:");
          Serial.println(servo4);
          Serial.print("servo5 -> rads:");
          Serial.print(SS_servo5[node]);
          Serial.print("        deg:");
          Serial.print(servo5_deg);
          Serial.print("        us:");
          Serial.println(servo5);
          Serial.print("servo6 -> rads:");
          Serial.print(SS_servo6[node]);
          Serial.print("        deg:");
          Serial.print(servo6_deg);
          Serial.print("        us:");
          Serial.println(servo6);
          Serial.print("servo7 -> rads:");
          Serial.print(SS_servo7[node]);
          Serial.print("        deg:");
          Serial.print(servo7_deg);
          Serial.print("        us:");
          Serial.println(servo7);
          one_print=0;
        }
  
  }
}
