// HOW TO:
// ------------------------------
// Serial input = 2 -> Steps through gait sequence once and stops at the end.
// Serial input = 1 -> Steps through gait sequence in a loop.
// Serial input = 0 -> Stops infinite loop at the node where it is at that moment

//Gait template
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pca9685 = Adafruit_PWMServoDriver();

#define SERVO_FREQ 300
#define SER0 0 //Hip 1
#define SER1 1 //Knee 1
#define SER2 2 //Hip 2
#define SER3 3 //Knee 2
#define SER4 4 //Hip 3
#define SER5 5 //Knee 3
#define SER6 6 //Hip 4
#define SER7 7 //Knee 4

// Insert servo angles here:
// For 3D gaits, these angles are obtained from linearisation.py
// For 2D gaits, these angles are obtained from 2D_trajectory_reader.py
float SS_servo0[] = {-0.23476996, -0.23745284, -0.23944827, -0.23914327, -0.23846465, -0.23280426, -0.23188157, -0.23176014, -0.24011841, -0.25133321, -0.26415959, -0.2763518 , -0.288544  , -0.3007362 , -0.30991695, -0.31553528, -0.32115361, -0.31869935, -0.29943137, -0.25755519, -0.20574731, -0.15393942, -0.12762662, -0.11859058, -0.10955454, -0.10051849, -0.09148245, -0.0824464 , -0.07341036, -0.06437432, -0.05533827, -0.05842271, -0.06415528, -0.06988785, -0.07562042, -0.08135299, -0.08708556, -0.09079673, -0.09149022, -0.10139208, -0.11342661, -0.12887638, -0.14432614, -0.15977591, -0.16363129, -0.15223665, -0.14084201, -0.12944737, -0.11805273, -0.10665809, -0.09526345, -0.0838688 , -0.07247416, -0.06107952, -0.04968488, -0.03829024, -0.0268956 , -0.01684771, -0.00735074,  0.00214623,  0.0116432 ,  0.02114017,  0.03063714,  0.04013411,  0.04963108,  0.05912805,  0.06119757,  0.05546886,  0.04986375,  0.0467321 ,  0.04368311,  0.04082699,  0.03810793,  0.03538887,  0.03266981,  0.02995075,  0.02723169,  0.02137457,  0.0154394 ,  0.00950422,  0.00356904, -0.00301074, -0.00810564, -0.0131226 , -0.01891372, -0.02470483, -0.03049595, -0.03628706, -0.03761216, -0.0387584 , -0.03990464, -0.04105087, -0.04219711, -0.04334335, -0.04448959, -0.04563583, -0.04678206, -0.0479283 , -0.04907454, -0.05022078, -0.05136701, -0.05251325, -0.05414226, -0.05711205, -0.06008184, -0.06305162, -0.06602141, -0.0689912 , -0.07196098, -0.07493077, -0.07790056, -0.08087035, -0.08384013, -0.08876961, -0.09303128, -0.09708224, -0.10130472, -0.09933502, -0.09777815, -0.09640176, -0.09502537, -0.09364898, -0.09465275, -0.09645007, -0.09824739, -0.10004472, -0.10184204, -0.10363936, -0.10543668, -0.107234  , -0.10903133, -0.11082865, -0.11262597, -0.11442329, -0.11622061, -0.11852166, -0.12136477, -0.12420788, -0.12705099, -0.12989409, -0.1327372 , -0.13558031, -0.13842342, -0.14126653, -0.14410964, -0.14854548, -0.15527661, -0.15930843, -0.16179532, -0.16239066, -0.161894  , -0.15904844, -0.15598804, -0.15448671, -0.15423526, -0.15398382, -0.15373237, -0.15550063, -0.16045238, -0.16540413, -0.16892029, -0.16961793, -0.16838333, -0.17052641, -0.18157042, -0.19261443, -0.20365844, -0.20543336, -0.20182203, -0.19821069, -0.19459936, -0.19098802, -0.18737669, -0.18376536, -0.18015402, -0.17654269, -0.17293135, -0.16932002, -0.16570869, -0.16350811, -0.16171954, -0.15993097, -0.15814239, -0.15635382, -0.15456525, -0.15277667, -0.1509881 , -0.15082386, -0.15155618, -0.15207999, -0.15022255, -0.15803375, -0.16584496, -0.17365617, -0.18146737, -0.18463669, -0.18352798, -0.18241928, -0.18131057, -0.18020186, -0.17909315, -0.17798445, -0.17687574, -0.17576703, -0.17465832, -0.17354962, -0.17244091, -0.1713322 , -0.17022349, -0.16911479, -0.17240238, -0.17663188, -0.18086138, -0.18509088, -0.18932038, -0.19354988, -0.19777938, -0.20200888, -0.20623838, -0.21046787, -0.21643664, -0.21837171, -0.21707477, -0.21716045, -0.2169569 , -0.2148077 , -0.21470801, -0.21460833, -0.21554881, -0.21677369, -0.21633904, -0.2173616 , -0.21762264, -0.2177262 , -0.21780282, -0.21750183, -0.21720084, -0.21689986, -0.21659887, -0.21629788, -0.21599689, -0.2156959 , -0.21539492, -0.21531709, -0.21670227, -0.21808745, -0.21947263, -0.22085781, -0.22224299, -0.22362817, -0.22654375, -0.22582008, -0.22404805, -0.22053806, -0.21702807, -0.21618886, -0.21634657, -0.21650428, -0.21666199, -0.21681969, -0.2169774 , -0.21713511, -0.21729282, -0.21745053, -0.21954827, -0.22206977, -0.22459127, -0.22711277, -0.22963427, -0.23215577};
float SS_servo1[] = {0.10048795, 0.10696542, 0.11214464, 0.10959558, 0.10175961, 0.09590184, 0.09187535, 0.08911578, 0.09976407, 0.12188142, 0.16389801, 0.22744171, 0.29098541, 0.35452911, 0.42673997, 0.50920368, 0.5916674 , 0.65487347, 0.66517675, 0.59179606, 0.47442492, 0.35705379, 0.29619013, 0.27361877, 0.25104741, 0.22847605, 0.20590469, 0.18333333, 0.16076197, 0.1381906 , 0.11561924, 0.11007945, 0.10826078, 0.10644211, 0.10462343, 0.10280476, 0.10098609, 0.09884438, 0.09779409, 0.10614336, 0.1077377 , 0.11091128, 0.11408486, 0.11725844, 0.11841455, 0.1169171 , 0.11541965, 0.1139222 , 0.11242475, 0.1109273 , 0.10942984, 0.10793239, 0.10643494, 0.10493749, 0.10344004, 0.10194258, 0.10044513, 0.10000972, 0.10000876, 0.10000779, 0.10000682, 0.10000586, 0.10000489, 0.10000393, 0.10000296, 0.100002  , 0.10007264, 0.10060106, 0.10183414, 0.10329631, 0.10503418, 0.10563143, 0.10541813, 0.10520482, 0.10499151, 0.10477821, 0.1045649 , 0.10617596, 0.10783241, 0.10948885, 0.1111453 , 0.11146318, 0.10482445, 0.09456826, 0.08570208, 0.0768359 , 0.06796972, 0.05910353, 0.05928181, 0.0598223 , 0.0603628 , 0.0609033 , 0.0614438 , 0.0619843 , 0.0625248 , 0.0630653 , 0.0636058 , 0.06414629, 0.06468679, 0.06522729, 0.06576779, 0.06630829, 0.0675333 , 0.07065936, 0.07378542, 0.07691148, 0.08003754, 0.0831636 , 0.08628966, 0.08941572, 0.09254178, 0.09566784, 0.0987939 , 0.10165169, 0.10037929, 0.10311085, 0.1067844 , 0.10055022, 0.09126959, 0.08206871, 0.07286783, 0.06366694, 0.0613933 , 0.0614292 , 0.0614651 , 0.061501  , 0.0615369 , 0.0615728 , 0.06160869, 0.06164459, 0.06168049, 0.06171639, 0.06175229, 0.06178819, 0.06182409, 0.06375408, 0.06772231, 0.07169055, 0.07565879, 0.07962702, 0.08359526, 0.0875635 , 0.09153174, 0.09549997, 0.09946821, 0.10053974, 0.10488486, 0.11135835, 0.114808  , 0.11352788, 0.110327  , 0.10343347, 0.09325418, 0.08634681, 0.08298707, 0.07962733, 0.07626759, 0.07757645, 0.08624404, 0.09491163, 0.10177054, 0.10339913, 0.10239736, 0.10972485, 0.13493411, 0.16014338, 0.18535265, 0.19123827, 0.18589493, 0.1805516 , 0.17520827, 0.16986494, 0.16452161, 0.15917828, 0.15383495, 0.14849162, 0.14314829, 0.13780496, 0.13246162, 0.12843945, 0.12480311, 0.12116676, 0.11753042, 0.11389407, 0.11025773, 0.10662138, 0.10298504, 0.10258735, 0.1056205 , 0.10942197, 0.10137491, 0.1093484 , 0.11732189, 0.12529538, 0.13326887, 0.13376484, 0.12736941, 0.12097399, 0.11457856, 0.10818314, 0.10178772, 0.09539229, 0.08899687, 0.08260145, 0.07620602, 0.0698106 , 0.06341517, 0.05701975, 0.05062433, 0.0442289 , 0.04749997, 0.05284208, 0.05818418, 0.06352629, 0.0688684 , 0.0742105 , 0.07955261, 0.08489472, 0.09023682, 0.09557893, 0.10390781, 0.10811323, 0.10498587, 0.10405474, 0.10045103, 0.09785042, 0.09697513, 0.09609984, 0.09778995, 0.10022441, 0.09872095, 0.0997606 , 0.09721357, 0.09409569, 0.09112478, 0.09021381, 0.08930284, 0.08839187, 0.0874809 , 0.08656993, 0.08565896, 0.084748  , 0.08383703, 0.08339325, 0.08601236, 0.08863146, 0.09125057, 0.09386967, 0.09648878, 0.09910788, 0.10370211, 0.1010197 , 0.09764032, 0.09332513, 0.08900994, 0.08698224, 0.08580839, 0.08463455, 0.0834607 , 0.08228686, 0.08111301, 0.07993917, 0.07876532, 0.07759148, 0.08025777, 0.08376287, 0.08726796, 0.09077306, 0.09427816, 0.09778326};
float SS_servo2[] = { 0.15986778,  0.15897475,  0.15660719,  0.15397068,  0.14878346,  0.14337174,  0.14083185,  0.13861731,  0.13984597,  0.13927588,  0.13670718,  0.1327742 ,  0.12884121,  0.12490823,  0.11784652,  0.10708367,  0.09632081,  0.08862115,  0.08503336,  0.08346007,  0.07784797,  0.07223587,  0.06837916,  0.06571199,  0.06304483,  0.06037766,  0.05771049,  0.05504333,  0.05237616,  0.04970899,  0.04704183,  0.04557135,  0.04436233,  0.04315332,  0.0419443 ,  0.04073528,  0.03952626,  0.03648137,  0.03100894,  0.02802665,  0.03220313,  0.03972065,  0.04723817,  0.05475569,  0.05764067,  0.05443248,  0.05122429,  0.0480161 ,  0.04480791,  0.04159973,  0.03839154,  0.03518335,  0.03197516,  0.02876698,  0.02555879,  0.0223506 ,  0.01914241,  0.01177682,  0.00271058, -0.00635567, -0.01542191, -0.02448816, -0.0335544 , -0.04262065, -0.05168689, -0.06075313, -0.06994175, -0.07517227, -0.07696882, -0.07639781, -0.07566272, -0.07770946, -0.08173303, -0.08575661, -0.08978019, -0.09380376, -0.09782734, -0.10880585, -0.11995736, -0.13110888, -0.14226039, -0.15385154, -0.16525493, -0.18302541, -0.20508938, -0.22715334, -0.2492173 , -0.27128126, -0.27067903, -0.26916903, -0.26765903, -0.26614903, -0.26463903, -0.26312903, -0.26161903, -0.26010903, -0.25859903, -0.25708903, -0.25557902, -0.25406902, -0.25255902, -0.25104902, -0.25009687, -0.25069402, -0.25129117, -0.25188832, -0.25248546, -0.25308261, -0.25367976, -0.25427691, -0.25487405, -0.2554712 , -0.25606835, -0.2605463 , -0.26919955, -0.27116289, -0.26792833, -0.26678877, -0.27239315, -0.27823102, -0.28406889, -0.28990677, -0.28855669, -0.28481017, -0.28106364, -0.27731712, -0.27357059, -0.26982406, -0.26607754, -0.26233101, -0.25858449, -0.25483796, -0.25109143, -0.24734491, -0.24359838, -0.24234071, -0.24376133, -0.24518194, -0.24660256, -0.24802317, -0.24944378, -0.2508644 , -0.25228501, -0.25370562, -0.25512624, -0.25920404, -0.25800947, -0.25148102, -0.24631164, -0.24368942, -0.24167709, -0.24303453, -0.252412  , -0.25946489, -0.26273733, -0.26600976, -0.2692822 , -0.26835623, -0.2608127 , -0.25326917, -0.24343337, -0.21555183, -0.17829992, -0.12948806, -0.07809836, -0.02670867,  0.02468102,  0.04573313,  0.0491561 ,  0.05257908,  0.05600205,  0.05942502,  0.06284799,  0.06627096,  0.06969393,  0.0731169 ,  0.07653987,  0.07996285,  0.08338582,  0.07465768,  0.06238095,  0.05010422,  0.0378275 ,  0.02555077,  0.01327404,  0.00099731, -0.01127941, -0.02283026, -0.02957071, -0.02897554, -0.03143247, -0.03385336, -0.03627425, -0.03869514, -0.04111602, -0.03769152, -0.02887982, -0.02006812, -0.01125642, -0.00244472,  0.00636697,  0.01517867,  0.02399037,  0.03280207,  0.04161377,  0.05042547,  0.05923716,  0.06804886,  0.07686056,  0.08567226,  0.09596147,  0.10656723,  0.11717299,  0.12777876,  0.13838452,  0.14899028,  0.15959605,  0.17020181,  0.18080757,  0.19141334,  0.19999944,  0.19733299,  0.19511353,  0.19477096,  0.19422308,  0.19423059,  0.19366198,  0.19309337,  0.19292512,  0.19293576,  0.19452299,  0.19630207,  0.1942365 ,  0.19169274,  0.18936011,  0.18998692,  0.19061374,  0.19124055,  0.19186737,  0.19249418,  0.19312099,  0.19374781,  0.19437462,  0.19443716,  0.19080033,  0.18716351,  0.18352668,  0.17988986,  0.17625303,  0.17261621,  0.16885598,  0.1699967 ,  0.1726958 ,  0.17414122,  0.17558665,  0.17648355,  0.1771757 ,  0.17786785,  0.17856001,  0.17925216,  0.17994431,  0.18063647,  0.18132862,  0.18202077,  0.17940349,  0.17606331,  0.17272314,  0.16938297,  0.1660428 ,  0.16270263};
float SS_servo3[] = { 0.10041598,  0.10049844,  0.10165235,  0.10385492,  0.10907793,  0.11454289,  0.11427141,  0.11321328,  0.10383015,  0.09360322,  0.0849974 ,  0.08033848,  0.07567956,  0.07102064,  0.07360231,  0.08474929,  0.09589627,  0.10139008,  0.10241344,  0.10123124,  0.10452608,  0.10782091,  0.10896753,  0.10865842,  0.1083493 ,  0.10804019,  0.10773107,  0.10742196,  0.10711285,  0.10680373,  0.10649462,  0.10560883,  0.10459705,  0.10358528,  0.1025735 ,  0.10156172,  0.10054994,  0.10238538,  0.10756929,  0.10423787,  0.09145423,  0.07280642,  0.05415862,  0.03551081,  0.02495914,  0.02505627,  0.0251534 ,  0.02525053,  0.02534766,  0.02544479,  0.02554192,  0.02563905,  0.02573618,  0.02583331,  0.02593044,  0.02602757,  0.0261247 ,  0.0318373 ,  0.039847  ,  0.04785669,  0.05586639,  0.06387609,  0.07188578,  0.07989548,  0.08790518,  0.09591487,  0.10577582,  0.10956922,  0.10482879,  0.09535108,  0.08241348,  0.07535398,  0.0724716 ,  0.06958922,  0.06670683,  0.06382445,  0.06094207,  0.07026453,  0.07989059,  0.08951665,  0.09914272,  0.10339237,  0.10303645,  0.11304202,  0.13241552,  0.15178903,  0.17116253,  0.19053603,  0.18499778,  0.17846183,  0.17192587,  0.16538992,  0.15885396,  0.152318  ,  0.14578205,  0.13924609,  0.13271013,  0.12617418,  0.11963822,  0.11310227,  0.10656631,  0.10003035,  0.09534353,  0.09579221,  0.09624088,  0.09668956,  0.09713823,  0.09758691,  0.09803559,  0.09848426,  0.09893294,  0.09938161,  0.09983029,  0.10358422,  0.11242574,  0.11241116,  0.10356444,  0.09994174,  0.11226675,  0.12517322,  0.1380797 ,  0.15098618,  0.14982788,  0.14398039,  0.13813291,  0.13228543,  0.12643794,  0.12059046,  0.11474298,  0.10889549,  0.10304801,  0.09720052,  0.09135304,  0.08550556,  0.07965807,  0.07779802,  0.08022886,  0.08265971,  0.08509056,  0.08752141,  0.08995226,  0.0923831 ,  0.09481395,  0.0972448 ,  0.09967565,  0.11638051,  0.12597647,  0.11949032,  0.1095069 ,  0.10242831,  0.10076389,  0.10308499,  0.12789078,  0.16871589,  0.22122918,  0.27374248,  0.32625577,  0.38397612,  0.44990388,  0.51583164,  0.58052597,  0.59226163,  0.57131112,  0.49288816,  0.37819614,  0.26350412,  0.1488121 ,  0.10302743,  0.09728475,  0.09154207,  0.08579939,  0.08005671,  0.07431403,  0.06857135,  0.06282867,  0.05708598,  0.0513433 ,  0.04560062,  0.03985794,  0.04409426,  0.05124483,  0.0583954 ,  0.06554597,  0.07269654,  0.07984711,  0.08699769,  0.09414826,  0.10180007,  0.10800394,  0.10269815,  0.09504897,  0.0662109 ,  0.03737284,  0.00853477, -0.02030329, -0.02993071, -0.02185334, -0.01377597, -0.0056986 ,  0.00237877,  0.01045613,  0.0185335 ,  0.02661087,  0.03468824,  0.04276561,  0.05084297,  0.05892034,  0.06699771,  0.07507508,  0.08315245,  0.08577029,  0.08721843,  0.08866658,  0.09011472,  0.09156286,  0.093011  ,  0.09445915,  0.09590729,  0.09735543,  0.09880358,  0.09929584,  0.10186261,  0.10506923,  0.10500674,  0.10385054,  0.10400983,  0.10472252,  0.10543521,  0.10621228,  0.10691388,  0.10460382,  0.10055967,  0.09251701,  0.08414343,  0.0760841 ,  0.07242926,  0.06877442,  0.06511959,  0.06146475,  0.05780992,  0.05415508,  0.05050025,  0.04684541,  0.04482566,  0.05352536,  0.06222506,  0.07092477,  0.07962447,  0.08832417,  0.09702388,  0.10622128,  0.1044424 ,  0.09770966,  0.09351923,  0.0893288 ,  0.08618291,  0.08342692,  0.08067093,  0.07791494,  0.07515895,  0.07240295,  0.06964696,  0.06689097,  0.06413498,  0.06826538,  0.07389998,  0.07953459,  0.0851692 ,  0.0908038 ,  0.09643841};
float SS_servo4[] = { 0.10633477,  0.11014065,  0.11793979,  0.1237379 ,  0.12545507,  0.12443182,  0.11979823,  0.11469506,  0.10462231,  0.09337405,  0.08303707,  0.07578365,  0.06853022,  0.06127679,  0.05689118,  0.05589806,  0.05490494,  0.0521619 ,  0.04928483,  0.04808581,  0.04907283,  0.05005984,  0.04988842,  0.04893199,  0.04797555,  0.04701912,  0.04606268,  0.04510624,  0.04414981,  0.04319337,  0.04223694,  0.03924201,  0.0358017 ,  0.0323614 ,  0.02892109,  0.02548078,  0.02204048,  0.02069234,  0.02273177,  0.01622139,  0.00620759, -0.00213841, -0.01048442, -0.01883042, -0.02548696, -0.02992136, -0.03435575, -0.03879014, -0.04322453, -0.04765892, -0.05209332, -0.05652771, -0.0609621 , -0.06539649, -0.06983088, -0.07426527, -0.07869967, -0.07981195, -0.07956528, -0.0793186 , -0.07907193, -0.07882526, -0.07857858, -0.07833191, -0.07808523, -0.07783856, -0.07659703, -0.0771331 , -0.08337251, -0.09300743, -0.10063754, -0.10695231, -0.11233237, -0.11771242, -0.12309248, -0.12847253, -0.13385259, -0.13541126, -0.13687487, -0.13833848, -0.13980209, -0.14320714, -0.1564398 , -0.16596491, -0.16770633, -0.16944774, -0.17118915, -0.17293057, -0.17731007, -0.18179522, -0.18628038, -0.19076554, -0.19525069, -0.19973585, -0.204221  , -0.20870616, -0.21319132, -0.21767647, -0.22216163, -0.22664678, -0.23113194, -0.2356171 , -0.23839677, -0.23643991, -0.23448306, -0.2325262 , -0.23056934, -0.22861248, -0.22665563, -0.22469877, -0.22274191, -0.22078506, -0.2188282 , -0.21414242, -0.21314621, -0.21322459, -0.21865266, -0.22794715, -0.23048306, -0.23264025, -0.23479745, -0.23695465, -0.24011676, -0.24361391, -0.24711105, -0.2506082 , -0.25410535, -0.2576025 , -0.26109965, -0.2645968 , -0.26809395, -0.2715911 , -0.27508825, -0.2785854 , -0.28208255, -0.28259455, -0.27989423, -0.2771939 , -0.27449357, -0.27179325, -0.26909292, -0.26639259, -0.26369227, -0.26099194, -0.25829161, -0.25483698, -0.25636574, -0.26066293, -0.26369507, -0.26541681, -0.26676578, -0.26725151, -0.2684855 , -0.26932735, -0.26938009, -0.26943283, -0.26948557, -0.26851154, -0.26591909, -0.26332664, -0.26099201, -0.26275139, -0.26651625, -0.27187287, -0.27643858, -0.2810043 , -0.28557002, -0.28784423, -0.28878683, -0.28972944, -0.29067204, -0.29161465, -0.29255725, -0.29349986, -0.29444246, -0.29538507, -0.29632767, -0.29727028, -0.29821288, -0.29501946, -0.29061814, -0.28621683, -0.28181552, -0.27741421, -0.2730129 , -0.26861159, -0.26421028, -0.25923744, -0.25343625, -0.25238011, -0.26456428, -0.28940058, -0.31423689, -0.33907319, -0.36390949, -0.37305073, -0.36772719, -0.36240366, -0.35708012, -0.35175658, -0.34643305, -0.34110951, -0.33578598, -0.33046244, -0.3251389 , -0.31981537, -0.31449183, -0.3091683 , -0.30384476, -0.29852122, -0.27376353, -0.24484209, -0.21592065, -0.18699921, -0.15807777, -0.12915632, -0.10023488, -0.07131344, -0.042392  , -0.01347056,  0.01821359,  0.05012981,  0.07444107,  0.09164127,  0.11305841,  0.14779526,  0.1779473 ,  0.20809934,  0.22950778,  0.24785435,  0.25103429,  0.24019662,  0.19827832,  0.15335043,  0.11055024,  0.09757353,  0.08459682,  0.07162012,  0.05864341,  0.0456667 ,  0.03269   ,  0.01971329,  0.00673658, -0.00384128,  0.00130743,  0.00645614,  0.01160485,  0.01675357,  0.02190228,  0.02705099,  0.03398844,  0.04144179,  0.06064357,  0.08095102,  0.10125847,  0.10699364,  0.10728938,  0.10758512,  0.10788086,  0.1081766 ,  0.10847234,  0.10876808,  0.10906383,  0.10935957,  0.10883827,  0.10813851,  0.10743875,  0.10673899,  0.10603923,  0.10533947};
float SS_servo5[] = {-0.10406404, -0.11345517, -0.13154186, -0.14551013, -0.15389168, -0.15394641, -0.1489744 , -0.14330498, -0.13025484, -0.11751345, -0.10748172, -0.10192678, -0.09637183, -0.09081689, -0.08978337, -0.0940985 , -0.09841364, -0.0976203 , -0.09802726, -0.10087095, -0.10319971, -0.10552846, -0.10719002, -0.10839944, -0.10960887, -0.11081829, -0.11202772, -0.11323715, -0.11444657, -0.115656  , -0.11686542, -0.11538306, -0.11331259, -0.11124213, -0.10917166, -0.10710119, -0.10503072, -0.10738482, -0.11476118, -0.11027096, -0.09375248, -0.08011951, -0.06648654, -0.05285357, -0.0445715 , -0.04332746, -0.04208342, -0.04083938, -0.03959533, -0.03835129, -0.03710725, -0.03586321, -0.03461916, -0.03337512, -0.03213108, -0.03088703, -0.02964299, -0.03472522, -0.04239532, -0.05006542, -0.05773552, -0.06540562, -0.07307571, -0.08074581, -0.08841591, -0.09608601, -0.1059586 , -0.11154741, -0.109554  , -0.09651701, -0.08682908, -0.08070254, -0.07710681, -0.07351107, -0.06991534, -0.06631961, -0.06272387, -0.07160529, -0.08079708, -0.08998887, -0.09918066, -0.10882361, -0.10600929, -0.1095756 , -0.12519167, -0.14080775, -0.15642382, -0.17203989, -0.16533472, -0.15773559, -0.15013646, -0.14253733, -0.13493819, -0.12733906, -0.11973993, -0.1121408 , -0.10454167, -0.09694253, -0.0893434 , -0.08174427, -0.07414514, -0.06654601, -0.06192911, -0.06559459, -0.06926007, -0.07292555, -0.07659103, -0.08025651, -0.08392199, -0.08758747, -0.09125295, -0.09491843, -0.09858391, -0.11002783, -0.11940393, -0.12392734, -0.117737  , -0.10096623, -0.09807975, -0.09605292, -0.09402609, -0.09199926, -0.08782848, -0.08294292, -0.07805736, -0.0731718 , -0.06828623, -0.06340067, -0.05851511, -0.05362955, -0.04874398, -0.04385842, -0.03897286, -0.0340873 , -0.02920174, -0.03034261, -0.03796859, -0.04559456, -0.05322054, -0.06084652, -0.06847249, -0.07609847, -0.08372444, -0.09135042, -0.0989764 , -0.10892533, -0.11026543, -0.10327489, -0.09975067, -0.09969455, -0.099555  , -0.09977444, -0.10140929, -0.10309266, -0.10468899, -0.10628531, -0.10788164, -0.11074563, -0.11560775, -0.12046986, -0.12482961, -0.11805273, -0.10803702, -0.09536383, -0.08333701, -0.07131019, -0.05928337, -0.05316722, -0.05048576, -0.04780429, -0.04512283, -0.04244136, -0.0397599 , -0.03707843, -0.03439697, -0.03171551, -0.02903404, -0.02635258, -0.02367111, -0.02999376, -0.03894595, -0.04789814, -0.05685033, -0.06580252, -0.07475471, -0.08370689, -0.09265908, -0.10277722, -0.11271555, -0.11221682, -0.0959144 , -0.07212961, -0.04834482, -0.02456003, -0.00077524,  0.01793309,  0.0319629 ,  0.0459927 ,  0.06002251,  0.07405231,  0.08808212,  0.10211192,  0.11614172,  0.13017153,  0.14420133,  0.15823114,  0.17226094,  0.18629075,  0.20032055,  0.21435035,  0.19232904,  0.1625838 ,  0.13283857,  0.10309334,  0.0733481 ,  0.04360287,  0.01385763, -0.0158876 , -0.04563283, -0.07537807, -0.12401694, -0.1364245 , -0.13911817, -0.13381424, -0.17457938, -0.25543144, -0.34395589, -0.43248035, -0.50663742, -0.57563218, -0.60091885, -0.57946577, -0.48401868, -0.38205244, -0.28571332, -0.26824814, -0.25078295, -0.23331776, -0.21585257, -0.19838738, -0.18092219, -0.16345701, -0.14599182, -0.13020796, -0.12544679, -0.12068562, -0.11592445, -0.11116328, -0.10640211, -0.10164093, -0.11023302, -0.12365387, -0.13724912, -0.13006236, -0.12287561, -0.11534824, -0.10769374, -0.10003924, -0.09238474, -0.08473024, -0.07707574, -0.06942124, -0.06176674, -0.05411224, -0.05874904, -0.06607065, -0.07339226, -0.08071387, -0.08803548, -0.09535709};
float SS_servo6[] = { 9.43682386e-02,  9.33432944e-02,  8.59046052e-02,  7.91981051e-02,  7.36363302e-02,  6.64339725e-02,  6.12861569e-02,  5.62453899e-02,  5.23375229e-02,  4.85392503e-02,  4.43971497e-02,  3.95034962e-02,  3.46098427e-02,  2.97161892e-02,  2.44271568e-02,  1.86704079e-02,  1.29136591e-02,  6.59840497e-03, -4.48321304e-04, -6.15614402e-03, -8.85439520e-03, -1.15526464e-02, -1.52230917e-02, -1.95523444e-02, -2.38815971e-02, -2.82108499e-02, -3.25401026e-02, -3.68693553e-02, -4.11986080e-02, -4.55278608e-02, -4.98571135e-02, -4.84810525e-02, -4.58584750e-02, -4.32358975e-02, -4.06133200e-02, -3.79907425e-02, -3.53681650e-02, -3.26817975e-02, -3.45669095e-02, -3.40062322e-02, -1.51016963e-02,  1.16675844e-02,  3.84368650e-02,  6.52061456e-02,  8.01983359e-02,  7.97001685e-02,  7.92020012e-02,  7.87038338e-02,  7.82056664e-02,  7.77074991e-02,  7.72093317e-02,  7.67111643e-02,  7.62129970e-02,  7.57148296e-02,  7.52166622e-02,  7.47184949e-02,  7.42203275e-02,  7.66071437e-02,  8.01741090e-02,  8.37410743e-02,  8.73080396e-02,  9.08750049e-02,  9.44419702e-02,  9.80089355e-02,  1.01575901e-01,  1.05142866e-01,  1.14308652e-01,  1.30402852e-01,  1.45621633e-01,  1.83568357e-01,  2.30921913e-01,  2.70266657e-01,  3.03920147e-01,  3.37573638e-01,  3.71227129e-01,  4.04880620e-01,  4.38534111e-01,  4.49818289e-01,  4.60546027e-01,  4.71273765e-01,  4.82001504e-01,  4.78440840e-01,  4.70800879e-01,  4.47376330e-01,  4.15234791e-01,  3.83093253e-01,  3.50951714e-01,  3.18810175e-01,  3.18485282e-01,  3.19434637e-01,  3.20383993e-01,  3.21333348e-01,  3.22282703e-01,  3.23232059e-01,  3.24181414e-01,  3.25130770e-01,  3.26080125e-01,  3.27029481e-01,  3.27978836e-01,  3.28928192e-01,  3.29877547e-01,  3.30826903e-01,  3.32348695e-01,  3.35460283e-01,  3.38571870e-01,  3.41683458e-01,  3.44795046e-01,  3.47906633e-01,  3.51018221e-01,  3.54129809e-01,  3.57241397e-01,  3.60352984e-01,  3.63464572e-01,  3.64782536e-01,  3.55083242e-01,  3.52024391e-01,  3.50397210e-01,  3.49482160e-01,  3.47434715e-01,  3.45244736e-01,  3.43054758e-01,  3.40864779e-01,  3.41026124e-01,  3.41971400e-01,  3.42916675e-01,  3.43861950e-01,  3.44807226e-01,  3.45752501e-01,  3.46697777e-01,  3.47643052e-01,  3.48588327e-01,  3.49533603e-01,  3.50478878e-01,  3.51424153e-01,  3.52369429e-01,  3.52787315e-01,  3.52637674e-01,  3.52488032e-01,  3.52338390e-01,  3.52188749e-01,  3.52039107e-01,  3.51889466e-01,  3.51739824e-01,  3.51590183e-01,  3.51440541e-01,  3.51990994e-01,  3.52944030e-01,  3.57027912e-01,  3.58639982e-01,  3.56083695e-01,  3.50228712e-01,  3.44944044e-01,  3.36113404e-01,  3.28291947e-01,  3.22850511e-01,  3.17409076e-01,  3.11967640e-01,  3.08053667e-01,  3.06547302e-01,  3.05040937e-01,  3.01997931e-01,  3.01063590e-01,  3.02324226e-01,  3.07418044e-01,  3.15001370e-01,  3.22584696e-01,  3.30168022e-01,  3.32772137e-01,  3.32482836e-01,  3.32193536e-01,  3.31904236e-01,  3.31614936e-01,  3.31325636e-01,  3.31036336e-01,  3.30747036e-01,  3.30457736e-01,  3.30168435e-01,  3.29879135e-01,  3.29589835e-01,  3.27260826e-01,  3.24336144e-01,  3.21411461e-01,  3.18486779e-01,  3.15562096e-01,  3.12637414e-01,  3.09712731e-01,  3.06788049e-01,  3.04577782e-01,  3.03982203e-01,  3.05320192e-01,  3.05963058e-01,  3.18684119e-01,  3.31405179e-01,  3.44126240e-01,  3.56847301e-01,  3.57943740e-01,  3.48326775e-01,  3.38709811e-01,  3.29092846e-01,  3.19475881e-01,  3.09858916e-01,  3.00241952e-01,  2.90624987e-01,  2.81008022e-01,  2.71391057e-01,  2.61774093e-01,  2.52157128e-01,  2.42540163e-01,  2.32923199e-01,  2.23306234e-01,  2.21855089e-01,  2.22153464e-01,  2.22451839e-01,  2.22750214e-01,  2.23048588e-01,  2.23346963e-01,  2.23645338e-01,  2.23943712e-01,  2.24242087e-01,  2.24540462e-01,  2.26706638e-01,  2.32533772e-01,  2.34085656e-01,  2.31480968e-01,  2.24772513e-01,  2.17431303e-01,  2.12782923e-01,  2.08134544e-01,  2.08359706e-01,  2.10155056e-01,  2.08451807e-01,  2.04048259e-01,  2.03936650e-01,  2.04457791e-01,  2.04858937e-01,  2.03578143e-01,  2.02297350e-01,  2.01016556e-01,  1.99735763e-01,  1.98454969e-01,  1.97174175e-01,  1.95893382e-01,  1.94612588e-01,  1.92954023e-01,  1.88818827e-01,  1.84683631e-01,  1.80548435e-01,  1.76413239e-01,  1.72278043e-01,  1.68142847e-01,  1.66307943e-01,  1.63316374e-01,  1.53535824e-01,  1.43021457e-01,  1.32507089e-01,  1.27301475e-01,  1.24077473e-01,  1.20853471e-01,  1.17629469e-01,  1.14405467e-01,  1.11181464e-01,  1.07957462e-01,  1.04733460e-01,  1.01509458e-01,  1.00123503e-01,  9.91390359e-02,  9.81545684e-02,  9.71701010e-02,  9.61856335e-02,  9.52011661e-02};
float SS_servo7[] = {-0.10170077, -0.10628512, -0.10257522, -0.09881137, -0.0996671 , -0.09202797, -0.09116469, -0.09093233, -0.09737694, -0.10391144, -0.10942377, -0.11299283, -0.11656189, -0.12013096, -0.12237367, -0.12304737, -0.12372106, -0.1196724 , -0.10897948, -0.09754206, -0.09092825, -0.08431444, -0.07876777, -0.07394425, -0.06912074, -0.06429722, -0.0594737 , -0.05465019, -0.04982667, -0.04500316, -0.04017964, -0.04714588, -0.05668799, -0.0662301 , -0.0757722 , -0.08531431, -0.09485642, -0.10504996, -0.10761203, -0.11889661, -0.13860679, -0.14427243, -0.14993806, -0.1556037 , -0.15260339, -0.13820481, -0.12380623, -0.10940764, -0.09500906, -0.08061048, -0.06621189, -0.05181331, -0.03741473, -0.02301614, -0.00861756,  0.00578102,  0.02017961,  0.0147876 ,  0.00129993, -0.01218774, -0.02567541, -0.03916308, -0.05265075, -0.06613842, -0.07962609, -0.09311376, -0.1146963 , -0.1417543 , -0.15240628, -0.23379404, -0.32868089, -0.39259503, -0.43449922, -0.47640341, -0.5183076 , -0.56021179, -0.60211598, -0.56306861, -0.52200755, -0.4809465 , -0.43988544, -0.35717781, -0.27208601, -0.2133574 , -0.16996194, -0.12656647, -0.08317101, -0.03977555, -0.04203095, -0.04611467, -0.05019838, -0.05428209, -0.05836581, -0.06244952, -0.06653323, -0.07061694, -0.07470066, -0.07878437, -0.08286808, -0.0869518 , -0.09103551, -0.09511922, -0.10028317, -0.10844721, -0.11661124, -0.12477528, -0.13293931, -0.14110335, -0.14926738, -0.15743142, -0.16559545, -0.17375949, -0.18192352, -0.18297715, -0.12443969, -0.10226316, -0.09891062, -0.09970609, -0.09628953, -0.09237824, -0.08846696, -0.08455567, -0.08437932, -0.08544818, -0.08651705, -0.08758591, -0.08865477, -0.08972364, -0.0907925 , -0.09186137, -0.09293023, -0.09399909, -0.09506796, -0.09613682, -0.09720569, -0.09787206, -0.09810531, -0.09833856, -0.09857181, -0.09880506, -0.09903831, -0.09927156, -0.09950482, -0.09973807, -0.09997132, -0.10256053, -0.10712263, -0.11452581, -0.11856555, -0.11617071, -0.10718667, -0.10038312, -0.09570809, -0.09226544, -0.09085244, -0.08943944, -0.08802644, -0.08883793, -0.09315569, -0.09747344, -0.09592905, -0.09283487, -0.09507738, -0.10430361, -0.11545261, -0.1266016 , -0.1377506 , -0.14154527, -0.14106636, -0.14058745, -0.14010854, -0.13962963, -0.13915072, -0.13867181, -0.1381929 , -0.13771399, -0.13723508, -0.13675617, -0.13627726, -0.13291213, -0.12870411, -0.12449609, -0.12028806, -0.11608004, -0.11187202, -0.107664  , -0.10345598, -0.10098989, -0.10084864, -0.10100192, -0.1052598 , -0.13580739, -0.16635497, -0.19690256, -0.22745014, -0.23475784, -0.22064735, -0.20653686, -0.19242636, -0.17831587, -0.16420538, -0.15009489, -0.1359844 , -0.12187391, -0.10776341, -0.09365292, -0.07954243, -0.06543194, -0.05132145, -0.03721095, -0.03976857, -0.04589731, -0.05202604, -0.05815478, -0.06428352, -0.07041226, -0.076541  , -0.08266974, -0.08879848, -0.09492722, -0.10443825, -0.11859889, -0.12427191, -0.11978424, -0.10874991, -0.09442461, -0.08961579, -0.08480696, -0.09077261, -0.10026598, -0.10322046, -0.10049032, -0.10253261, -0.10536384, -0.10815106, -0.11032156, -0.11249205, -0.11466255, -0.11683305, -0.11900354, -0.12117404, -0.12334453, -0.12551503, -0.1268383 , -0.12260726, -0.11837623, -0.11414519, -0.10991415, -0.10568311, -0.10145208, -0.10258242, -0.10400396, -0.09099137, -0.07452691, -0.05806244, -0.05387339, -0.05426641, -0.05465944, -0.05505246, -0.05544548, -0.05583851, -0.05623153, -0.05662455, -0.05701758, -0.06254488, -0.06919368, -0.07584247, -0.08249126, -0.08914006, -0.09578885};

int node=0;
int first=0;
int input=0;
int end_time=0;
int time_step=120000; 
int steps = sizeof(SS_servo0)/sizeof(SS_servo0[0]);
int one_print = 0;

// -------------------Joint configurations-------------------
int servo0=0;
int servo0_deg=0;
int servo1=0;
int servo1_deg=0;
int servo2=0;
int servo2_deg=0;
int servo3=0;
int servo3_deg=0;
int servo4=0;
int servo4_deg=0;
int servo5=0;
int servo5_deg=0;
int servo6=0;
int servo6_deg=0;
int servo7=0;
int servo7_deg=0;

void setup() {
  Serial.begin(115200);
  pca9685.begin();

  pca9685.setOscillatorFrequency(27000000); //Value between 24MHz and 27MHz, tuned for this setup
  pca9685.setPWMFreq(SERVO_FREQ);
  delay (1000);

  servo0_deg=SS_servo0[0]/3.14159265*180;
  servo0=map(servo0_deg,-38,90,2200,1030);
  servo1_deg=SS_servo1[0]/3.14159265*180;
  servo1=map(servo1_deg,-90,90,2600,950);
  servo2_deg=SS_servo2[0]/3.14159265*180;
  servo2=map(servo2_deg,-38,90,1510,2730);
  servo3_deg=SS_servo3[0]/3.14159265*180;
  servo3=map(servo3_deg,-90,90,1100,2700);
  servo4_deg=SS_servo4[0]/3.14159265*180;
  servo4=map(servo4_deg,-90,38,2700,1500);
  servo5_deg=SS_servo5[0]/3.14159265*180;
  servo5=map(servo5_deg,-90,90,2600,930);
  servo6_deg=SS_servo6[0]/3.14159265*180;
  servo6=map(servo6_deg,-90,38,850,2250);
  servo7_deg=SS_servo7[0]/3.14159265*180;
  servo7=map(servo7_deg,-90,90,920,2620);
        
  pca9685.setPWM(SER0,0,servo0);
  pca9685.setPWM(SER1,0,servo1);
  pca9685.setPWM(SER2,0,servo2);
  pca9685.setPWM(SER3,0,servo3);
  pca9685.setPWM(SER4,0,servo4);
  pca9685.setPWM(SER5,0,servo5);
  pca9685.setPWM(SER6,0,servo6);
  pca9685.setPWM(SER7,0,servo7);

  Serial.print("Node:");
  Serial.println(node);
  Serial.print("servo0 -> rads:");
  Serial.print(SS_servo0[node]);
  Serial.print("        deg:");
  Serial.print(servo0_deg);
  Serial.print("        us:");
  Serial.println(servo0);
  Serial.print("servo1 -> rads:");
  Serial.print(SS_servo1[node]);
  Serial.print("        deg:");
  Serial.print(servo1_deg);
  Serial.print("        us:");
  Serial.println(servo1);
  Serial.print("servo2 -> rads:");
  Serial.print(SS_servo2[node]);
  Serial.print("        deg:");
  Serial.print(servo2_deg);
  Serial.print("        us:");
  Serial.println(servo2);
  Serial.print("servo3 -> rads:");
  Serial.print(SS_servo3[node]);
  Serial.print("        deg:");
  Serial.print(servo3_deg);
  Serial.print("        us:");
  Serial.println(servo3);
  Serial.print("servo4 -> rads:");
  Serial.print(SS_servo4[node]);
  Serial.print("        deg:");
  Serial.print(servo4_deg);
  Serial.print("        us:");
  Serial.println(servo4);
  Serial.print("servo5 -> rads:");
  Serial.print(SS_servo5[node]);
  Serial.print("        deg:");
  Serial.print(servo5_deg);
  Serial.print("        us:");
  Serial.println(servo5);
  Serial.print("servo6 -> rads:");
  Serial.print(SS_servo6[node]);
  Serial.print("        deg:");
  Serial.print(servo6_deg);
  Serial.print("        us:");
  Serial.println(servo6);
  Serial.print("servo7 -> rads:");
  Serial.print(SS_servo7[node]);
  Serial.print("        deg:");
  Serial.print(servo7_deg);
  Serial.print("        us:");
  Serial.println(servo7);

  Serial.println("10");
  delay(1000);
  Serial.println("9");
  delay(1000);
  Serial.println("8");
  delay(1000);
  Serial.println("7");
  delay(1000);
  Serial.println("6");
  delay(1000);
  Serial.println("5");
  delay(1000);
  Serial.println("4");
  delay(1000);
  Serial.println("3");
  delay(1000);
  Serial.println("2");
  delay(1000);
  Serial.println("1");
  delay(1000);

}

void loop() 
{
  if(Serial.available()>0)
  {
    first=Serial.read();
    if(first=='2')
    {
      input=2;
      node=0;
      one_print=1;
    }
    if(first=='1')
    {
      input=1;
      node=0;
      one_print=1;
    }
    if(first=='0')
    {
      input=0;
    }
  }
  if(input==1 or input==2)
  {
      if(esp_timer_get_time()>=end_time)
      {
        servo0_deg=SS_servo0[node]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[node]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[node]/3.14159265*180;
        servo2=map(servo2_deg,-38,90,1510,2730);
        servo3_deg=SS_servo3[node]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[node]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[node]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[node]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[node]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);
        
        node+=1;
        if(node>=steps and input==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          node=0;
        }
        if(node>=steps and input==2)
        {
          Serial.print("Input:");
          Serial.println(input);
          input=0;
        }
         end_time=esp_timer_get_time()+time_step;
      }
   }

  if(input == 0)
  {        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        if(one_print==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          Serial.print("Node:");
          Serial.println(node);
          Serial.print("servo0 -> rads:");
          Serial.print(SS_servo0[node]);
          Serial.print("        deg:");
          Serial.print(servo0_deg);
          Serial.print("        us:");
          Serial.println(servo0);
          Serial.print("servo1 -> rads:");
          Serial.print(SS_servo1[node]);
          Serial.print("        deg:");
          Serial.print(servo1_deg);
          Serial.print("        us:");
          Serial.println(servo1);
          Serial.print("servo2 -> rads:");
          Serial.print(SS_servo2[node]);
          Serial.print("        deg:");
          Serial.print(servo2_deg);
          Serial.print("        us:");
          Serial.println(servo2);
          Serial.print("servo3 -> rads:");
          Serial.print(SS_servo3[node]);
          Serial.print("        deg:");
          Serial.print(servo3_deg);
          Serial.print("        us:");
          Serial.println(servo3);
          Serial.print("servo4 -> rads:");
          Serial.print(SS_servo4[node]);
          Serial.print("        deg:");
          Serial.print(servo4_deg);
          Serial.print("        us:");
          Serial.println(servo4);
          Serial.print("servo5 -> rads:");
          Serial.print(SS_servo5[node]);
          Serial.print("        deg:");
          Serial.print(servo5_deg);
          Serial.print("        us:");
          Serial.println(servo5);
          Serial.print("servo6 -> rads:");
          Serial.print(SS_servo6[node]);
          Serial.print("        deg:");
          Serial.print(servo6_deg);
          Serial.print("        us:");
          Serial.println(servo6);
          Serial.print("servo7 -> rads:");
          Serial.print(SS_servo7[node]);
          Serial.print("        deg:");
          Serial.print(servo7_deg);
          Serial.print("        us:");
          Serial.println(servo7);
          one_print=0;
        }
  
  }
}
