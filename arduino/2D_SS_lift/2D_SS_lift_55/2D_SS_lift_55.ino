// HOW TO:
// ------------------------------
// Serial input = 2 -> Steps through gait sequence once and stops at the end.
// Serial input = 1 -> Steps through gait sequence in a loop.
// Serial input = 0 -> Stops infinite loop at the node where it is at that moment

//Gait template
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pca9685 = Adafruit_PWMServoDriver();

#define SERVO_FREQ 300
#define SER0 0 //Hip 1
#define SER1 1 //Knee 1
#define SER2 2 //Hip 2
#define SER3 3 //Knee 2
#define SER4 4 //Hip 3
#define SER5 5 //Knee 3
#define SER6 6 //Hip 4
#define SER7 7 //Knee 4

// Insert servo angles here:
// For 3D gaits, these angles are obtained from linearisation.py
// For 2D gaits, these angles are obtained from 2D_trajectory_reader.py
float SS_servo0[] = {-0.56969298, -0.53205101, -0.51831593, -0.53878672, -0.55221903, -0.56565134, -0.56992161, -0.56669713, -0.55801299, -0.54401612, -0.52904706, -0.51401247, -0.49897788, -0.48394329, -0.46890871, -0.4457327 , -0.42236009, -0.39898749, -0.37498332, -0.35216862, -0.33804269, -0.32391676, -0.30979083, -0.30095974, -0.29786253, -0.29476532, -0.28523423, -0.27390844, -0.26258265, -0.24705773, -0.20822224, -0.16938675, -0.13055126, -0.09171578, -0.05288029, -0.0140448 ,  0.02479069,  0.06362617,  0.10246166,  0.14129715,  0.18013264,  0.21488172,  0.24775764,  0.28063355,  0.31350947,  0.34638538,  0.3792613 ,  0.41213721,  0.44501313,  0.47150349,  0.48652077,  0.49913477,  0.51174877,  0.52436278,  0.53917384,  0.55481141,  0.56970019,  0.58087133,  0.59204247,  0.60321361,  0.60037343,  0.59544527,  0.59051711,  0.58558894,  0.58066078,  0.57573262,  0.57080445,  0.56587629,  0.56094813,  0.55601997,  0.54913279,  0.53987108,  0.53060937,  0.52134766,  0.51208595,  0.50282424,  0.49356253,  0.48430082,  0.46633768,  0.45555944,  0.45435087,  0.46233057,  0.47559709,  0.48700733,  0.49674405,  0.50490544,  0.50449518,  0.47184758,  0.43929288,  0.40840845,  0.37721699,  0.34426839,  0.31481045,  0.28244296,  0.25376855,  0.27290328,  0.29740003,  0.32189679, 0.34639354,  0.36331098,  0.35249827,  0.34168557,  0.33087286,  0.32006015,  0.30924745,  0.29843474,  0.28762204,  0.27680933,  0.26599663,  0.25518392,  0.24437121,  0.23355851,  0.2227458 ,  0.2119331 ,  0.20833247,  0.21145014,  0.21456782,  0.21768549,  0.22080317,  0.22392084,  0.22703852,  0.2301562 ,  0.23327387, 0.23639155,  0.23950922,  0.26160815,  0.27131427,  0.27719902,  0.28308377,  0.27547322,  0.25018833,  0.22490344,  0.19808505,  0.19082973,  0.20502259,  0.20963202,  0.21217547,  0.21195303,  0.21146294,  0.21097286,  0.21048277,  0.20999268,  0.20950259,  0.19930026,  0.18668918,  0.17407811,  0.16146703,  0.14849339,  0.14059798,  0.14018037,  0.13060802,  0.11752803,  0.10122365,  0.07560604,  0.04379471,  0.00705802, -0.03494389, -0.05758001, -0.06341081, -0.06845137, -0.07712636, -0.07433015, -0.06988871, -0.06544726, -0.06100582, -0.05656437, -0.05700772, -0.05845713, -0.05990654, -0.06135595, -0.06280536, -0.06425477, -0.06570418, -0.06715359, -0.068603  , -0.07005241, -0.07150182, -0.07295123, -0.07440064, -0.07585006, -0.07690868, -0.07540437, -0.07390007, -0.07239577, -0.07089146, -0.06938716, -0.06788285, -0.06637855, -0.06487424, -0.06336994, -0.06186563, -0.06406067, -0.07025063, -0.07493258, -0.07775377, -0.08057496, -0.08339614, -0.08621733, -0.08903851, -0.09201285, -0.10128995, -0.11056706, -0.11984416, -0.12912127, -0.14263973, -0.17196022, -0.20934401, -0.24475708, -0.28307886, -0.31870954, -0.35434022, -0.38987843, -0.42429618, -0.45871393, -0.50520333, -0.5693354 };
float SS_servo1[] = { 1.20400336,  1.22417067,  1.25426425,  1.26876844,  1.26146109,  1.25415373,  1.21822937,  1.15889567,  1.08763982,  1.00478271,  0.93624925,  0.86868116,  0.80111307,  0.73354498,  0.66597689,  0.5927145 ,  0.5193146 ,  0.4459147 ,  0.36951895,  0.30663461,  0.31584918,  0.32506376,  0.33427833,  0.37388156,  0.44639325,  0.51890495,  0.59965335,  0.68269935,  0.76574535,  0.83460664,  0.82472461,  0.81484258,  0.80496056,  0.79507853,  0.7851965 ,  0.77531447,  0.76543244,  0.75555041,  0.74566838,  0.73578635,  0.72590432,  0.69648661,  0.65811393,  0.61974124,  0.58136856,  0.54299587,  0.50462319,  0.4662505 ,  0.42787782,  0.39497148,  0.36937242,  0.33858281,  0.30779321,  0.27700361,  0.23867162,  0.19750233,  0.15916895,  0.13491568,  0.11066242,  0.08640916,  0.08306868,  0.08284464,  0.08262061,  0.08239657,  0.08217254,  0.0819485 ,  0.08172447,  0.08150044,  0.0812764 ,  0.08105237,  0.08621457,  0.09790546,  0.10959635,  0.12128723,  0.13297812,  0.14466901,  0.15635989,  0.16805078,  0.19598061,  0.21205584,  0.20707346,  0.18241302,  0.16002272,  0.15497138,  0.15461154,  0.17029745,  0.20754469,  0.27130934,  0.33031298,  0.38778394,  0.44893267,  0.51081938,  0.56547898,  0.62515906,  0.67229318,  0.59445112,  0.50252618,  0.41060124,  0.3186763 ,  0.24757944,  0.25268543,  0.25779143,  0.26289742,  0.26800341,  0.27310941,  0.2782154 ,  0.2833214 ,  0.28842739,  0.29353338,  0.29863938,  0.30374537,  0.30885137,  0.31395736,  0.31906335,  0.31054775,  0.28934315,  0.26813854,  0.24693394,  0.22572933,  0.20452473,  0.18332012,  0.16211552,  0.14091091, 0.11970631,  0.0985017 ,  0.0405853 ,  0.01349514, -0.00449419, -0.02248351, -0.01069686,  0.04008633,  0.09086952,  0.14231922,  0.14946255,  0.1118459 ,  0.0885482 ,  0.06890064,  0.05771825,  0.04735502,  0.03699179,  0.02662856,  0.01626532,  0.00590209,  0.01579584,  0.03071353,  0.04563122,  0.06054892,  0.07685738,  0.08400938,  0.07476328,  0.07946617,  0.09069867,  0.10843551,  0.14495926,  0.19206991,  0.24977034,  0.31697183,  0.3391471 ,  0.31872839,  0.30817482,  0.30986683,  0.30046557,  0.29873282,  0.29700007,  0.29526732,  0.29353457,  0.28880456,  0.28345723,  0.2781099 ,  0.27276258,  0.26741525,  0.26206793,  0.2567206,  0.25137327,  0.24602595,  0.24067862,  0.2353313 ,  0.22998397,  0.22463665,  0.21928932,  0.21372276,  0.20671841,  0.19971406,  0.19270971,  0.18570537,  0.17870102,  0.17169667,  0.16469232,  0.15768797,  0.15068362,  0.14367927,  0.14368596,  0.15126386,  0.15625053,  0.15803982,  0.15982911,  0.1616184 ,  0.16340769,  0.16519698,  0.16736107,  0.18494994,  0.20253881,  0.22012768,  0.23771655,  0.26390386,  0.32382022,  0.40498761,  0.48961059,  0.5816665 ,  0.66658268,  0.75149886,  0.83648833,  0.92236596,  1.0082436 ,  1.09144147,  1.1649544 };
float SS_servo2[] = {-0.41100675, -0.37693283, -0.36919104, -0.39404543, -0.41221564, -0.43038586, -0.43994091, -0.44244857, -0.43960815, -0.4315636 , -0.4238924 , -0.41624637, -0.40860033, -0.40095429, -0.39330826, -0.37510664, -0.35665011, -0.33819359, -0.31644899, -0.29177649, -0.27654574, -0.26131499, -0.24608424, -0.22870786, -0.20900795, -0.18930803, -0.18962308, -0.19552122, -0.20141936, -0.20650665, -0.20709267, -0.20767868, -0.20826469, -0.20885071, -0.20943672, -0.21002274, -0.21060875, -0.21119476, -0.21178078, -0.21236679, -0.21295281, -0.22131024, -0.23323002, -0.2451498 , -0.25706958, -0.26898936, -0.28090914, -0.29282892, -0.3047487 , -0.31970302, -0.34220929, -0.37191054, -0.4016118 , -0.43131305, -0.47016039, -0.51244832, -0.55216672, -0.57912755, -0.60608839, -0.63304922, -0.63150705, -0.62571732, -0.6199276 , -0.61413787, -0.60834814, -0.60255842, -0.59676869, -0.59097896, -0.58518924, -0.57939951, -0.57265742, -0.56476097, -0.55686453, -0.54896808, -0.54107163, -0.53317518, -0.52527874, -0.51738229, -0.51375398, -0.50092331, -0.48530721, -0.46916114, -0.46428006, -0.47145949, -0.48315949, -0.50811062, -0.53167603, -0.53401118, -0.5247724 , -0.51892452, -0.51794302, -0.52110431, -0.52720555, -0.52799155, -0.50607818, -0.46483062, -0.4214486 , -0.37806658, -0.33468455, -0.3006011 , -0.30053795, -0.30047479, -0.30041164, -0.30034849, -0.30028533, -0.30022218, -0.30015902, -0.30009587, -0.30003272, -0.29996956, -0.29990641, -0.29984325, -0.2997801 , -0.29971694, -0.30963173, -0.32884133, -0.34805093, -0.36726052, -0.38647012, -0.40567972, -0.42488932, -0.44409891, -0.46330851, -0.48251811, -0.5017277 , -0.51109377, -0.50394669, -0.49306109, -0.48217548, -0.46187527, -0.42924509, -0.3966149 , -0.37515562, -0.36345927, -0.35044372, -0.34694292, -0.34440085, -0.34130756, -0.33816094, -0.33501431, -0.33186768, -0.32872106, -0.32557443, -0.31302322, -0.29813957, -0.28325592, -0.26837227, -0.24802806, -0.20623962, -0.14868899, -0.09355525, -0.04040566,  0.0093618 ,  0.04936039,  0.08494825,  0.11366513,  0.1396426 ,  0.15523156,  0.1460959 ,  0.13078841,  0.12009289,  0.12152432,  0.12302522,  0.12452611,  0.12602701,  0.1275279 ,  0.12551281,  0.12277356,  0.12003432,  0.11729507,  0.11455583,  0.11181658,  0.10907733,  0.10633809,  0.10359884,  0.1008596 ,  0.09812035,  0.09538111,  0.09264186,  0.08990261,  0.08689765,  0.08215003,  0.07740242,  0.0726548 ,  0.06790718,  0.06315956,  0.05841194,  0.05366432,  0.0489167 ,  0.04416908,  0.03942147,  0.03645767,  0.03542024,  0.0335648 ,  0.03070002,  0.02783524,  0.02497046,  0.02210568,  0.0192409 ,  0.01612852,  0.0028263 , -0.01047592, -0.02377814, -0.03708037, -0.054506  , -0.08556678, -0.1225171 , -0.15725905, -0.1961725 , -0.23123044, -0.26628838, -0.30098281, -0.33127235, -0.36156189, -0.39314171, -0.42648849};
float SS_servo3[] = { 1.1717361 ,  1.18028991,  1.21151703,  1.23659037,  1.2385506 ,  1.24051082,  1.2129379 ,  1.1612062 ,  1.09742699,  1.02192451,  0.96469636,  0.90869985,  0.85270333,  0.79670681,  0.74071029,  0.67546093,  0.60998814,  0.54451535,  0.47130133,  0.39336952,  0.34620444,  0.29903935,  0.25187427,  0.2028142 ,  0.15170202,  0.10058983,  0.09268944,  0.0968428 ,  0.10099617,  0.10367557,  0.0981726 ,  0.09266962,  0.08716665,  0.08166367,  0.0761607 ,  0.07065773,  0.06515475,  0.05965178,  0.0541488 ,  0.04864583,  0.04314286,  0.0512297 ,  0.06554598,  0.07986227,  0.09417855,  0.10849483,  0.12281112,  0.1371274 ,  0.15144369,  0.17115155,  0.20503732,  0.25389776,  0.30275821,  0.35161865,  0.42215157,  0.50083723,  0.57436176,  0.62226145,  0.67016115,  0.71806084,  0.70657453,  0.68623843,  0.66590234,  0.64556625,  0.62523015,  0.60489406,  0.58455797,  0.56422187,  0.54388578,  0.52354969,  0.50292019,  0.48193504,  0.46094989,  0.43996474,  0.41897959,  0.39799444,  0.3770093 ,  0.35602415,  0.34039009,  0.30994955,  0.27296096,  0.23341798,  0.21929145,  0.23010327,  0.24802959,  0.29249487,  0.33557417,  0.33071464,  0.3031513 ,  0.28297885,  0.27400816,  0.26924905,  0.27010646,  0.25851859,  0.19894981,  0.09836018, -0.00647238, -0.11130494, -0.21613749, -0.29508852, -0.27934786, -0.2636072 , -0.24786654, -0.23212588, -0.21638522, -0.20064456, -0.1849039 , -0.16916324, -0.15342258, -0.13768192, -0.12194126, -0.1062006 , -0.09045994, -0.07471928, -0.04116945,  0.00897025,  0.05910994,  0.10924964,  0.15938934,  0.20952904,  0.25966874,  0.30980843,  0.35994813, 0.41008783,  0.46022753,  0.46920194,  0.44863855,  0.42229532,  0.39595209,  0.35328534,  0.28924024,  0.22519514,  0.1791896 ,  0.14849991,  0.11462686,  0.1085906 ,  0.10648417,  0.15770259,  0.21408119,  0.27045978,  0.32683837,  0.38321696,  0.43959555,  0.51898132,  0.60407311,  0.68916489,  0.77425668,  0.84998015,  0.85578772,  0.78367514,  0.68411785,  0.58186746,  0.48214049,  0.38970211,  0.29914114,  0.21417373,  0.12455564,  0.06324245,  0.0499817 ,  0.0607404 ,  0.06659833,  0.06014138,  0.06445535,  0.06876932,  0.07308329,  0.07739726,  0.07593333,  0.07327939,  0.07062545,  0.06797151,  0.06531757,  0.06266363,  0.06000969,  0.05735575,  0.05470181,  0.05204787,  0.04939393,  0.04673999,  0.04408605,  0.04143211,  0.03988584,  0.04560406,  0.05132228,  0.0570405 ,  0.06275872,  0.06847695,  0.07419517,  0.07991339,  0.08563161,  0.09134983,  0.09706805,  0.09865996,  0.09579587,  0.09504829,  0.09691232,  0.09877635,  0.10064037,  0.1025044 ,  0.10436843,  0.10680355,  0.13274205,  0.15868054,  0.18461904,  0.21055754,  0.24495278,  0.30908931,  0.39051648,  0.4752155 ,  0.5703523 ,  0.65666667,  0.74298104,  0.82888815,  0.90986018,  0.9908322 ,  1.07205026,  1.14478676};
float SS_servo4[] = { 0.63418071,  0.64533354,  0.63331785,  0.60533414,  0.58152519,  0.55771623,  0.5378096 ,  0.52109517,  0.50252996,  0.48216378,  0.46619414,  0.4505208 ,  0.43484747,  0.41917413,  0.40350079,  0.39022999,  0.37701721,  0.36380443,  0.34854343,  0.33126144,  0.31908719,  0.30691295,  0.29473871,  0.28343439,  0.27307213,  0.26270987,  0.25714648,  0.25292173,  0.24869697,  0.24438926,  0.23962104,  0.23485282,  0.2300846 ,  0.22531638,  0.22054816,  0.21577994,  0.21101171,  0.20624349,  0.20147527,  0.19670705,  0.19193883,  0.18846129,  0.18557539,  0.18268949,  0.17980359,  0.17691769,  0.17403178,  0.17114588,  0.16825998,  0.16538821,  0.161432  ,  0.1542818 ,  0.1471316 ,  0.1399814 ,  0.13041809,  0.11994702,  0.1104411 ,  0.1057271 ,  0.1010131 ,  0.0962991 ,  0.09243828,  0.0887046 ,  0.08497092,  0.08123724,  0.07750357,  0.07376989,  0.07003621,  0.06630254,  0.06256886,  0.05883518,  0.05555696,  0.0528308 ,  0.05010464,  0.04737847,  0.04465231,  0.04192615,  0.03919999,  0.03647383,  0.03792829,  0.04403592,  0.05048187,  0.05577135,  0.05105062,  0.04215569,  0.03178544,  0.02175196,  0.01176276,  0.00602944,  0.0014777 , -0.00255252, -0.00311334, -0.00612412, -0.00852116, -0.01442537, -0.03167056, -0.04434306, -0.05572812, -0.06711318, -0.07849825, -0.08915006, -0.09711919, -0.10508831, -0.11305744, -0.12102656, -0.12899569, -0.13696482, -0.14493394, -0.15290307, -0.16087219, -0.16884132, -0.17681044, -0.18477957, -0.1927487 , -0.20071782, -0.20774087, -0.21388262, -0.22002436, -0.22616611, -0.23230786, -0.2384496 , -0.24459135, -0.2507331 , -0.25687484, -0.26301659, -0.26915834, -0.27600452, -0.27914629, -0.2813372 , -0.28352811, -0.28488982, -0.28516554, -0.28544127, -0.28440137, -0.28772214, -0.29441948, -0.30371884, -0.3140048 , -0.32056301, -0.32676049, -0.33295798, -0.33915546, -0.34535294, -0.35155043, -0.35386742, -0.35522202, -0.35657661, -0.3579312 , -0.35767823, -0.35118228, -0.3436369 , -0.34138682, -0.33883768, -0.3367238 , -0.33586709, -0.33993092, -0.349637  , -0.3732277 , -0.41807407, -0.46531106, -0.47498107, -0.48956643, -0.50723015, -0.51273176, -0.51823336, -0.52373497, -0.52923657, -0.48573625, -0.43214349, -0.37855074, -0.32495799, -0.27136524, -0.21777249, -0.16417974, -0.11058698, -0.05699423, -0.00340148,  0.05019127,  0.10378402,  0.15737677,  0.21096953,  0.26186168,  0.29504232,  0.32822296,  0.3614036 ,  0.39458424,  0.42776489,  0.46094553,  0.49412617,  0.52730681,  0.56048745,  0.59366809,  0.61126121,  0.61202136,  0.61120573,  0.60844572,  0.6056857 ,  0.60292569,  0.60016568,  0.59740566,  0.59464525,  0.59186865,  0.58909205,  0.58631545,  0.58353885,  0.58118977,  0.57698388,  0.57210159,  0.56986366,  0.57129964,  0.57803424,  0.58476883,  0.59234367,  0.61010031,  0.62785695,  0.63751748,  0.63034001};
float SS_servo5[] = {-0.11834961, -0.14865644, -0.14008116, -0.10911059, -0.09259737, -0.07608414, -0.0775661 , -0.09376851, -0.10871462, -0.12243824, -0.13014281, -0.13744172, -0.14474063, -0.15203954, -0.15933845, -0.16177147, -0.164087  , -0.16640252, -0.16598948, -0.16066018, -0.15340725, -0.14615432, -0.1389014 , -0.13076788, -0.12168076, -0.11259364, -0.11004396, -0.10931788, -0.1085918 , -0.10753297, -0.10462703, -0.10172108, -0.09881513, -0.09590919, -0.09300324, -0.0900973 , -0.08719135, -0.0842854 , -0.08137946, -0.07847351, -0.07556757, -0.07697974, -0.0803713 , -0.08376287, -0.08715443, -0.09054599, -0.09393755, -0.09732912, -0.10072068, -0.10466282, -0.10685783, -0.10137192, -0.09588601, -0.09040011, -0.07410345, -0.05374   , -0.03526355, -0.02615594, -0.01704834, -0.00794073, -0.00814666, -0.0097405 , -0.01133435, -0.01292819, -0.01452204, -0.01611588, -0.01770973, -0.01930357, -0.02089742, -0.02249126, -0.02381127, -0.02479937, -0.02578746, -0.02677555, -0.02776365, -0.02875174, -0.02973983, -0.03072793, -0.04218297, -0.06029124, -0.08012444, -0.0989349 , -0.09363512, -0.07837632, -0.06169614, -0.04447054, -0.02570185, -0.02282122, -0.02300797, -0.02321648, -0.02859081, -0.03250611, -0.03763845, -0.03761404, -0.01780385, -0.02624357, -0.03991391, -0.05358426, -0.0672546 , -0.07795174, -0.07777092, -0.07759011, -0.07740929, -0.07722847, -0.07704766, -0.07686684, -0.07668602, -0.0765052 , -0.07632439, -0.07614357, -0.07596275, -0.07578194, -0.07560112, -0.0754203 , -0.07674286, -0.07946585, -0.08218885, -0.08491185, -0.08763485, -0.09035785, -0.09308085, -0.09580384, -0.09852684, -0.10124984, -0.10397284, -0.10317994, -0.1040362 , -0.10543912, -0.10684203, -0.10783488, -0.10829068, -0.10874647, -0.11483093, -0.11591122, -0.11049369, -0.1054854 , -0.09908673, -0.09754691, -0.09647728, -0.09540764, -0.09433801, -0.09326837, -0.09219873, -0.09889097, -0.10750824, -0.11612551, -0.12474277, -0.1360501 , -0.15910935, -0.18555864, -0.20630882, -0.22849191, -0.25004251, -0.26976622, -0.28159941, -0.28153005, -0.25387271, -0.18640978, -0.13141537, -0.17308201, -0.17200105, -0.14238477, -0.14331522, -0.14424566, -0.14517611, -0.14610655, -0.23273101, -0.33700499, -0.44127896, -0.54555294, -0.64982692, -0.75410089, -0.85837487, -0.96264885, -1.06692282, -1.1711968 , -1.27547078, -1.37974475, -1.48401873, -1.58829271, -1.68198495, -1.70627828, -1.7305716 , -1.75486493, -1.77915826, -1.80345159, -1.82774491, -1.85203824, -1.87633157, -1.90062489, -1.92491822, -1.91316393, -1.86248185, -1.79803673, -1.71660911, -1.63518148, -1.55375386, -1.47232623, -1.39089861, -1.3092766 , -1.21965454, -1.13003249, -1.04041043, -0.95078838, -0.8653127 , -0.78305034, -0.69938348, -0.61442066, -0.53034015, -0.44185572, -0.35337128, -0.26493742, -0.17711636, -0.0892953 , -0.0472564 , -0.06617989};
float SS_servo6[] = {0.63418164, 0.64533482, 0.63258077, 0.60206178, 0.57620059, 0.5503394 , 0.52819644, 0.5090951 , 0.49359598, 0.48160215, 0.46619449, 0.45055675, 0.43491901, 0.41928127, 0.40364353, 0.38820565, 0.3727726 , 0.35733954, 0.34231716, 0.32862924, 0.3175641 , 0.30649895, 0.29543381, 0.28442992, 0.27349236, 0.2625548 , 0.25561446, 0.24978912, 0.24396378, 0.23829292, 0.23347964, 0.22866637, 0.22385309, 0.21903981, 0.21422653, 0.20941325, 0.20459997, 0.19978669, 0.19497341, 0.19016013, 0.18534685, 0.18132282, 0.17766058, 0.17399834, 0.1703361 , 0.16667386, 0.16301162, 0.15934937, 0.15568713, 0.15223303, 0.14876871, 0.14427527, 0.13978183, 0.13528838, 0.12733772, 0.11808653, 0.10829407, 0.09581425, 0.08333444, 0.07085462, 0.06703383, 0.06450342, 0.061973  , 0.05944259, 0.05691218, 0.05438176, 0.05185135, 0.04932094, 0.04679053, 0.04426011, 0.04238957, 0.04131886, 0.04024816, 0.03917745, 0.03810674, 0.03703603, 0.03596533, 0.03489462, 0.03242902, 0.03328739, 0.03747927, 0.04561531, 0.07399027, 0.1121335 , 0.14983915, 0.1865319 , 0.22509309, 0.26649806, 0.31109936, 0.35886452, 0.40767778, 0.45772695, 0.50831813, 0.55623762, 0.59842177, 0.63469817, 0.67124378, 0.70778938, 0.74433499, 0.77177875, 0.76592199, 0.76006522, 0.75420846, 0.74835169, 0.74249493, 0.73663817, 0.7307814 , 0.72492464, 0.71906787, 0.71321111, 0.70735434, 0.70149758, 0.69564082, 0.68978405, 0.67187835, 0.64274864, 0.61361893, 0.58448922, 0.55535951, 0.5262298 , 0.49710009, 0.46797038, 0.43884067, 0.40971096, 0.38058125, 0.35626816, 0.34822312, 0.34404911, 0.33987511, 0.34676456, 0.36814344, 0.38952233, 0.4092177 , 0.41919807, 0.42811723, 0.44102086, 0.45427965, 0.45943552, 0.46380728, 0.46817905, 0.47255081, 0.47692257, 0.48129434, 0.48678767, 0.49255916, 0.49833065, 0.50410213, 0.51159248, 0.51976285, 0.5260726 , 0.53171391, 0.53684098, 0.542534  , 0.54986171, 0.55816387, 0.56490275, 0.56725781, 0.56680636, 0.55717636, 0.54175679, 0.52270138, 0.48445356, 0.42972077, 0.37498798, 0.32025519, 0.26552241, 0.25334765, 0.24993814, 0.24652863, 0.24311913, 0.23970962, 0.23630011, 0.2328906 , 0.22948109, 0.22607158, 0.22266207, 0.21925256, 0.21584305, 0.21243355, 0.20902404, 0.20472405, 0.19458403, 0.184444  , 0.17430397, 0.16416394, 0.15402391, 0.14388388, 0.13374385, 0.12360382, 0.11346379, 0.10332376, 0.09122606, 0.07701427, 0.06521532, 0.05639362, 0.04757192, 0.03875021, 0.02992851, 0.0211068 , 0.01281658, 0.02639943, 0.03998228, 0.05356513, 0.06714798, 0.08620817, 0.12243418, 0.16840888, 0.21800883, 0.27303186, 0.33234569, 0.39165952, 0.45195364, 0.5241266 , 0.59629955, 0.64495193, 0.63683477};
float SS_servo7[] = {-1.18351737e-01, -1.48659517e-01, -1.38636505e-01, -1.02686998e-01, -8.21299927e-02, -6.15729879e-02, -5.86646104e-02, -7.01931972e-02, -9.11616863e-02, -1.21316007e-01, -1.30156599e-01, -1.37560716e-01, -1.44964833e-01, -1.52368949e-01, -1.59773066e-01, -1.57979281e-01, -1.55963382e-01, -1.53947482e-01, -1.54040013e-01, -1.55818146e-01, -1.50788889e-01, -1.45759631e-01, -1.40730374e-01, -1.33214659e-01, -1.23006309e-01, -1.12797960e-01, -1.07405010e-01, -1.03355297e-01, -9.93055840e-02, -9.54256259e-02, -9.24880255e-02, -8.95504250e-02, -8.66128246e-02, -8.36752241e-02, -8.07376237e-02, -7.78000232e-02, -7.48624228e-02, -7.19248223e-02, -6.89872219e-02, -6.60496214e-02, -6.31120210e-02, -6.34839812e-02, -6.53730136e-02, -6.72620460e-02, -6.91510784e-02, -7.10401108e-02, -7.29291432e-02, -7.48181756e-02, -7.67072080e-02, -7.94679020e-02, -8.25805567e-02, -8.25211632e-02, -8.24617697e-02, -8.24023762e-02, -6.94382750e-02, -5.16196843e-02, -3.25981693e-02, -7.60417710e-03,  1.73898151e-02,  4.23838072e-02,  4.20374965e-02,  3.79149405e-02,  3.37923844e-02,  2.96698284e-02,  2.55472724e-02,  2.14247163e-02,  1.73021603e-02,  1.31796042e-02,  9.05704821e-03,  4.93449218e-03,  6.70065091e-04, -3.76632440e-03, -8.20271389e-03, -1.26391034e-02, -1.70754929e-02, -2.15118824e-02, -2.59482718e-02, -3.03846613e-02, -3.38666171e-02, -4.13033680e-02, -5.65688087e-02, -8.12040627e-02, -1.44165198e-01, -2.32731665e-01, -3.23508201e-01, -4.08806144e-01, -4.92183200e-01, -5.80496059e-01, -6.66876908e-01, -7.54413591e-01, -8.35182016e-01, -9.17276567e-01, -9.96566871e-01, -1.06689615e+00, -1.12135899e+00, -1.16740535e+00, -1.21513280e+00, -1.26286025e+00, -1.31058770e+00, -1.33579613e+00, -1.27861511e+00, -1.22143408e+00, -1.16425306e+00, -1.10707204e+00, -1.04989102e+00, -9.92709995e-01, -9.35528972e-01, -8.78347950e-01, -8.21166928e-01, -7.63985905e-01, -7.06804883e-01, -6.49623860e-01, -5.92442838e-01, -5.35261816e-01, -4.88176291e-01, -4.50495082e-01, -4.12813873e-01, -3.75132664e-01, -3.37451455e-01, -2.99770246e-01, -2.62089036e-01, -2.24407827e-01, -1.86726618e-01, -1.49045409e-01, -1.11364200e-01, -7.62617497e-02, -6.73796375e-02, -6.49364307e-02, -6.24932239e-02, -7.99164446e-02, -1.23358025e-01, -1.66799606e-01, -2.09238754e-01, -2.36284626e-01, -2.61620656e-01, -2.99849322e-01, -3.39328203e-01, -3.60444412e-01, -3.79783691e-01, -3.99122971e-01, -4.18462251e-01, -4.37801530e-01, -4.57140810e-01, -4.78121966e-01, -4.99510326e-01, -5.20898685e-01, -5.42287045e-01, -5.66303489e-01, -5.90336692e-01, -6.11906222e-01, -6.36902092e-01, -6.61561370e-01, -6.87426534e-01, -7.16774744e-01, -7.50199456e-01, -7.80612762e-01, -8.04638299e-01, -8.27807611e-01, -8.41091471e-01, -8.32548663e-01, -8.12534427e-01, -7.40819983e-01, -6.24036586e-01, -5.07253190e-01, -3.90469793e-01, -2.73686397e-01, -2.55091492e-01, -2.56719467e-01, -2.58347442e-01, -2.59975417e-01, -2.61603392e-01, -2.63231367e-01, -2.64859342e-01, -2.66487317e-01, -2.68115292e-01, -2.69743267e-01, -2.71371242e-01, -2.72999217e-01, -2.74627192e-01, -2.76255167e-01, -2.75460485e-01, -2.58777126e-01, -2.42093766e-01, -2.25410406e-01, -2.08727047e-01, -1.92043687e-01, -1.75360327e-01, -1.58676968e-01, -1.41993608e-01, -1.25310248e-01, -1.08626889e-01, -8.85004373e-02, -6.46557937e-02, -4.52594553e-02, -3.13519740e-02, -1.74444928e-02, -3.53701158e-03,  1.03704696e-02,  2.42779509e-02,  3.71746515e-02,  8.47283840e-03, -2.02289747e-02, -4.89307878e-02, -7.76326009e-02, -1.17382374e-01, -1.90134642e-01, -2.41431470e-01, -2.25712743e-01, -1.90867728e-01, -2.02523009e-01, -2.14178290e-01, -2.29310276e-01, -2.86571640e-01, -3.43833004e-01, -3.46002913e-01, -1.73064336e-01};

int node=0;
int first=0;
int input=0;
int end_time=0;
int time_step=120000;
int steps = sizeof(SS_servo0)/sizeof(SS_servo0[0]);
int one_print = 0;

// -------------------Joint configurations-------------------
int servo0=0;
int servo0_deg=0;
int servo1=0;
int servo1_deg=0;
int servo2=0;
int servo2_deg=0;
int servo3=0;
int servo3_deg=0;
int servo4=0;
int servo4_deg=0;
int servo5=0;
int servo5_deg=0;
int servo6=0;
int servo6_deg=0;
int servo7=0;
int servo7_deg=0;

void setup() {
  Serial.begin(115200);
  pca9685.begin();

  pca9685.setOscillatorFrequency(27000000); //Value between 24MHz and 27MHz, tuned for this setup
  pca9685.setPWMFreq(SERVO_FREQ);
  delay (1000);

  servo0_deg=SS_servo0[0]/3.14159265*180;
  servo0=map(servo0_deg,-38,90,2200,1030);
  servo1_deg=SS_servo1[0]/3.14159265*180;
  servo1=map(servo1_deg,-90,90,2600,950);
  servo2_deg=SS_servo2[0]/3.14159265*180;
  servo2=map(servo2_deg,-38,90,1510,2730);
  servo3_deg=SS_servo3[0]/3.14159265*180;
  servo3=map(servo3_deg,-90,90,1100,2700);
  servo4_deg=SS_servo4[0]/3.14159265*180;
  servo4=map(servo4_deg,-90,38,2700,1500);
  servo5_deg=SS_servo5[0]/3.14159265*180;
  servo5=map(servo5_deg,-90,90,2600,930);
  servo6_deg=SS_servo6[0]/3.14159265*180;
  servo6=map(servo6_deg,-90,38,850,2250);
  servo7_deg=SS_servo7[0]/3.14159265*180;
  servo7=map(servo7_deg,-90,90,920,2620);
        
  pca9685.setPWM(SER0,0,servo0);
  pca9685.setPWM(SER1,0,servo1);
  pca9685.setPWM(SER2,0,servo2);
  pca9685.setPWM(SER3,0,servo3);
  pca9685.setPWM(SER4,0,servo4);
  pca9685.setPWM(SER5,0,servo5);
  pca9685.setPWM(SER6,0,servo6);
  pca9685.setPWM(SER7,0,servo7);

  Serial.print("Node:");
  Serial.println(node);
  Serial.print("servo0 -> rads:");
  Serial.print(SS_servo0[node]);
  Serial.print("        deg:");
  Serial.print(servo0_deg);
  Serial.print("        us:");
  Serial.println(servo0);
  Serial.print("servo1 -> rads:");
  Serial.print(SS_servo1[node]);
  Serial.print("        deg:");
  Serial.print(servo1_deg);
  Serial.print("        us:");
  Serial.println(servo1);
  Serial.print("servo2 -> rads:");
  Serial.print(SS_servo2[node]);
  Serial.print("        deg:");
  Serial.print(servo2_deg);
  Serial.print("        us:");
  Serial.println(servo2);
  Serial.print("servo3 -> rads:");
  Serial.print(SS_servo3[node]);
  Serial.print("        deg:");
  Serial.print(servo3_deg);
  Serial.print("        us:");
  Serial.println(servo3);
  Serial.print("servo4 -> rads:");
  Serial.print(SS_servo4[node]);
  Serial.print("        deg:");
  Serial.print(servo4_deg);
  Serial.print("        us:");
  Serial.println(servo4);
  Serial.print("servo5 -> rads:");
  Serial.print(SS_servo5[node]);
  Serial.print("        deg:");
  Serial.print(servo5_deg);
  Serial.print("        us:");
  Serial.println(servo5);
  Serial.print("servo6 -> rads:");
  Serial.print(SS_servo6[node]);
  Serial.print("        deg:");
  Serial.print(servo6_deg);
  Serial.print("        us:");
  Serial.println(servo6);
  Serial.print("servo7 -> rads:");
  Serial.print(SS_servo7[node]);
  Serial.print("        deg:");
  Serial.print(servo7_deg);
  Serial.print("        us:");
  Serial.println(servo7);

  Serial.println("10");
  delay(1000);
  Serial.println("9");
  delay(1000);
  Serial.println("8");
  delay(1000);
  Serial.println("7");
  delay(1000);
  Serial.println("6");
  delay(1000);
  Serial.println("5");
  delay(1000);
  Serial.println("4");
  delay(1000);
  Serial.println("3");
  delay(1000);
  Serial.println("2");
  delay(1000);
  Serial.println("1");
  delay(1000);

}

void loop() 
{
  if(Serial.available()>0)
  {
    first=Serial.read();
    if(first=='2')
    {
      input=2;
      node=0;
      one_print=1;
    }
    if(first=='1')
    {
      input=1;
      node=0;
      one_print=1;
    }
    if(first=='0')
    {
      input=0;
    }
  }
  if(input==1 or input==2)
  {
      if(esp_timer_get_time()>=end_time)
      {
        servo0_deg=SS_servo0[node]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[node]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[node]/3.14159265*180;
        servo2=map(servo2_deg,-38,90,1510,2730);
        servo3_deg=SS_servo3[node]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[node]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[node]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[node]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[node]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);
        
        node+=1;
        if(node>=steps and input==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          node=0;
        }
        if(node>=steps and input==2)
        {
          Serial.print("Input:");
          Serial.println(input);
          input=0;
        }
         end_time=esp_timer_get_time()+time_step;
      }
   }

  if(input == 0)
  {        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        if(one_print==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          Serial.print("Node:");
          Serial.println(node);
          Serial.print("servo0 -> rads:");
          Serial.print(SS_servo0[node]);
          Serial.print("        deg:");
          Serial.print(servo0_deg);
          Serial.print("        us:");
          Serial.println(servo0);
          Serial.print("servo1 -> rads:");
          Serial.print(SS_servo1[node]);
          Serial.print("        deg:");
          Serial.print(servo1_deg);
          Serial.print("        us:");
          Serial.println(servo1);
          Serial.print("servo2 -> rads:");
          Serial.print(SS_servo2[node]);
          Serial.print("        deg:");
          Serial.print(servo2_deg);
          Serial.print("        us:");
          Serial.println(servo2);
          Serial.print("servo3 -> rads:");
          Serial.print(SS_servo3[node]);
          Serial.print("        deg:");
          Serial.print(servo3_deg);
          Serial.print("        us:");
          Serial.println(servo3);
          Serial.print("servo4 -> rads:");
          Serial.print(SS_servo4[node]);
          Serial.print("        deg:");
          Serial.print(servo4_deg);
          Serial.print("        us:");
          Serial.println(servo4);
          Serial.print("servo5 -> rads:");
          Serial.print(SS_servo5[node]);
          Serial.print("        deg:");
          Serial.print(servo5_deg);
          Serial.print("        us:");
          Serial.println(servo5);
          Serial.print("servo6 -> rads:");
          Serial.print(SS_servo6[node]);
          Serial.print("        deg:");
          Serial.print(servo6_deg);
          Serial.print("        us:");
          Serial.println(servo6);
          Serial.print("servo7 -> rads:");
          Serial.print(SS_servo7[node]);
          Serial.print("        deg:");
          Serial.print(servo7_deg);
          Serial.print("        us:");
          Serial.println(servo7);
          one_print=0;
        }
  
  }
}
