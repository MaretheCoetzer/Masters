// HOW TO:
// ------------------------------
// Serial input = 2 -> Steps through gait sequence once and stops at the end.
// Serial input = 1 -> Steps through gait sequence in a loop.
// Serial input = 0 -> Stops infinite loop at the node where it is at that moment

//Gait template
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pca9685 = Adafruit_PWMServoDriver();

#define SERVO_FREQ 300
#define SER0 0 //Hip 1
#define SER1 1 //Knee 1
#define SER2 2 //Hip 2
#define SER3 3 //Knee 2
#define SER4 4 //Hip 3
#define SER5 5 //Knee 3
#define SER6 6 //Hip 4
#define SER7 7 //Knee 4

// Insert servo angles here:
// For 3D gaits, these angles are obtained from linearisation.py
// For 2D gaits, these angles are obtained from 2D_trajectory_reader.py
float SS_servo0[] = { 0.06623797,  0.06656106,  0.06706125,  0.06753709,  0.06795245,  0.06843621,  0.06901883,  0.0696424 ,  0.06991436,  0.07026909,  0.07074431,  0.07135697,  0.07210296,  0.07310974,  0.07414117,  0.07450483,  0.07486313,  0.0757971 ,  0.07676604,  0.07876707,  0.08160262,  0.08723709,  0.0933774 ,  0.10363235,  0.11725321,  0.13376965,  0.1505341 ,  0.16180526,  0.16739567,  0.17298607,  0.17857648,  0.18416689,  0.18975729,  0.1953477 ,  0.2009381 ,  0.1936521 ,  0.18345079,  0.17324947,  0.16304816,  0.15284684,  0.14216457,  0.13005534,  0.11794612,  0.11522703,  0.11543334,  0.11563965,  0.11584595,  0.11605226,  0.11625857,  0.11646488,  0.11667118,  0.11961764,  0.12288124,  0.12614484,  0.12940844,  0.13267204,  0.13344737,  0.12396891,  0.11449044,  0.10501198,  0.09553352,  0.08663848,  0.07791856,  0.06919863,  0.06047871,  0.05175879,  0.04303886,  0.03431894,  0.02559901,  0.01687909,  0.00815917, -0.00056076, -0.00928068, -0.01800061, -0.02672053, -0.02945371, -0.03054116, -0.0316286 , -0.03271605, -0.0338035 , -0.03489095, -0.0359784 , -0.03706585, -0.0381533 , -0.03924075, -0.03891612, -0.03553254, -0.03373145, -0.03223929, -0.03074713, -0.02925497, -0.02692796, -0.02413351, -0.02133907, -0.01854462, -0.01575017, -0.01295572, -0.01016127, -0.00736682, -0.00457237, -0.00177792,  0.00101653,  0.00381098,  0.00660543,  0.00931151,  0.01166612,  0.01402072,  0.01637533,  0.01872994,  0.02108454,  0.02343915,  0.02579376,  0.02814837,  0.03050297,  0.0331639 ,  0.0361841 ,  0.03801817,  0.03952492,  0.04103166,  0.04253841,  0.04404515,  0.04562808,  0.04729137,  0.04895466,  0.05061795,  0.05236767,  0.05399051,  0.05540724,  0.05660672,  0.05764682,  0.05850632,  0.05926277,  0.05997764,  0.06066626,  0.06132762,  0.06195507,  0.06254255,  0.06313351,  0.06372876,  0.06431765,  0.06486659,  0.06538468,  0.06587827};
float SS_servo1[] = {-0.01205263, -0.01212646, -0.0122803 , -0.01239093, -0.01236432, -0.01250697, -0.01288508, -0.0132789 , -0.01296047, -0.01271899, -0.0127506 , -0.01311584, -0.01381322, -0.01508804, -0.01606005, -0.01600815, -0.01559227, -0.01614192, -0.01675796, -0.01933246, -0.02352302, -0.03322601, -0.04393199, -0.0628645 , -0.0885266 , -0.11842213, -0.14868025, -0.16785209, -0.1755593 , -0.1832665 , -0.19097371, -0.19868091, -0.20638812, -0.21409532, -0.22180253, -0.20620514, -0.18533141, -0.16445768, -0.14358395, -0.12271022, -0.10069192, -0.07527781, -0.0498637 , -0.04085452, -0.0369561 , -0.03305769, -0.02915927, -0.02526086, -0.02136245, -0.01746403, -0.01356562, -0.01102753, -0.00864689, -0.00626624, -0.0038856 , -0.00150495,  0.00502594,  0.02865942,  0.05229289,  0.07592637,  0.09955984,  0.10790598,  0.11166378,  0.11542158,  0.11917939,  0.12293719,  0.12669499,  0.1304528 ,  0.1342106 ,  0.1379684 ,  0.14172621,  0.14548401,  0.14924181,  0.15299962,  0.15675742,  0.14402922,  0.1267691 ,  0.10950897,  0.09224884,  0.07498872,  0.05772859,  0.04046847,  0.02320834,  0.00594822, -0.01131191, -0.01188607, -0.00654644, -0.00517536, -0.00406809, -0.00296081, -0.00185354, -0.00145625, -0.0014565 , -0.00145674, -0.00145699, -0.00145724, -0.00145748, -0.00145773, -0.00145798, -0.00145822, -0.00145847, -0.00145872, -0.00145896, -0.00145921, -0.00155694, -0.00204243, -0.00252791, -0.00301339, -0.00349888, -0.00398436, -0.00446985, -0.00495533, -0.00544081, -0.0059263 , -0.00578441, -0.00490671, -0.0049453 , -0.00523677, -0.00552824, -0.00581971, -0.00611118, -0.00658665, -0.00725623, -0.00792581, -0.00859538, -0.00944947, -0.01020369, -0.01075478, -0.01109032, -0.01126595, -0.01134211, -0.01134858, -0.01134509, -0.01135335, -0.01136503, -0.01136801, -0.01141427, -0.0114924 , -0.01160164, -0.0117257 , -0.0118407 , -0.01192724, -0.01199544};
float SS_servo2[] = { 0.08663155,  0.08702056,  0.08743671,  0.08817767,  0.08974253,  0.09047819,  0.09005086,  0.08971792,  0.09358417,  0.09747619,  0.09996537,  0.100355  ,  0.09874376,  0.09435938,  0.09167212,  0.09492573,  0.10286525,  0.11028565,  0.11765442,  0.12350016,  0.12847118,  0.12951847,  0.1297844 ,  0.12734993,  0.12270644,  0.1008535 ,  0.0775266 ,  0.06638422,  0.06784217,  0.06930013,  0.07075808,  0.07221603,  0.07367398,  0.07513194,  0.07658989,  0.06431823,  0.04893808,  0.03355794,  0.0181778 ,  0.00279765, -0.0185434 , -0.0575697 , -0.09659601, -0.11335158, -0.12316895, -0.13298633, -0.1428037 , -0.15262108, -0.16243845, -0.17225582, -0.1820732 , -0.16800573, -0.15117382, -0.13434191, -0.11751001, -0.1006781 , -0.08950149, -0.1016295 , -0.11375751, -0.12588552, -0.13801354, -0.13671075, -0.13137685, -0.12604295, -0.12070905, -0.11537515, -0.11004125, -0.10470735, -0.09937345, -0.09403955, -0.08870566, -0.08337176, -0.07803786, -0.07270396, -0.06737006, -0.06634303, -0.06649994, -0.06665685, -0.06681377, -0.06697068, -0.06712759, -0.0672845 , -0.06744141, -0.06759833, -0.06775524, -0.07475964, -0.0820558 , -0.08935908, -0.09686242, -0.10436575, -0.11186908, -0.11056043, -0.1043178 , -0.09807516, -0.09183253, -0.08558989, -0.07934726, -0.07310462, -0.06686199, -0.06061935, -0.05437671, -0.04813408, -0.04189144, -0.03564881, -0.02908063, -0.02121762, -0.01335461, -0.0054916 ,  0.00237142,  0.01023443,  0.01809744,  0.02596045,  0.03382346,  0.04168647,  0.04658253,  0.0479988 ,  0.04950246,  0.05103023,  0.052558  ,  0.05408577,  0.05561354,  0.05751063,  0.05979733,  0.06208403,  0.06437073,  0.06667932,  0.06898307,  0.07087403,  0.07239382,  0.07382472,  0.07515974,  0.07637774,  0.0774987 ,  0.07855019,  0.07954604,  0.08048445,  0.08136223,  0.08222138,  0.0830606 ,  0.08386126,  0.08459408,  0.0853231 ,  0.08608989};
float SS_servo3[] = {-0.08557556, -0.08577817, -0.08576756, -0.08639633, -0.08861653, -0.08925116, -0.08765469, -0.08617854, -0.09288499, -0.09955329, -0.10351392, -0.10339179, -0.09941666, -0.09006148, -0.08376236, -0.08935923, -0.10378436, -0.11703219, -0.13017691, -0.14028002, -0.14851044, -0.14910074, -0.14821107, -0.14166548, -0.13049315, -0.08473571, -0.03601613, -0.0115748 , -0.01224028, -0.01290576, -0.01357124, -0.01423672, -0.01490219, -0.01556767, -0.01623315,  0.00861192,  0.03923277,  0.06985362,  0.10047447,  0.13109532,  0.17339067,  0.25032282,  0.32725497,  0.34001206,  0.33277614,  0.32554021,  0.31830428,  0.31106836,  0.30383243,  0.29659651,  0.28936058,  0.22526483,  0.15458813,  0.08391142,  0.01323472, -0.05744199, -0.10778955, -0.07436375, -0.04093796, -0.00751217,  0.02591362,  0.03170041,  0.02919164,  0.02668287,  0.0241741 ,  0.02166533,  0.01915656,  0.01664779,  0.01413902,  0.01163025,  0.00912148,  0.00661271,  0.00410394,  0.00159517, -0.0009136 ,  0.00578333,  0.01501086,  0.02423838,  0.03346591,  0.04269344,  0.05192097,  0.0611485 ,  0.07037603,  0.07960356,  0.08883109,  0.11163303,  0.13462368,  0.15332394,  0.17198162,  0.1906393 ,  0.20929698,  0.20902585,  0.19815615,  0.18728645,  0.17641675,  0.16554706,  0.15467736,  0.14380766,  0.13293796,  0.12206826,  0.11119856,  0.10032886,  0.08945916,  0.07858946,  0.06706907,  0.05296063,  0.03885219,  0.02474375,  0.01063531, -0.00347313, -0.01758157, -0.03169001, -0.04579845, -0.05990689, -0.06567312, -0.06165523, -0.06104663, -0.06137889, -0.06171116, -0.06204342, -0.06237569, -0.06346561, -0.0653548 , -0.06724399, -0.06913318, -0.07108022, -0.07316592, -0.07464424, -0.07560605, -0.07654593, -0.07755212, -0.07846128, -0.07925202, -0.07996993, -0.08063572, -0.08124678, -0.08186066, -0.08246311, -0.08304926, -0.08358724, -0.08406164, -0.08456048, -0.08516272};
float SS_servo4[] = {-7.37609319e-02, -7.34669875e-02, -7.29457855e-02, -7.23848343e-02, -7.18199646e-02, -7.13441691e-02, -7.09639925e-02, -7.05823458e-02, -7.00052594e-02, -6.93714835e-02, -6.87819515e-02, -6.82870448e-02, -6.78840877e-02, -6.76717804e-02, -6.73541620e-02, -6.69162039e-02, -6.59759530e-02, -6.51957102e-02, -6.44332016e-02, -6.41939082e-02, -6.40993892e-02, -6.33956385e-02, -6.25018996e-02, -6.07533215e-02, -5.83054548e-02, -5.51781148e-02, -5.19925795e-02, -4.95203258e-02, -4.77856965e-02, -4.60510671e-02, -4.43164378e-02, -4.25818085e-02, -4.08471792e-02, -3.91125499e-02, -3.73779205e-02, -3.56723571e-02, -3.39733744e-02, -3.22743917e-02, -3.05754090e-02, -2.88764263e-02, -2.91543487e-02, -3.52975009e-02, -4.14406532e-02, -4.04405923e-02, -3.72151434e-02, -3.39896945e-02, -3.07642455e-02, -2.75387966e-02, -2.43133477e-02, -2.10878988e-02, -1.78624499e-02, -1.93760633e-02, -2.14381762e-02, -2.35002891e-02, -2.55624020e-02, -2.76245149e-02, -3.08056337e-02, -3.85980073e-02, -4.63903808e-02, -5.41827544e-02, -6.19751279e-02, -6.10506557e-02, -5.75099130e-02, -5.39691702e-02, -5.04284274e-02, -4.68876847e-02, -4.33469419e-02, -3.98061992e-02, -3.62654564e-02, -3.27247136e-02, -2.91839709e-02, -2.56432281e-02, -2.21024854e-02, -1.85617426e-02, -1.50209999e-02, -1.02635437e-02, -5.17161856e-03, -7.96934230e-05,  5.01223171e-03,  1.01041568e-02,  1.51960820e-02,  2.02880071e-02,  2.53799322e-02,  3.04718574e-02,  3.55637825e-02,  3.77157155e-02,  3.81564030e-02,  1.51576159e-02, -1.05663482e-02, -3.62903123e-02, -6.20142764e-02, -6.88609448e-02, -6.51378865e-02, -6.14148282e-02, -5.76917699e-02, -5.39687115e-02, -5.02456532e-02, -4.65225949e-02, -4.27995366e-02, -3.90764782e-02, -3.53534199e-02, -3.16303616e-02, -2.79073033e-02, -2.41842449e-02, -2.18981221e-02, -2.53273046e-02, -2.87564871e-02, -3.21856696e-02, -3.56148521e-02, -3.90440346e-02, -4.24732171e-02, -4.59023996e-02, -4.93315821e-02, -5.27607646e-02, -6.48313586e-02, -8.70370171e-02, -1.00185974e-01, -1.10835543e-01, -1.21485113e-01, -1.32134682e-01, -1.42784251e-01, -1.45595885e-01, -1.40139030e-01, -1.34682175e-01, -1.29225320e-01, -1.19306249e-01, -1.07767122e-01, -9.82931675e-02, -9.14708171e-02, -8.56283127e-02, -8.08986003e-02, -7.81219646e-02, -7.67969188e-02, -7.65684939e-02, -7.72798680e-02, -7.85617214e-02, -7.91437276e-02, -7.87940276e-02, -7.76225389e-02, -7.59995524e-02, -7.48392164e-02, -7.42822190e-02, -7.40006689e-02};     
float SS_servo5[] = { 0.02612034,  0.02610358,  0.02590865,  0.02563142,  0.02536528,  0.0252381 ,  0.02525606,  0.02533546,  0.0250563 ,  0.02475117,  0.02449538,  0.02436018,  0.02433378,  0.02461355,  0.02503772,  0.02494243,  0.02421814,  0.02396813,  0.0237549 ,  0.02462665,  0.02579478,  0.02573643,  0.02529439,  0.0229779 ,  0.01912804,  0.01582297,  0.01256456,  0.01034378,  0.00919604,  0.00804829,  0.00690054,  0.0057528 ,  0.00460505,  0.0034573 ,  0.00230956, -0.00036617, -0.00338784, -0.00640952, -0.00943119, -0.01245286, -0.01124236,  0.00252447,  0.01629131,  0.01801444,  0.01598548,  0.01395652,  0.01192756,  0.0098986 ,  0.00786964,  0.00584068,  0.00381172,  0.01501998,  0.02776031,  0.04050065,  0.05324099,  0.06598133,  0.07922717,  0.09455616,  0.10988515,  0.12521413,  0.14054312,  0.12907359,  0.10956076,  0.09004794,  0.07053511,  0.05102228,  0.03150946,  0.01199663, -0.00751619, -0.02702902, -0.04654185, -0.06605467, -0.0855675 , -0.10508033, -0.12459315, -0.1376448 , -0.1489203 , -0.16019581, -0.17147131, -0.18274681, -0.19402231, -0.20529781, -0.21657332, -0.22784882, -0.23912432, -0.23470842, -0.21875625, -0.16822307, -0.11382674, -0.05943041, -0.00503408,  0.0133249 ,  0.01150592,  0.00968695,  0.00786798,  0.00604901,  0.00423004,  0.00241107,  0.0005921 , -0.00122687, -0.00304585, -0.00486482, -0.00668379, -0.00850276, -0.00777943,  0.00305571,  0.01389085,  0.02472599,  0.03556114,  0.04639628,  0.05723142,  0.06806656,  0.0789017 ,  0.08973684,  0.11986358,  0.17261644,  0.19637003,  0.21212065,  0.22787128,  0.24362191,  0.25937254,  0.25341174,  0.22454687,  0.195682  ,  0.16681713,  0.12624983,  0.0850342 ,  0.05612908,  0.04287225,  0.0333062 ,  0.02566033,  0.0217023 ,  0.02051299,  0.02140645,  0.02408204,  0.0278158 ,  0.03005828,  0.03045267,  0.02921644,  0.0270694 ,  0.02575835,  0.02559589,  0.02594273};
float SS_servo6[] = {-7.01379140e-02, -6.97925455e-02, -6.93563511e-02, -6.89399395e-02, -6.84690041e-02, -6.80251100e-02, -6.76367727e-02, -6.72227982e-02, -6.66255183e-02, -6.59800995e-02, -6.54058294e-02, -6.49628180e-02, -6.46762035e-02, -6.45799994e-02, -6.43508211e-02, -6.40113704e-02, -6.34604417e-02, -6.26666507e-02, -6.18582294e-02, -6.06181650e-02, -5.92731682e-02, -5.82639602e-02, -5.73656193e-02, -5.68481689e-02, -5.66423004e-02, -5.56643363e-02, -5.46202439e-02, -5.12505348e-02, -4.54758409e-02, -3.97011471e-02, -3.39264533e-02, -2.81517594e-02, -2.23770656e-02, -1.66023718e-02, -1.08276779e-02, -5.34466089e-03,  7.23183749e-05,  5.48929764e-03,  1.09062769e-02,  1.63232562e-02,  2.12338216e-02,  2.46419204e-02,  2.80500192e-02,  3.10112986e-02,  3.38333764e-02,  3.66554542e-02,  3.94775320e-02,  4.22996097e-02,  4.51216875e-02,  4.79437653e-02,  5.07658431e-02,  5.18388304e-02,  5.27093778e-02,  5.35799252e-02,  5.44504726e-02,  5.53210200e-02,  5.55223033e-02,  5.29656500e-02,  5.04089967e-02,  4.78523434e-02,  4.52956901e-02,  4.75225774e-02,  5.11851946e-02,  5.48478118e-02,  5.85104291e-02,  6.21730463e-02,  6.58356635e-02,  6.94982808e-02,  7.31608980e-02,  7.68235152e-02,  8.04861325e-02,  8.41487497e-02,  8.78113669e-02,  9.14739842e-02,  9.51366014e-02,  9.89662615e-02,  1.02841841e-01,  1.06717420e-01,  1.10593000e-01,  1.14468579e-01,  1.18344159e-01,  1.22219738e-01,  1.26095318e-01,  1.29970897e-01,  1.33846477e-01,  1.35861514e-01,  1.37034650e-01,  1.28308551e-01,  1.18433991e-01,  1.08559431e-01,  9.86848705e-02,  8.91594282e-02,  7.98294632e-02,  7.04994981e-02,  6.11695331e-02,  5.18395680e-02,  4.25096030e-02,  3.31796379e-02,  2.38496729e-02,  1.45197079e-02,  5.18974281e-03, -4.14022224e-03, -1.34701873e-02, -2.28001523e-02, -3.12356178e-02, -3.61132770e-02, -4.09909362e-02, -4.58685953e-02, -5.07462545e-02, -5.56239137e-02, -6.05015729e-02, -6.53792321e-02, -7.02568913e-02, -7.51345504e-02, -7.91365654e-02, -8.21115827e-02, -8.32328068e-02, -8.38424377e-02, -8.44520686e-02, -8.50616995e-02, -8.56713304e-02, -8.53690801e-02, -8.41048575e-02, -8.28406348e-02, -8.15764122e-02, -8.05145660e-02, -7.97706079e-02, -7.94050226e-02, -7.95352957e-02, -8.02166113e-02, -8.12284150e-02, -8.14862056e-02, -8.08798288e-02, -7.94835367e-02, -7.74218591e-02, -7.51116041e-02, -7.35298999e-02, -7.26174754e-02, -7.22301989e-02, -7.21681496e-02, -7.19138491e-02, -7.13282279e-02, -7.06140179e-02};     
float SS_servo7[] = { 0.01764572,  0.01752831,  0.01749973,  0.01750537,  0.01742304,  0.01735828,  0.01736028,  0.01737642,  0.01705769,  0.01672972,  0.01650376,  0.01647013,  0.01667146,  0.01717856,  0.01777591,  0.01787344,  0.0179111 ,  0.01763454,  0.01733142,  0.01624436,  0.01496499,  0.01430869,  0.01385752,  0.01395077,  0.01448939,  0.01540961,  0.01636251,  0.01239422,  0.00333679, -0.00572065, -0.01477808, -0.02383551, -0.03289294, -0.04195038, -0.05100781, -0.06108365, -0.07139007, -0.08169649, -0.09200291, -0.10230933, -0.11114993, -0.11564165, -0.12013336, -0.12233184, -0.12381588, -0.12529993, -0.12678397, -0.12826802, -0.12975207, -0.13123611, -0.13272016, -0.12573515, -0.11776994, -0.10980473, -0.10183952, -0.0938743 , -0.08459881, -0.06992386, -0.05524891, -0.04057396, -0.02589901, -0.02193156, -0.02117784, -0.02042412, -0.01967041, -0.01891669, -0.01816297, -0.01740926, -0.01665554, -0.01590182, -0.01514811, -0.01439439, -0.01364067, -0.01288696, -0.01213324, -0.01088165, -0.00949319, -0.00810473, -0.00671627, -0.00532781, -0.00393934, -0.00255088, -0.00116242,  0.00022604,  0.0016145 ,  0.007733  ,  0.01749175,  0.03772645,  0.05912376,  0.08052108,  0.10191839,  0.11085303,  0.1128096 ,  0.11476616,  0.11672273,  0.1186793 ,  0.12063587,  0.12259243,  0.124549  ,  0.12650557,  0.12846214,  0.1304187 ,  0.13237527,  0.13433184,  0.13249042,  0.11554281,  0.09859519,  0.08164757,  0.06469995,  0.04775233,  0.03080472,  0.0138571 , -0.00309052, -0.02003814, -0.02336695, -0.01072298, -0.00495981, -0.00109554,  0.00276873,  0.006633  ,  0.01049726,  0.012538  ,  0.01265502,  0.01277204,  0.01288907,  0.01338675,  0.0143574 ,  0.0158675 ,  0.01813764,  0.02133343,  0.024921  ,  0.02690055,  0.02711765,  0.02572589,  0.02297503,  0.0196796 ,  0.01768813,  0.01698139,  0.01727968,  0.01818715,  0.0186491 ,  0.01843058,  0.01793068};

int node=0;
int first=0;
int input=0;
int end_time=0;
int time_step=100000;
int steps = sizeof(SS_servo0)/sizeof(SS_servo0[0]);
int one_print = 0;

// -------------------Joint configurations-------------------
int servo0=0;
int servo0_deg=0;
int servo1=0;
int servo1_deg=0;
int servo2=0;
int servo2_deg=0;
int servo3=0;
int servo3_deg=0;
int servo4=0;
int servo4_deg=0;
int servo5=0;
int servo5_deg=0;
int servo6=0;
int servo6_deg=0;
int servo7=0;
int servo7_deg=0;

void setup() {
  Serial.begin(115200);
  pca9685.begin();

  pca9685.setOscillatorFrequency(27000000); //Value between 24MHz and 27MHz, tuned for this setup
  pca9685.setPWMFreq(SERVO_FREQ);
  delay (1000);

  servo0_deg=SS_servo0[0]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[0]/3.14159265*180-servo0_deg;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[0]/3.14159265*180;
        servo2=map(servo2_deg,-37,90,1500,2670);
        servo3_deg=SS_servo3[0]/3.14159265*180-servo2_deg;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[0]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[0]/3.14159265*180-servo4_deg;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[0]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[0]/3.14159265*180-servo6_deg;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        Serial.print("Node:");
        Serial.println(node);
        Serial.print("servo0 -> rads:");
        Serial.print(SS_servo0[node]);
        Serial.print("        deg:");
        Serial.print(servo0_deg);
        Serial.print("        us:");
        Serial.println(servo0);
        Serial.print("servo1 -> rads:");
        Serial.print(SS_servo1[node]);
        Serial.print("        deg:");
        Serial.print(servo1_deg);
        Serial.print("        us:");
        Serial.println(servo1);
        Serial.print("servo2 -> rads:");
        Serial.print(SS_servo2[node]);
        Serial.print("        deg:");
        Serial.print(servo2_deg);
        Serial.print("        us:");
        Serial.println(servo2);
        Serial.print("servo3 -> rads:");
        Serial.print(SS_servo3[node]);
        Serial.print("        deg:");
        Serial.print(servo3_deg);
        Serial.print("        us:");
        Serial.println(servo3);
        Serial.print("servo4 -> rads:");
        Serial.print(SS_servo4[node]);
        Serial.print("        deg:");
        Serial.print(servo4_deg);
        Serial.print("        us:");
        Serial.println(servo4);
        Serial.print("servo5 -> rads:");
        Serial.print(SS_servo5[node]);
        Serial.print("        deg:");
        Serial.print(servo5_deg);
        Serial.print("        us:");
        Serial.println(servo5);
        Serial.print("servo6 -> rads:");
        Serial.print(SS_servo6[node]);
        Serial.print("        deg:");
        Serial.print(servo6_deg);
        Serial.print("        us:");
        Serial.println(servo6);
        Serial.print("servo7 -> rads:");
        Serial.print(SS_servo7[node]);
        Serial.print("        deg:");
        Serial.print(servo7_deg);
        Serial.print("        us:");
        Serial.println(servo7);

        Serial.println("10");
        delay(1000);
        Serial.println("9");
        delay(1000);
        Serial.println("8");
        delay(1000);
        Serial.println("7");
        delay(1000);
        Serial.println("6");
        delay(1000);
        Serial.println("5");
        delay(1000);
        Serial.println("4");
        delay(1000);
        Serial.println("3");
        delay(1000);
        Serial.println("2");
        delay(1000);
        Serial.println("1");
        delay(1000);

}

void loop() 
{
  if(Serial.available()>0)
  {
    first=Serial.read();
    if(first=='2')
    {
      input=2;
      node=0;
      one_print=1;
    }
    if(first=='1')
    {
      input=1;
      node=0;
      one_print=1;
    }
    if(first=='0')
    {
      input=0;
    }
  }
  if(input==1 or input==2)
  {
      if(esp_timer_get_time()>=end_time)
      {
        servo0_deg=SS_servo0[node]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[node]/3.14159265*180-servo0_deg;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[node]/3.14159265*180;
        servo2=map(servo2_deg,-37,90,1500,2670);
        servo3_deg=SS_servo3[node]/3.14159265*180-servo2_deg;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[node]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[node]/3.14159265*180-servo4_deg;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[node]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[node]/3.14159265*180-servo6_deg;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);
        
        node+=1;
        if(node>=steps and input==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          node=0;
        }
        if(node>=steps and input==2)
        {
          Serial.print("Input:");
          Serial.println(input);
          input=0;
        }
         end_time=esp_timer_get_time()+time_step;
      }
   }

  if(input == 0)
  {        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        if(one_print==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          Serial.print("Node:");
          Serial.println(node);
          Serial.print("servo0 -> rads:");
          Serial.print(SS_servo0[node]);
          Serial.print("        deg:");
          Serial.print(servo0_deg);
          Serial.print("        us:");
          Serial.println(servo0);
          Serial.print("servo1 -> rads:");
          Serial.print(SS_servo1[node]);
          Serial.print("        deg:");
          Serial.print(servo1_deg);
          Serial.print("        us:");
          Serial.println(servo1);
          Serial.print("servo2 -> rads:");
          Serial.print(SS_servo2[node]);
          Serial.print("        deg:");
          Serial.print(servo2_deg);
          Serial.print("        us:");
          Serial.println(servo2);
          Serial.print("servo3 -> rads:");
          Serial.print(SS_servo3[node]);
          Serial.print("        deg:");
          Serial.print(servo3_deg);
          Serial.print("        us:");
          Serial.println(servo3);
          Serial.print("servo4 -> rads:");
          Serial.print(SS_servo4[node]);
          Serial.print("        deg:");
          Serial.print(servo4_deg);
          Serial.print("        us:");
          Serial.println(servo4);
          Serial.print("servo5 -> rads:");
          Serial.print(SS_servo5[node]);
          Serial.print("        deg:");
          Serial.print(servo5_deg);
          Serial.print("        us:");
          Serial.println(servo5);
          Serial.print("servo6 -> rads:");
          Serial.print(SS_servo6[node]);
          Serial.print("        deg:");
          Serial.print(servo6_deg);
          Serial.print("        us:");
          Serial.println(servo6);
          Serial.print("servo7 -> rads:");
          Serial.print(SS_servo7[node]);
          Serial.print("        deg:");
          Serial.print(servo7_deg);
          Serial.print("        us:");
          Serial.println(servo7);
          one_print=0;
        }
  
  }
}
