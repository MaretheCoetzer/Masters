// HOW TO:
// ------------------------------
// Serial input = 2 -> Steps through gait sequence once and stops at the end.
// Serial input = 1 -> Steps through gait sequence in a loop.
// Serial input = 0 -> Stops infinite loop at the node where it is at that moment

//Gait template
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pca9685 = Adafruit_PWMServoDriver();

#define SERVO_FREQ 300
#define SER0 0 //Hip 1
#define SER1 1 //Knee 1
#define SER2 2 //Hip 2
#define SER3 3 //Knee 2
#define SER4 4 //Hip 3
#define SER5 5 //Knee 3
#define SER6 6 //Hip 4
#define SER7 7 //Knee 4

// Insert servo angles here:
// For 3D gaits, these angles are obtained from linearisation.py
// For 2D gaits, these angles are obtained from 2D_trajectory_reader.py
float SS_servo0[] = {-2.69734169e-01, -2.62420931e-01, -2.49256289e-01, -2.35681169e-01, -2.24809164e-01, -2.13937158e-01, -2.03065153e-01, -1.92193148e-01, -1.81321142e-01, -1.74827207e-01, -1.71979845e-01, -1.69132482e-01, -1.66285120e-01, -1.66622982e-01, -1.85337380e-01, -2.08551929e-01, -2.31766478e-01, -2.48175275e-01, -2.64284705e-01, -2.80394134e-01, -2.96503564e-01, -3.12612993e-01, -3.28722422e-01, -3.44831852e-01, -3.60941281e-01, -3.62493050e-01, -3.61170592e-01, -3.59848134e-01, -3.58525676e-01, -3.57203218e-01, -3.55880760e-01, -3.39428049e-01, -3.08505752e-01, -2.73269576e-01, -2.37271840e-01, -1.98229861e-01, -1.74816857e-01, -1.69382394e-01, -1.68726105e-01, -1.85699616e-01, -2.03861420e-01, -2.22023224e-01, -2.27283253e-01, -2.11820526e-01, -1.96357798e-01, -1.80895070e-01, -1.65432342e-01, -1.49969615e-01, -1.34506887e-01, -1.19044159e-01, -1.03581431e-01, -8.81187035e-02, -6.52618285e-02, -2.41828934e-02,  1.68960416e-02,  5.79749767e-02,  9.90539118e-02,  1.40132847e-01,  1.81211782e-01,  2.22290717e-01,  2.51745485e-01,  2.45882315e-01,  2.40817203e-01,  2.33523568e-01,  2.25805236e-01,  2.15666076e-01,  2.04050038e-01,  1.93688596e-01,  1.95672079e-01,  1.95217726e-01,  1.94540726e-01,  1.91369571e-01,  1.88071482e-01,  1.84773392e-01,  1.81475303e-01, 1.78177213e-01,  1.74879124e-01,  1.67558244e-01,  1.57172866e-01,  1.46787488e-01,  1.36402110e-01,  1.26016731e-01,  1.14945014e-01,  1.06442798e-01,  1.01978713e-01,  1.02016881e-01,  1.04116836e-01,  1.04305130e-01,  1.03052578e-01,  1.00567026e-01,  9.80814744e-02,  9.55959227e-02,  9.31103710e-02,  9.06248192e-02,  8.12726225e-02,  7.07175919e-02,  6.01625614e-02,  4.96075308e-02,  3.94651154e-02,  3.78588802e-02,  3.63059079e-02,  3.12153264e-02,  2.66420248e-02,  1.28676758e-02,  2.07186551e-03, -3.96518815e-03, -4.15472106e-03, -2.31783079e-03,  1.01416620e-03,  1.59572718e-04, -4.14876308e-03, -8.45709887e-03, -1.07363562e-02, -1.13445282e-02, -1.19527002e-02, -1.25608721e-02, -1.31690441e-02, -1.37772161e-02, -1.43853880e-02, -1.49935600e-02, -1.56017320e-02, -1.64713046e-02, -2.19186212e-02, -2.73659378e-02, -3.28132545e-02, -3.82605711e-02, -4.37078877e-02, -4.91552043e-02, -5.52134032e-02, -6.41911960e-02, -7.31689887e-02, -7.98885181e-02, -8.51705324e-02, -9.04525468e-02, -9.57345611e-02, -1.01016575e-01, -1.06298590e-01, -1.11580604e-01, -1.16862618e-01, -1.23699488e-01, -1.31993689e-01, -1.40287891e-01, -1.48582092e-01, -1.56876293e-01, -1.65170495e-01, -1.78046855e-01, -1.94948203e-01, -2.13661151e-01, -2.31972781e-01, -2.48595815e-01, -2.63604619e-01, -2.72457760e-01};
float SS_servo1[] = {0.09303934, 0.0954923 , 0.0944024 , 0.09228801, 0.08817933, 0.08407065, 0.07996197, 0.07585329, 0.07174461, 0.07347445, 0.0800673 , 0.08666015, 0.093253  , 0.10714852, 0.15839131, 0.22483069, 0.29127008, 0.3397638 , 0.38746813, 0.43517247, 0.4828768 , 0.53058114, 0.57828547, 0.62598981, 0.67369414, 0.68079208, 0.67987279, 0.6789535 , 0.67803421, 0.67711492, 0.67619564, 0.6275908 , 0.52578579, 0.4218452 , 0.32067671, 0.23058936, 0.17547113, 0.15751118, 0.14841919, 0.18333337, 0.22686204, 0.27039071, 0.29725602, 0.29735676, 0.29745749, 0.29755823, 0.29765896, 0.29775969, 0.29786043, 0.29796116, 0.2980619 , 0.29816263, 0.29142778, 0.26784738, 0.24426698, 0.22068658, 0.19710618, 0.17352578, 0.14994538, 0.12636498, 0.12632367, 0.12584542, 0.12384954, 0.12701841, 0.13192127, 0.1392174 , 0.15071074, 0.15830871, 0.14088787, 0.12416313, 0.10777137, 0.10014865, 0.09297222, 0.08579579, 0.07861936, 0.07144293, 0.0642665 , 0.06657114, 0.0760983 , 0.08562546, 0.09515262, 0.10467978, 0.11679332, 0.12396489, 0.12300717, 0.11368961, 0.09816706, 0.08488874, 0.07561275, 0.06976175, 0.06391075, 0.05805975, 0.05220875, 0.04635775, 0.05544305, 0.06714476, 0.07884646, 0.09054816, 0.10142097, 0.09556858, 0.08959625, 0.08969312, 0.09122922, 0.10747373, 0.12165627, 0.12307154, 0.11809393, 0.11175629, 0.1018675 , 0.09757396, 0.10023828, 0.10290261, 0.10166516, 0.09721433, 0.09276351, 0.08831268, 0.08386185, 0.07941103, 0.0749602 , 0.07050938, 0.06605855, 0.06214214, 0.06758473, 0.07302732, 0.07846991, 0.0839125 , 0.08935509, 0.09479768, 0.10097269, 0.11064818, 0.12032367, 0.12341035, 0.12230288, 0.12119541, 0.12008793, 0.11898046, 0.11787299, 0.11676551, 0.11565804, 0.11350811, 0.11038111, 0.10725411, 0.10412711, 0.10100011, 0.09787311, 0.09922386, 0.10697023, 0.11598999, 0.12263066, 0.12197661, 0.11431404, 0.0938394 };
float SS_servo2[] = {-2.69878559e-01, -2.62542201e-01, -2.52089818e-01, -2.41867896e-01, -2.34768763e-01, -2.27669629e-01, -2.20570496e-01, -2.13471362e-01, -2.06372229e-01, -1.99158096e-01, -1.91848180e-01, -1.84538263e-01, -1.77228346e-01, -1.67097819e-01, -1.56253570e-01, -1.49553247e-01, -1.42852924e-01, -1.39007487e-01, -1.35287629e-01, -1.31567772e-01, -1.27847915e-01, -1.24128057e-01, -1.20408200e-01, -1.16688343e-01, -1.12968485e-01, -1.16170425e-01, -1.20738986e-01, -1.25307547e-01, -1.29876108e-01, -1.34444669e-01, -1.39013230e-01, -1.43234688e-01, -1.45685573e-01, -1.53209557e-01, -1.61316576e-01, -1.71754202e-01, -1.79851529e-01, -1.79405304e-01, -1.66381872e-01, -1.65380455e-01, -1.83230951e-01, -2.01081447e-01, -2.11378759e-01, -2.09544190e-01, -2.07709621e-01, -2.05875052e-01, -2.04040483e-01, -2.02205914e-01, -2.00371344e-01, -1.98536775e-01, -1.96702206e-01, -1.94867637e-01, -1.99192905e-01, -2.18698410e-01, -2.38203915e-01, -2.57709420e-01, -2.77214925e-01, -2.96720430e-01, -3.16225935e-01, -3.35731440e-01, -3.65958407e-01, -3.67890875e-01, -3.57615747e-01, -3.44338250e-01, -3.33234459e-01, -3.22287785e-01, -3.09760120e-01, -2.92735775e-01, -2.73360791e-01, -2.63850352e-01, -2.54470330e-01, -2.51085092e-01, -2.48004946e-01, -2.44924801e-01, -2.41844656e-01, -2.38764510e-01, -2.35684365e-01, -2.34133287e-01, -2.33747030e-01, -2.33360772e-01, -2.32974514e-01, -2.32588257e-01, -2.28748647e-01, -2.23776913e-01, -2.17076477e-01, -2.06375431e-01, -2.01136062e-01, -2.03573241e-01, -2.05438790e-01, -2.06815170e-01, -2.08191550e-01, -2.09567930e-01, -2.10944310e-01, -2.12320690e-01, -2.13897026e-01, -2.15508389e-01, -2.17119752e-01, -2.18731115e-01, -2.15827533e-01, -1.95265587e-01, -1.62969105e-01, -1.26543723e-01, -8.99342038e-02, -5.46087976e-02, -1.81765428e-02,  2.84780785e-03,  7.49948320e-03,  7.25673804e-03,  4.40920020e-03, -2.97826177e-05, -4.38959439e-03, -8.74940616e-03, -1.28800699e-02, -1.68220146e-02, -2.07639593e-02, -2.47059039e-02, -2.86478486e-02, -3.25897933e-02, -3.65317379e-02, -4.04736826e-02, -4.44156273e-02, -4.81872922e-02, -4.89769556e-02, -4.97666189e-02, -5.05562823e-02, -5.13459457e-02, -5.21356090e-02, -5.29252724e-02, -5.33750612e-02, -5.22004851e-02, -5.10259090e-02, -5.46787526e-02, -6.14045276e-02, -6.81303026e-02, -7.48560775e-02, -8.15818525e-02, -8.83076275e-02, -9.50334024e-02, -1.01759177e-01, -1.10604327e-01, -1.21435921e-01, -1.32267515e-01, -1.43099108e-01, -1.53930702e-01, -1.64762296e-01, -1.76090762e-01, -1.88683961e-01, -2.05414952e-01, -2.24670349e-01, -2.45355238e-01, -2.63878841e-01, -2.72418221e-01};
float SS_servo3[] = {0.09342018, 0.09582798, 0.10016436, 0.10476386, 0.10827908, 0.1117943 , 0.11530951, 0.11882473, 0.12233995, 0.12264587, 0.12027871, 0.11791155, 0.11554438, 0.10838273, 0.09373041, 0.08785666, 0.08198291, 0.07744887, 0.07297376, 0.06849865, 0.06402354, 0.05954843, 0.05507332, 0.05059821, 0.0461231 , 0.05277288, 0.06161913, 0.07046538, 0.07931164, 0.08815789, 0.09700414, 0.10430952, 0.10755471, 0.12027324, 0.1343413 , 0.15380394, 0.16520492, 0.15731284, 0.12336257, 0.11592814, 0.14821247, 0.18049679, 0.19650067, 0.18635499, 0.17620931, 0.16606362, 0.15591794, 0.14577226, 0.13562657, 0.12548089, 0.1153352 , 0.10518952, 0.1076242 , 0.14106181, 0.17449941, 0.20793702, 0.24137462, 0.27481223, 0.30824983, 0.34168744, 0.40143715, 0.39195655, 0.36005567, 0.32276449, 0.29044508, 0.25580547, 0.21905381, 0.17194708, 0.12034122, 0.07163429, 0.02270701, 0.0371894 , 0.0548989 , 0.07260841, 0.09031791, 0.10802742, 0.12573692, 0.14312862, 0.16027821, 0.17742781, 0.1945774 , 0.211727  , 0.19551211, 0.17554604, 0.15220469, 0.12161267, 0.10024438, 0.09310777, 0.11212377, 0.15351975, 0.19491573, 0.23631171, 0.27770769, 0.31910367, 0.38031359, 0.44499432, 0.50967505, 0.57435579, 0.61572299, 0.58603269, 0.50878096, 0.41521815, 0.32971996, 0.24521362, 0.16264472, 0.10890045, 0.09410311, 0.09199092, 0.09464793, 0.09762862, 0.10039123, 0.10315383, 0.10568463, 0.10802454, 0.11036446, 0.11270437, 0.11504428, 0.11738419, 0.1197241 , 0.12206401, 0.12440392, 0.12640298, 0.12243284, 0.11846271, 0.11449258, 0.11052244, 0.10655231, 0.10258217, 0.09741925, 0.08655561, 0.07569197, 0.07257015, 0.07437643, 0.07618271, 0.077989  , 0.07979528, 0.08160156, 0.08340784, 0.08521413, 0.08712578, 0.08913618, 0.09114658, 0.09315698, 0.09516739, 0.09717779, 0.09541884, 0.09448483, 0.09952426, 0.10806867, 0.11555131, 0.11495235, 0.09385167};
float SS_servo4[] = { 0.24352191,  0.23565958,  0.23224374,  0.23045108,  0.23019429,  0.2299375 ,  0.22968071,  0.22942392,  0.22916713,  0.22719985,  0.22380787,  0.2204159 ,  0.21702393,  0.21145655,  0.20727249,  0.20910373,  0.21093496,  0.20653622,  0.20186344,  0.19719066,  0.19251788,  0.1878451 ,  0.18317232,  0.17849953,  0.17382675,  0.17295218,  0.17282752,  0.17270286,  0.1725782 ,  0.17245353,  0.17232887,  0.1793013 ,  0.18631094,  0.19190676,  0.1977435 ,  0.2045433 ,  0.20983741,  0.2123805 ,  0.20847038,  0.19097914,  0.1750271 ,  0.15907506,  0.14707563,  0.14142486,  0.1357741 ,  0.13012333,  0.12447256,  0.11882179,  0.11317102,  0.10752025,  0.10186948,  0.09621871,  0.09154337,  0.08927187,  0.08700037,  0.08472887,  0.08245737,  0.08018587,  0.07791437,  0.07564287,  0.07359304,  0.06901205,  0.06212139,  0.05682404,  0.05249697,  0.04604534,  0.04263807,  0.03785762,  0.02837631,  0.01773883,  0.00704722, -0.00086851, -0.00864296, -0.01641742, -0.02419187, -0.03196632, -0.03974077, -0.04405408, -0.04573074, -0.0474074 , -0.04908406, -0.05076072, -0.05090101, -0.0525208 , -0.05701901, -0.0666781 , -0.07541102, -0.08527242, -0.09327825, -0.09969618, -0.10611411, -0.11253204, -0.11894996, -0.12536789, -0.12697011, -0.12772877, -0.12848742, -0.12924607, -0.13056957, -0.13557737, -0.13927753, -0.1425698 , -0.14521063, -0.14927173, -0.15502991, -0.16438748, -0.15707384, -0.13925245, -0.13091509, -0.13090861, -0.12948505, -0.12806149, -0.10544705, -0.06538046, -0.02531388,  0.01475271,  0.0548193 ,  0.09488589,  0.13495247,  0.17501906,  0.21508565,  0.25579182,  0.30769871, 0.35960561,  0.4115125 ,  0.46341939,  0.51532628,  0.56723317,  0.61702553,  0.65671191,  0.69639828,  0.71718474,  0.7259403 ,  0.73469586,  0.74345141,  0.75220697,  0.76096253,  0.76971809,  0.77847365,  0.7673041 ,  0.73745917,  0.70761425,  0.67776932,  0.6479244 ,  0.61807947,  0.57865746,  0.5342936 ,  0.48983064,  0.44110865,  0.38558885,  0.32019377,  0.2457888 };
float SS_servo5[] = {-0.54188994, -0.50835917, -0.47576248, -0.44668607, -0.42822833, -0.40977059, -0.39131285, -0.37285511, -0.35439737, -0.33555922, -0.31640422, -0.29724922, -0.27809422, -0.25369206, -0.23812057, -0.23419459, -0.23026861, -0.21816478, -0.20570122, -0.19323765, -0.18077409, -0.16831053, -0.15584697, -0.14338341, -0.13091985, -0.12894166, -0.12903369, -0.12912571, -0.12921773, -0.12930975, -0.12940178, -0.14460991, -0.16038966, -0.1740222 , -0.18795781, -0.20310494, -0.21859195, -0.23067578, -0.23055476, -0.20046848, -0.17144421, -0.14241994, -0.12273962, -0.11806752, -0.11339541, -0.10872331, -0.1040512 , -0.0993791 , -0.09470699, -0.09003489, -0.08536279, -0.08069068, -0.07744189, -0.07770069, -0.07795949, -0.07821829, -0.0784771 , -0.0787359 , -0.0789947 , -0.0792535 , -0.07452108, -0.07853355, -0.07647092, -0.07706319, -0.07880786, -0.07879154, -0.08384526, -0.08738957, -0.08094725, -0.07643714, -0.07194112, -0.06956699, -0.06730085, -0.06503471, -0.06276857, -0.06050243, -0.05823628, -0.06185756, -0.06996377, -0.07806999, -0.08617621, -0.09428242, -0.10436949, -0.11118598, -0.11203453, -0.10151563, -0.09489098, -0.08765217, -0.08313996, -0.08096102, -0.07878209, -0.07660315, -0.07442421, -0.07224527, -0.07901301, -0.08734794, -0.09568287, -0.1040178 , -0.11117609, -0.11016161, -0.11186407, -0.1155514 , -0.1180624 , -0.12176419, -0.1179774 , -0.10991139, -0.13328174, -0.16201712, -0.1453792 , -0.08449341, -0.01866121,  0.04717098,  0.07511786,  0.07186357,  0.06860929,  0.06535501,  0.06210072,  0.05884644,  0.05559215,  0.05233787,  0.04908359,  0.04485331,  0.02353117, 0.00220903, -0.01911311, -0.04043525, -0.06175739, -0.08307953, -0.10198245, -0.10932315, -0.11666385, -0.11972469, -0.12006115, -0.12039761, -0.12073407, -0.12107054, -0.121407  , -0.12174346, -0.12207992, -0.12057263, -0.11733722, -0.11410182, -0.11086641, -0.10763101, -0.1043956 , -0.11378616, -0.14733953, -0.21132387, -0.29063041, -0.37689741, -0.46331031, -0.54875435};
float SS_servo6[] = {-0.21256922, -0.20318875, -0.19110388, -0.17958781, -0.1712242 , -0.16286059, -0.15449698, -0.14613337, -0.13776975, -0.13005735, -0.12288735, -0.11571735, -0.10854735, -0.10109512, -0.10172047, -0.10402273, -0.10632498, -0.1050902 , -0.10369984, -0.10230948, -0.10091911, -0.09952875, -0.09813838, -0.09674802, -0.09535765, -0.09294989, -0.09034125, -0.08773262, -0.08512398, -0.08251535, -0.07990671, -0.08025957, -0.08008462, -0.07846355, -0.0772621 , -0.07773797, -0.07852832, -0.08038141, -0.09157804, -0.09793736, -0.10188302, -0.10582868, -0.10592867, -0.09985178, -0.09377489, -0.087698  , -0.08162111, -0.07554422, -0.06946734, -0.06339045, -0.05731356, -0.05123667, -0.04237189, -0.02663666, -0.01090144,  0.00483379,  0.02056902,  0.03630424,  0.05203947,  0.06777469,  0.09272133,  0.1240133 ,  0.15899744,  0.1954381 ,  0.23101388,  0.26345188,  0.29069229,  0.31150021,  0.32291395,  0.3268137 ,  0.33068528,  0.32049901,  0.30959729,  0.29869557,  0.28779385,  0.27689213,  0.2659904 ,  0.25188945,  0.23535136,  0.21881328,  0.20227519,  0.18573711,  0.17637616,  0.17188769,  0.17506139,  0.18513745,  0.19366291,  0.20073652,  0.20469627,  0.20599134,  0.20728641,  0.20858148,  0.20987655,  0.21117161,  0.21259433,  0.21403941,  0.21548449,  0.21692956,  0.22046822,  0.22384603,  0.22514932,  0.22561234,  0.22722626,  0.22923494,  0.23209434,  0.22608683,  0.20635516,  0.18036117,  0.15613885,  0.12965783,  0.10822076,  0.08678369,  0.07375307,  0.06764572,  0.06153838,  0.05543103,  0.04932369,  0.04321635,  0.037109  ,  0.03100166,  0.02489432,  0.019017  ,  0.01716803, 0.01531906,  0.01347009,  0.01162111,  0.00977214,  0.00792317,  0.00559359,  0.00096705, -0.0036595 , -0.00933916, -0.01568919, -0.02203921, -0.02838924, -0.03473927, -0.04108929, -0.04743932, -0.05378935, -0.06141171, -0.0702266 , -0.0790415 , -0.08785639, -0.09667129, -0.10548618, -0.11648717, -0.1272042 , -0.13868986, -0.14927247, -0.16335367, -0.18306255, -0.21345908};
float SS_servo7[] = {-0.10391386, -0.10548889, -0.10418622, -0.10193078, -0.10084788, -0.09976497, -0.09868207, -0.09759916, -0.09651626, -0.09716184, -0.09924711, -0.10133238, -0.10341765, -0.1051811 , -0.09659981, -0.08416896, -0.07173812, -0.07096569, -0.07070608, -0.07044648, -0.07018687, -0.06992727, -0.06966766, -0.06940806, -0.06914845, -0.07384991, -0.07953087, -0.08521182, -0.09089278, -0.09657374, -0.1022547 , -0.10273724, -0.10481188, -0.11060298, -0.11535826, -0.11597298, -0.11936149, -0.12272127, -0.10773747, -0.10730483, -0.11515952, -0.12301421, -0.12624488, -0.12204845, -0.11785203, -0.1136556 , -0.10945918, -0.10526275, -0.10106633, -0.0968699 , -0.09267348, -0.08847705, -0.09073571, -0.1089022 , -0.12706869, -0.14523518, -0.16340168, -0.18156817, -0.19973466, -0.21790115, -0.27305083, -0.3558964 , -0.44144475, -0.52890559, -0.61017779, -0.68253323, -0.73428247, -0.76456711, -0.7612346 , -0.74969794, -0.73853872, -0.67710976, -0.61312241, -0.54913507, -0.48514773, -0.42116038, -0.35717304, -0.30071064, -0.24998063, -0.19925062, -0.14852061, -0.09779059, -0.08749479, -0.08843433, -0.10471834, -0.13408176, -0.1622108 , -0.18909916, -0.20866529, -0.22196545, -0.23526561, -0.24856577, -0.26186593, -0.27516609, -0.28784659, -0.30041855, -0.3129905 , -0.32556246, -0.34233854, -0.3581623 , -0.36985702, -0.38099529, -0.39197977, -0.40778244, -0.42140683, -0.42026072, -0.38588881, -0.33606145, -0.29030861, -0.24272298, -0.20527971, -0.16783643, -0.14727507, -0.14061712, -0.13395917, -0.12730122, -0.12064328, -0.11398533, -0.10732738, -0.10066943, -0.09401148, -0.08781516, -0.089703  , -0.09159084, -0.09347868, -0.09536651, -0.09725435, -0.09914219, -0.10054121, -0.09960401, -0.09866681, -0.09769136, -0.09669156, -0.09569176, -0.09469197, -0.09369217, -0.09269237, -0.09169257, -0.09069277, -0.09135594, -0.09357777, -0.0957996 , -0.09802143, -0.10024326, -0.10246509, -0.10505598, -0.11000716, -0.11581746, -0.12512613, -0.13130371, -0.12982177, -0.10689821};

int node=0;
int first=0;
int input=0;
int end_time=0;
int time_step=120000;
int steps = sizeof(SS_servo0)/sizeof(SS_servo0[0]);
int one_print = 0;

// -------------------Joint configurations-------------------
int servo0=0;
int servo0_deg=0;
int servo1=0;
int servo1_deg=0;
int servo2=0;
int servo2_deg=0;
int servo3=0;
int servo3_deg=0;
int servo4=0;
int servo4_deg=0;
int servo5=0;
int servo5_deg=0;
int servo6=0;
int servo6_deg=0;
int servo7=0;
int servo7_deg=0;

void setup() {
  Serial.begin(115200);
  pca9685.begin();

  pca9685.setOscillatorFrequency(27000000); //Value between 24MHz and 27MHz, tuned for this setup
  pca9685.setPWMFreq(SERVO_FREQ);
  delay (1000);

  servo0_deg=SS_servo0[0]/3.14159265*180;
  servo0=map(servo0_deg,-38,90,2200,1030);
  servo1_deg=SS_servo1[0]/3.14159265*180;
  servo1=map(servo1_deg,-90,90,2600,950);
  servo2_deg=SS_servo2[0]/3.14159265*180;
  servo2=map(servo2_deg,-38,90,1510,2730);
  servo3_deg=SS_servo3[0]/3.14159265*180;
  servo3=map(servo3_deg,-90,90,1100,2700);
  servo4_deg=SS_servo4[0]/3.14159265*180;
  servo4=map(servo4_deg,-90,38,2700,1500);
  servo5_deg=SS_servo5[0]/3.14159265*180;
  servo5=map(servo5_deg,-90,90,2600,930);
  servo6_deg=SS_servo6[0]/3.14159265*180;
  servo6=map(servo6_deg,-90,38,850,2250);
  servo7_deg=SS_servo7[0]/3.14159265*180;
  servo7=map(servo7_deg,-90,90,920,2620);
        
  pca9685.setPWM(SER0,0,servo0);
  pca9685.setPWM(SER1,0,servo1);
  pca9685.setPWM(SER2,0,servo2);
  pca9685.setPWM(SER3,0,servo3);
  pca9685.setPWM(SER4,0,servo4);
  pca9685.setPWM(SER5,0,servo5);
  pca9685.setPWM(SER6,0,servo6);
  pca9685.setPWM(SER7,0,servo7);

  Serial.print("Node:");
  Serial.println(node);
  Serial.print("servo0 -> rads:");
  Serial.print(SS_servo0[node]);
  Serial.print("        deg:");
  Serial.print(servo0_deg);
  Serial.print("        us:");
  Serial.println(servo0);
  Serial.print("servo1 -> rads:");
  Serial.print(SS_servo1[node]);
  Serial.print("        deg:");
  Serial.print(servo1_deg);
  Serial.print("        us:");
  Serial.println(servo1);
  Serial.print("servo2 -> rads:");
  Serial.print(SS_servo2[node]);
  Serial.print("        deg:");
  Serial.print(servo2_deg);
  Serial.print("        us:");
  Serial.println(servo2);
  Serial.print("servo3 -> rads:");
  Serial.print(SS_servo3[node]);
  Serial.print("        deg:");
  Serial.print(servo3_deg);
  Serial.print("        us:");
  Serial.println(servo3);
  Serial.print("servo4 -> rads:");
  Serial.print(SS_servo4[node]);
  Serial.print("        deg:");
  Serial.print(servo4_deg);
  Serial.print("        us:");
  Serial.println(servo4);
  Serial.print("servo5 -> rads:");
  Serial.print(SS_servo5[node]);
  Serial.print("        deg:");
  Serial.print(servo5_deg);
  Serial.print("        us:");
  Serial.println(servo5);
  Serial.print("servo6 -> rads:");
  Serial.print(SS_servo6[node]);
  Serial.print("        deg:");
  Serial.print(servo6_deg);
  Serial.print("        us:");
  Serial.println(servo6);
  Serial.print("servo7 -> rads:");
  Serial.print(SS_servo7[node]);
  Serial.print("        deg:");
  Serial.print(servo7_deg);
  Serial.print("        us:");
  Serial.println(servo7);

  Serial.println("10");
  delay(1000);
  Serial.println("9");
  delay(1000);
  Serial.println("8");
  delay(1000);
  Serial.println("7");
  delay(1000);
  Serial.println("6");
  delay(1000);
  Serial.println("5");
  delay(1000);
  Serial.println("4");
  delay(1000);
  Serial.println("3");
  delay(1000);
  Serial.println("2");
  delay(1000);
  Serial.println("1");
  delay(1000);

}

void loop() 
{
  if(Serial.available()>0)
  {
    first=Serial.read();
    if(first=='2')
    {
      input=2;
      node=0;
      one_print=1;
    }
    if(first=='1')
    {
      input=1;
      node=0;
      one_print=1;
    }
    if(first=='0')
    {
      input=0;
    }
  }
  if(input==1 or input==2)
  {
      if(esp_timer_get_time()>=end_time)
      {
        servo0_deg=SS_servo0[node]/3.14159265*180;
        servo0=map(servo0_deg,-38,90,2200,1030);
        servo1_deg=SS_servo1[node]/3.14159265*180;
        servo1=map(servo1_deg,-90,90,2600,950);
        servo2_deg=SS_servo2[node]/3.14159265*180;
        servo2=map(servo2_deg,-38,90,1510,2730);
        servo3_deg=SS_servo3[node]/3.14159265*180;
        servo3=map(servo3_deg,-90,90,1100,2700);
        servo4_deg=SS_servo4[node]/3.14159265*180;
        servo4=map(servo4_deg,-90,38,2700,1500);
        servo5_deg=SS_servo5[node]/3.14159265*180;
        servo5=map(servo5_deg,-90,90,2600,930);
        servo6_deg=SS_servo6[node]/3.14159265*180;
        servo6=map(servo6_deg,-90,38,850,2250);
        servo7_deg=SS_servo7[node]/3.14159265*180;
        servo7=map(servo7_deg,-90,90,920,2620);
        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);
        
        node+=1;
        if(node>=steps and input==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          node=0;
        }
        if(node>=steps and input==2)
        {
          Serial.print("Input:");
          Serial.println(input);
          input=0;
        }
         end_time=esp_timer_get_time()+time_step;
      }
   }

  if(input == 0)
  {        
        pca9685.setPWM(SER0,0,servo0);
        pca9685.setPWM(SER1,0,servo1);
        pca9685.setPWM(SER2,0,servo2);
        pca9685.setPWM(SER3,0,servo3);
        pca9685.setPWM(SER4,0,servo4);
        pca9685.setPWM(SER5,0,servo5);
        pca9685.setPWM(SER6,0,servo6);
        pca9685.setPWM(SER7,0,servo7);

        if(one_print==1)
        {
          Serial.print("Input:");
          Serial.println(input);
          Serial.print("Node:");
          Serial.println(node);
          Serial.print("servo0 -> rads:");
          Serial.print(SS_servo0[node]);
          Serial.print("        deg:");
          Serial.print(servo0_deg);
          Serial.print("        us:");
          Serial.println(servo0);
          Serial.print("servo1 -> rads:");
          Serial.print(SS_servo1[node]);
          Serial.print("        deg:");
          Serial.print(servo1_deg);
          Serial.print("        us:");
          Serial.println(servo1);
          Serial.print("servo2 -> rads:");
          Serial.print(SS_servo2[node]);
          Serial.print("        deg:");
          Serial.print(servo2_deg);
          Serial.print("        us:");
          Serial.println(servo2);
          Serial.print("servo3 -> rads:");
          Serial.print(SS_servo3[node]);
          Serial.print("        deg:");
          Serial.print(servo3_deg);
          Serial.print("        us:");
          Serial.println(servo3);
          Serial.print("servo4 -> rads:");
          Serial.print(SS_servo4[node]);
          Serial.print("        deg:");
          Serial.print(servo4_deg);
          Serial.print("        us:");
          Serial.println(servo4);
          Serial.print("servo5 -> rads:");
          Serial.print(SS_servo5[node]);
          Serial.print("        deg:");
          Serial.print(servo5_deg);
          Serial.print("        us:");
          Serial.println(servo5);
          Serial.print("servo6 -> rads:");
          Serial.print(SS_servo6[node]);
          Serial.print("        deg:");
          Serial.print(servo6_deg);
          Serial.print("        us:");
          Serial.println(servo6);
          Serial.print("servo7 -> rads:");
          Serial.print(SS_servo7[node]);
          Serial.print("        deg:");
          Serial.print(servo7_deg);
          Serial.print("        us:");
          Serial.println(servo7);
          one_print=0;
        }
  
  }
}
